webpackJsonp([1],{"//63":function(t,e){},"3q+s":function(t,e,i){"use strict";(function(t){var r=i("Gu7T"),a=i.n(r),n=i("mvHQ"),s=i.n(n),l=i("BO1k"),o=i.n(l),h=i("c/Tr"),c=i.n(h),u=i("Dd8w"),d=i.n(u),f=i("NYxO");e.a={name:"SubList",data:function(){return{rotateDeg:25,histHeightRatio:.2,histGHeightRatio:.7,histGXMarginRatio:.03,histFilterDimExpandedRatio:1.35,histFilterGHeightRatio:.3,listItemHeightRatio:.01,listXMarginRatio:.08,listXMarginNewRatio:.01,listTopMarginRatio:.02,dimRibbonXMarginRatio:.025,dimRibbonXSpacingRatio:.012,dimRibbonXNewSpacingRatio:.5,dimRibbonHeightRatio:.7,hideDims:[],showDims:[],animationDuration:400}},mounted:function(){},computed:d()({},Object(f.c)(["updateMap","updateSubList"])),watch:{updateMap:function(t,e){this.updateParams(),this.map=t.map,this.leafNodes=c()(this.map.allLeaves.values()),this.subOrder=this.getSubOrder(),null!=e.map?this.redraw():(this.init(),this.draw())},updateSubList:function(t){var e=this;switch(t.type){case"mouseover":var i=void 0;i=void 0!==t.path2This?this.getSubsByPath(t.path2This):t.subIds;var r=[],a=!0,n=!1,l=void 0;try{for(var h,c=o()(this.subOrder);!(a=(h=c.next()).done);a=!0){var u=h.value;this.currSubs.indexOf(Data.subs[u])>-1&&r.push(u)}}catch(t){n=!0,l=t}finally{try{!a&&c.return&&c.return()}finally{if(n)throw l}}var d=[],f=!0,p=!1,v=void 0;try{for(var g,y=o()(i);!(f=(g=y.next()).done);f=!0){var m=g.value;d.push(r.indexOf(m))}}catch(t){p=!0,v=t}finally{try{!f&&y.return&&y.return()}finally{if(p)throw v}}var b=Math.min.apply(Math,d),S=Math.max.apply(Math,d),w=Math.floor(1/this.listItemHeightRatio);if(0!==b&&S+1>w){var D=this.currSubs.length-w,x=(b-D>0?D:b)*this.listItemHeight;d3.select(this.$el).select("#list").transition().duration(1500).tween("uniquetweenname",k(x)).on("end",function(){for(var t=0;t<i.length;t++){var r=e.listSvg.select("#listItemG"+i[t]);r.classed("listItemHoverDisabled")||(r.classed("listItemHovered",!0),r.select(".subSelected").style("opacity",1))}e.updateView("subSelect")})}else{for(var P=0;P<i.length;P++){var C=this.listSvg.select("#listItemG"+i[P]);C.classed("listItemHoverDisabled")||(C.classed("listItemHovered",!0),C.select(".subSelected").style("opacity",1))}this.updateView("subSelect")}break;case"mouseout":this.listSvg.selectAll(".listItemG").each(function(){var t=d3.select(this);t.classed("listItemClicked")||(t.classed("listItemHovered",!1),t.classed("listItemHoverDisabled",!1),t.select(".subSelected").style("opacity",0))}),d3.select(this.$el).select("#list").transition().duration(1500).tween("uniquetweenname",k(0)),this.updateView("subUnselect");break;case"click":i=void 0!==t.path2This?this.getSubsByPath(t.path2This):t.subIds,this.listSvg.selectAll(".listItemG").each(function(){var t=d3.select(this);t.classed("listItemClicked")&&(t.classed("listItemClicked",!1),t.classed("listItemHoverDisabled",!0),t.select(".subSelected").style("opacity",0))});for(var M=0;M<i.length;M++){var A=this.listSvg.select("#listItemG"+i[M]);A.classed("listItemClicked")||(A.classed("listItemHovered",!1),A.classed("listItemClicked",!0),A.classed("listItemHoverDisabled",!0),0===A.selectAll(".subSelected")._groups[0].length&&A.select(".subSelected").style("opacity",1))}this.updateView("subSelect");break;case"unclick":this.listSvg.selectAll(".listItemG").each(function(){var t=d3.select(this);t.classed("listItemClicked")&&(t.classed("listItemClicked",!1),t.classed("listItemHoverDisabled",!0),t.select(".subSelected").style("opacity",0))}),this.updateView("subUnselect");break;case"changeShownItems":this.currSubs=[];var I=[];void 0===t.subIds?void 0!==t.path2This?I=this.getSubsByPath(t.path2This):this.currSubs=JSON.parse(s()(Data.subs)):I=t.subIds;for(var R=0;R<I.length;R++)this.currSubs.push(Data.subs[I[R]]);this.updateView("dimClick")}function k(t){return function(){var e=d3.interpolateNumber(this.scrollTop,t);return function(t){this.scrollTop=e(t)}}}}},methods:d()({},Object(f.b)(["updateUpdateMapByDim","updateUpdateMapBySub"]),{updateParams:function(){this.width=this.$el.offsetWidth,this.height=this.$el.offsetHeight,"Pendigits"===Data.file&&d3.select(this.$el).select("#list").style("top",.185*this.height+"px").style("height",.795*this.height+"px"),this.histWidth=parseFloat(d3.select(this.$el).select("#hist").style("width")),this.histFakeHeight=parseFloat(d3.select(this.$el).select("#hist").style("height")),this.histHeight=ratio2px(this.histHeightRatio,this.height),this.histGHeight=ratio2px(this.histGHeightRatio,this.histHeight),this.histGXMargin=ratio2px(this.histGXMarginRatio,this.width),this.histFilterGY=this.histGHeight,this.histFilterGHeight=ratio2px(this.histFilterGHeightRatio,this.histHeight),this.histFilterItemWidth=(this.histWidth-2*this.histGXMargin)/Data.dims.length,this.histFilterDim1stR=this.histFilterItemWidth/7,this.histFilterDimCY=this.histFilterDim1stR,this.histFilterDim1stCX=2*this.histFilterDim1stR,this.histFilterDim2ndCX=this.histFilterDim1stCX+3*this.histFilterDim1stR,this.histFilterDim2ndStrokeWidth=this.histFilterDim1stR/2.5,this.histFilterDim2ndR=this.histFilterDim1stR-this.histFilterDim2ndStrokeWidth/2,this.histFilterDim1stSelectedR=this.histFilterDim1stR*this.histFilterDimExpandedRatio,this.histFilterDim2ndSelectedStrokeWidth=this.histFilterDim2ndStrokeWidth*this.histFilterDimExpandedRatio,this.histFilterDim2ndSelectedR=this.histFilterDim1stSelectedR-this.histFilterDim2ndSelectedStrokeWidth/2,this.histFilterDimNameX=this.histFilterDim1stR,this.histFilterDimNameY=3*this.histFilterDim1stR,this.histBarTopMargin=1.2*toPX("0.8em"),this.histBarBtmMargin=2*(this.histFilterDim1stSelectedR-this.histFilterDim1stR),this.histBarMaxHeight=ratio2px(this.histGHeightRatio,this.histHeight)-this.histBarBtmMargin,this.histBarX=this.histFilterDim1stCX,this.histBarWidth=this.histFilterDim2ndCX-this.histFilterDim1stCX,this.histBarY=d3.scaleLinear().domain([0,d3.max(Data.subtree.data.dimCounts)]).range([this.histBarMaxHeight,this.histBarTopMargin]),this.histBarXSpacing=this.histFilterItemWidth,this.histBarNumX=this.histBarX+this.histBarWidth/2,this.histBarNumXSpacing=this.histBarXSpacing,this.histBarNumYSpacing=this.histBarTopMargin-toPX("0.8em")/2,this.listWidth=parseFloat(d3.select(this.$el).select("#list").style("width")),this.listItemHeight=ratio2px(this.listItemHeightRatio,parseFloat(d3.select(this.$el).select("#list").style("height"))),this.listHeight=this.listItemHeight*Data.subs.length,this.dimRibbonXSpacing=this.histFilterItemWidth-(this.histFilterDim2ndCX+this.histFilterDim2ndR-(this.histFilterDim1stCX-this.histFilterDim1stR)),this.listX=this.histGXMargin+this.histFilterDim1stCX-this.histFilterDim1stR-ratio2px(this.listXMarginNewRatio,this.listWidth),this.listY=0,this.listItemWidth=this.listWidth-2*this.listX,this.dimRibbonX=ratio2px(this.listXMarginNewRatio,this.listWidth),this.dimRibbonWidth=this.histFilterDim2ndCX+this.histFilterDim2ndR-(this.histFilterDim1stCX-this.histFilterDim1stR),this.dimRibbonHeight=ratio2px(this.dimRibbonHeightRatio,this.listItemHeight),this.dimRibbonY=(this.listItemHeight-this.dimRibbonHeight)/2,this.highlightRibbonStrokeWidth=(this.listItemHeight-this.dimRibbonHeight)/2,this.highlightRibbonY=this.highlightRibbonStrokeWidth/2,this.highlightRibbonX=this.highlightRibbonStrokeWidth/2,this.highlightRibbonWidth=this.listItemWidth-2*this.highlightRibbonX,this.highlightRibbonHeight=this.listItemHeight-2*this.highlightRibbonY,this.color={h:d3.scaleLinear().domain([0,1]).range([0,360]),c:d3.scaleLinear().domain([0,1]).range([30,80]),l:d3.scaleLinear().domain([0,1]).range([45,90])}},init:function(){this.currSubs=Data.subs,this.listSvg=d3.select(this.$el).select("#list").append("svg").attr("width",this.listWidth).attr("height",this.listHeight).append("g").attr("id","subListSvg").attr("transform","translate("+this.listX+", "+this.listY+")"),this.histSvg=d3.select(this.$el).select("#hist").append("svg").attr("width",this.histWidth).attr("height",this.histFakeHeight).append("g").attr("id","subHistSvg").attr("transform","translate("+this.histGXMargin+", 0)")},redraw:function(){this.clear(),this.init(),this.draw()},clear:function(){d3.select(this.$el).select("#list").selectAll("*").remove(),d3.select(this.$el).select("#hist").selectAll("*").remove()},draw:function(){this.drawList(),this.drawHist(),this.targetedModification()},drawHist:function(){var t=this,e=this;function i(t){t.classed("histFilterDimShowClicked",!1).attr("r",e.histFilterDim1stR)}function r(t){t.classed("histFilterDimHideClicked",!1).attr("r",e.histFilterDim2ndR).style("stroke","#bdbdbd").style("stroke-width",e.histFilterDim2ndStrokeWidth)}this.histG=this.histSvg.append("g").attr("id","histG"),this.histG.selectAll(".histBar").data(Data.subtree.data.dimCounts).enter().append("rect").attr("class","histBar").attr("id",function(t,e){return"histBar-"+e}).attr("x",function(e,i){return t.histBarX+t.histBarXSpacing*i}).attr("y",function(e){return t.histBarY(e)}).attr("width",this.histBarWidth).attr("height",function(e){return t.histBarY(0)-t.histBarY(e)}),this.histG.selectAll(".histDimNum").data(Data.subtree.data.dimCounts).enter().append("text").attr("class","histDimNum").attr("x",function(e,i){return t.histBarNumX+t.histBarNumXSpacing*i}).attr("y",function(e){return t.histBarY(e)-t.histBarNumYSpacing}).text(function(t){return t}),this.histFilterG=this.histSvg.append("g").attr("id","histFilterG").attr("transform","translate(0, "+this.histFilterGY+")"),this.histFilterG.selectAll(".histFilterItemG").data(Data.dims).enter().append("g").attr("class","histFilterItemG").attr("id",function(t,e){return"histFilterItem-"+e}).attr("transform",function(e,i){return"translate("+t.histFilterItemWidth*i+", 0)"}).each(function(t,a){d3.select(this).append("circle").attr("class","histFilterDimShow").attr("cx",e.histFilterDim1stCX).attr("cy",e.histFilterDimCY).attr("r",e.histFilterDim1stR).on("click",function(){var t=e.histFilterG.select("#histFilterItem-"+a).select(".histFilterDimHide");t.classed("histFilterDimHideClicked")&&(r(t),e.hideDims.remove(a));var n=d3.select(this);n.classed("histFilterDimShowClicked")?(i(n),e.showDims.remove(a)):(n.classed("histFilterDimShowClicked",!0).attr("r",e.histFilterDim1stSelectedR),e.showDims.push(a)),e.updateView("dimClick"),e.updateMapByDim()}),d3.select(this).append("circle").attr("class","histFilterDimHide").attr("cx",e.histFilterDim2ndCX).attr("cy",e.histFilterDimCY).attr("r",e.histFilterDim2ndR).style("stroke","#bdbdbd").style("stroke-width",e.histFilterDim2ndStrokeWidth).on("click",function(){var t=e.histFilterG.select("#histFilterItem-"+a).select(".histFilterDimShow");t.classed("histFilterDimShowClicked")&&(i(t),e.showDims.remove(a));var n=d3.select(this);n.classed("histFilterDimHideClicked")?(r(n),e.hideDims.remove(a)):(n.classed("histFilterDimHideClicked",!0).attr("r",e.histFilterDim2ndSelectedR).style("stroke","#252525").style("stroke-width",e.histFilterDim2ndSelectedStrokeWidth),e.hideDims.push(a)),e.updateView("dimClick"),e.updateMapByDim()}),d3.select(this).append("text").attr("class","histFilterDimName").attr("x",e.histFilterDimNameX).attr("y",e.histFilterDimNameY).text(function(){return t.length>4?t.slice(0,4)+"...":t}).on("mouseover",function(){d3.select(this).text(t)}).on("mouseout",function(){d3.select(this).text(function(){return t.length>4?t.slice(0,4)+"...":t})})}),this.histSvg.selectAll(".histFilterDimName").attr("transform","rotate("+this.rotateDeg+")")},drawList:function(){var t=this,e=this;this.listSvg.selectAll(".listItemG").data(this.subOrder).enter().append("g").attr("class","listItemG").attr("id",function(t){return"listItemG"+t}).attr("subId",function(t){return t}).attr("transform",function(e,i){return"translate(0, "+t.listItemHeight*i+")"}).each(function(t,i){var r=this;d3.select(this).append("rect").attr("class","subRibbon").attr("x",0).attr("y",0).attr("width",e.listItemWidth).attr("height",e.listItemHeight).attr("fill",function(t){var e=Data.colors[t];return"rgb("+[~~(255*e[0]),~~(255*e[1]),~~(255*e[2])]+")"}),d3.select(this).selectAll(".dimRibbon").data(Data.dims).enter().append("rect").attr("class","dimRibbon").attr("x",function(t,i){return e.dimRibbonX+(e.dimRibbonWidth+e.dimRibbonXSpacing)*i}).attr("y",e.dimRibbonY).attr("width",e.dimRibbonWidth).attr("height",e.dimRibbonHeight).attr("fill",function(e,i){return"0"===Data.subs[t][i]?"white":"#252525"}),d3.select(this).append("rect").attr("class","subSelected").attr("x",e.highlightRibbonX).attr("y",e.highlightRibbonY).attr("width",e.highlightRibbonWidth).attr("height",e.highlightRibbonHeight).style("stroke-width",e.highlightRibbonStrokeWidth).style("opacity",0),d3.select(this).on("mouseover",function(){d3.select(r).classed("listItemHoverDisabled")||(d3.select(r).classed("listItemHovered",!0),d3.select(r).select(".subSelected").style("opacity",1),e.updateView("subSelect"),e.updateUpdateMapBySub({subIds:[t+""],type:"hover"}))}).on("mouseout",function(){d3.select(r).classed("listItemClicked")||(d3.select(r).classed("listItemHovered",!1).classed("listItemHoverDisabled",!1),d3.select(r).select(".subSelected").style("opacity",0),e.updateView("subUnselect"),e.updateUpdateMapBySub({subIds:void 0,type:"hover"}))}).on("click",function(){d3.select(r).classed("listItemClicked")?(d3.select(r).classed("listItemClicked",!1).classed("listItemHoverDisabled",!0),d3.select(r).select(".subSelected").style("opacity",0),e.updateView("subUnselect"),e.updateUpdateMapBySub({subIds:void 0,type:"click"})):(e.listSvg.selectAll(".listItemG").classed("listItemClicked",!1).classed("listItemHoverDisabled",!1),e.listSvg.selectAll(".subSelected").style("opacity",0),d3.select(r).classed("listItemHovered",!1).classed("listItemClicked",!0).classed("listItemHoverDisabled",!0),d3.select(r).select(".subSelected").style("opacity",1),e.updateView("subSelect"),e.updateUpdateMapBySub({subIds:[t+""],type:"click"}))})}),this.listSvg.selectAll(".dimRibbon").attr("fill-opacity",.6)},targetedModification:function(){var t=Data.file,e=void 0;switch(t){case"Wine":e=.9,this.rotateDeg=35,this.histFilterDimNameY=4.5*this.histFilterDim1stR;break;case"Pendigits":e=.7,this.rotateDeg=0,this.histFilterDimNameX=this.histFilterItemWidth/2,this.histFilterDimNameY=6*this.histFilterDim1stR,this.histSvg.selectAll(".histFilterDimName").attr("x",this.histFilterDimNameX).style("text-anchor","middle"),this.histSvg.selectAll(".histDimNum").style("font-size","0.7em");break;default:e=.95,this.rotateDeg=25,this.histFilterDimNameY=3*this.histFilterDim1stR}this.histSvg.selectAll(".histFilterDimName").attr("y",this.histFilterDimNameY).attr("transform","rotate("+this.rotateDeg+")").style("font-size",e+"em"),"Pendigits"===t&&this.histSvg.selectAll(".histFilterDimName").each(function(t){Number(d3.select(this).text().replace("F"," "))>9&&d3.select(this).style("font-size","0.55em")})},getSubOrder:function(){for(var t=this.leafNodes,e=[],i=[],r=Data.subtree,n=function(e){for(var i=[],r=function(r){var a=e[r],n=t.find(function(t){return t.ID===a});i.push(n.center.coordinates.y)},a=0;a<e.length;a++)r(a);return n=i,n.map(function(t,e){return{ind:e,val:t}}).sort(function(t,e){return t.val>e.val?1:t.val==e.val?0:-1}).map(function(t){return t.ind});var n}(Data.nationalCaps),s=0;s<n.length;s++)i.push.apply(i,a()(r.children[n[s]].data.glbTraversalOrder));for(var l=0;l<r.data.dscTraversalOrder.length;l++)0!=r.data.dscTraversalOrder[l][1]&&e.push(r.data.dscTraversalOrder[l][0]);return e.unshift.apply(e,i),e},updateView:function(t){var e=this,i=void 0;function r(){var t=[];return e.listSvg.selectAll(".listItemG").each(function(e,i){(d3.select(this).classed("listItemHovered")||d3.select(this).classed("listItemClicked"))&&t.push(e)}),t}"dimClick"===t?(i=this.filterSubsByHistFilter(this.currSubs),this.updateHist(i),this.updateList(i)):"subSelect"===t?(i=r(),this.updateHist(i)):"subUnselect"===t&&(0===(i=r()).length&&(i=this.filterSubsByHistFilter(this.currSubs)),this.updateHist(i))},filterSubsByHistFilter:function(t){for(var e=this,i=[],r=0;r<t.length;r++){var a=s(t[r],"hide"),n=s(t[r],"show");a||n||i.push(Data.subs.indexOf(t[r]))}return i;function s(t,i){var r=0;if("hide"===i)for(;r<e.hideDims.length;){if("1"===t[e.hideDims[r]])return!0;r++}else for(;r<e.showDims.length;){if("0"===t[e.showDims[r]])return!0;r++}return!1}},updateHist:function(t){for(var e=this,i=new Array(Data.dims.length).fill(0),r=function(e){var r=Data.subs[t[e]].split("").map(Number);i=i.map(function(t,e){return t+r[e]})},a=0;a<t.length;a++)r(a);this.histBarY.domain([0,d3.max(i)]),this.histG.selectAll(".histBar").data(i).transition().duration(this.animationDuration).attr("y",function(t){return e.histBarY(t)}).attr("height",function(t){return e.histBarY(0)-e.histBarY(t)}),this.histG.selectAll(".histDimNum").data(i).transition().duration(this.animationDuration).attr("y",function(t){return e.histBarY(t)-e.histBarNumYSpacing}).text(function(t){return t})},updateList:function(e){var i=this,r=[],a=(this.listSvg.selectAll(".listItemG").filter(function(){if("hidden"===d3.select(this).style("visibility")){var t=parseInt(d3.select(this).attr("subId"));return r.push(t),!0}}),this.listSvg.selectAll(".listItemG").filter(function(){var t=parseInt(d3.select(this).attr("subId"));return-1===e.indexOf(t)})),n=this.listSvg.selectAll(".listItemG").filter(function(){var t=parseInt(d3.select(this).attr("subId"));return-1!=e.indexOf(t)}),s=t.Deferred(),l=t.Deferred();!function(t){var e=a.filter(function(){var t=parseInt(d3.select(this).attr("subId"));return-1===r.indexOf(t)});if(0===e._groups[0].length)return void t.resolve();e.transition().duration(500).style("opacity",0).on("end",function(i,r){d3.select(this).style("visibility","hidden"),r===e._groups[0].length-1&&t.resolve()})}(s),t.when(s).done(function(){return function(t){var r=i.listItemHeight*e.length;r>i.listHeight&&(i.listHeight=r,d3.select(i.$el).select("#list").select("svg").attr("height",i.listHeight));n.transition().duration(700).attr("transform",function(t,e){return"translate(0, "+i.listItemHeight*e+")"}).on("end",function(e,i){i===n._groups[0].length-1&&t.resolve()})}(l)}),t.when(l).done(function(){i.listHeight=i.listItemHeight*e.length,d3.select(i.$el).select("#list").select("svg").attr("height",i.listHeight),n.style("visibility","visible").transition().duration(500).style("opacity",1)})},getSubsByPath:function(t){for(var e=Data.subtree.findByIndex(t).dict,i=[],r=0;r<e.length;r++)i.push(e[r][0]);for(var a=[],n=0;n<i.length;n++)a.push(Data.subs[i[n]]);return i=this.filterSubsByHistFilter(a)},updateMapByDim:function(){var t=new Array(Data.dims.length).fill(-1);t.needed=!1;for(var e=0;e<this.showDims.length;e++)t[this.showDims[e]]=1;for(var i=0;i<this.hideDims.length;i++)t[this.hideDims[i]]=0;0===this.showDims.length&&0===this.hideDims.length||(t.needed=!0),this.updateUpdateMapByDim({dimStates:t})},histFilterDimNameFontSizeAdjustment:function(){d3.line().x(function(t){return t.x}).y(function(t){return t.y});for(var t=void 0,e=!0;e;){t=parseFloat(this.histSvg.select(".histFilterDimName").style("font-size")),e=!1;var i=[],r=!0,a=!1,n=void 0;try{for(var s,l=o()(this.histSvg.selectAll(".histFilterDimName")._groups[0]);!(r=(s=l.next()).done);r=!0){var h=s.value.getBoundingClientRect();i.push([{x:h.x,y:h.y},{x:h.x+h.width,y:h.y},{x:h.x+h.width,y:h.y+h.height},{x:h.x,y:h.y+h.height}])}}catch(t){a=!0,n=t}finally{try{!r&&l.return&&l.return()}finally{if(a)throw n}}for(var c=this._rectRotatedCoords(i,this.rotateDeg),u=0;u<c.length-1;u++)if(this._polygonsIntersect(c[u],c[u+1])){t-=.2,this.histSvg.selectAll(".histFilterDimName").style("font-size",t+"px"),e=!0;break}}},_deg2rad:function(t){return t*Math.PI/180},_rectRotatedCoords:function(t,e){var i=[],r=this._deg2rad(e),a=!0,n=!1,s=void 0;try{for(var l,h=o()(t);!(a=(l=h.next()).done);a=!0){var c=l.value,u=(c[0].x+c[1].x)/2,d=(c[0].y+c[2].y)/2,f=[],p=!0,v=!1,g=void 0;try{for(var y,m=o()(c);!(p=(y=m.next()).done);p=!0){var b=y.value,S=b.x-u,w=b.y-d,D=S*Math.cos(r)-w*Math.sin(r)+u,x=S*Math.sin(r)+w*Math.cos(r)+d;f.push({x:D,y:x})}}catch(t){v=!0,g=t}finally{try{!p&&m.return&&m.return()}finally{if(v)throw g}}i.push(f)}}catch(t){n=!0,s=t}finally{try{!a&&h.return&&h.return()}finally{if(n)throw s}}return i},_polygonsIntersect:function(t,e){var i,r,a,n,s,l,o,h,c=[t,e];for(n=0;n<c.length;n++){var u=c[n];for(s=0;s<u.length;s++){var d=(s+1)%u.length,f=u[s],p=u[d],v={x:p.y-f.y,y:f.x-p.x};for(i=r=void 0,l=0;l<t.length;l++)a=v.x*t[l].x+v.y*t[l].y,(void 0===i||a<i)&&(i=a),(void 0===r||a>r)&&(r=a);for(o=h=void 0,l=0;l<e.length;l++)a=v.x*e[l].x+v.y*e[l].y,(void 0===o||a<o)&&(o=a),(void 0===h||a>h)&&(h=a);if(r<o||h<i)return!1}}return!0}})}}).call(e,i("4kSj"))},"3su0":function(t,e,i){"use strict";(function(t){var r=i("lHA8"),a=i.n(r),n=i("Gu7T"),s=i.n(n),l=i("pFYg"),o=i.n(l),h=i("d7EF"),c=i.n(h),u=i("woOf"),d=i.n(u),f=i("Zrlr"),p=i.n(f),v=i("wxAW"),g=i.n(v),y=function(){function t(e,i,r,a,n){p()(this,t);var s={r:2*e*Math.sqrt(3)/3,maxR:i,mapType:r,glyphType:a,strokeThin:0,strokeThick:4,fanAngleRatio:.3,colors:n,filterer:null,filterSettings:{container:null,overallSelector:".SubMapGrids",overallKey:"index",controlAttr:"opacity",invisibleOpac:.2,static:{attrs:["class"],match:["pinned"],miss:[null],normal:[!1]},overallFilterFunc:null,getFilterFunc:function(){},animation:function(){}}};d()(this,s)}return g()(t,[{key:"getRectGlyph",value:function(t){return new(function(){function t(e){p()(this,t);var i=e.dimLength,r=c()(e.size,2),a=r[0],n=r[1];this.size=[a,n],this.className=e.className,this.glyphWidth=.8*a/(i+.125*(i+1)),this.glyphHeight=.8*n,this.glyphSize=Math.min(this.glyphWidth,this.glyphHeight),this.margin=e.margin,this.marginWidth=(a-i*this.glyphWidth-2*this.margin[0])/(i+1),this.marginHeight=(n-this.glyphHeight)/2,this.type=e.type}return g()(t,[{key:"show",value:function(t,e){var i=this,r=this.glyphSize,a=this.glyphWidth,n=this.glyphHeight,s=this.margin,l=(this.marginHeight,this.marginWidth),o=this.type;t.selectAll("."+this.className).data(e).enter().append("g").attr("class",this.className).attr("transform",function(t,e){return"translate("+[s[0]+(a+l)*e+l,i.margin[1]+i.marginHeight]+")"}).each(function(t){switch(o){case"rectangle":d3.select(this).classed("empty",0==t).append("rect").attr("x",0).attr("y",0).attr("width",a).attr("height",n);break;case"circle":var e=r/2;d3.select(this).classed("empty",0==t).append("circle").attr("cx",e).attr("cy",e).attr("r",e)}})}}]),t}())(t)}},{key:"showFrames",value:function(t,e,i,r){t.append("path").classed("metaGlyph",!0).classed("fill",!0).attr("d",e).attr("fill",i).attr("fill-opacity",r).classed("cell",!0)}},{key:"showBoundaries",value:function(t,e,i,r){var a=this;t.selectAll("line").data(e).enter().append("g").attr("class","gridEdge").attr("transform",function(t){return"rotate("+t.angle/Math.PI*180+")"}).append("line").attr("x1",i*Math.sqrt(3)/2).attr("x2",i*Math.sqrt(3)/2).attr("y1",.5*i).attr("y2",.5*-i).attr("opacity",function(t){return null==t.dist?r?.2:1:t.dist}).attr("stroke","none").attr("stroke-width",function(t){return null==t.dist?r?a.strokeThin+"px":"0px":.9*t.dist*a.strokeThick+"px"})}},{key:"showStick",value:function(t,e){for(var i=2*Math.PI/e.length,r=0;r<e.length;r++){var a=i*r;t.append("line").attr("class","weights").attr("x1",0).attr("y1",0).attr("x2",.8*this.maxR*e[r]*Math.cos(a)).attr("y2",.8*this.maxR*e[r]*Math.sin(a))}}},{key:"showFan",value:function(t,e,i,r,a,n,s){for(var l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,c=2*Math.PI/e.length,u=this,d=-1!==Data.nationalCaps.indexOf(i),f=-1!==Data.provincialCaps.indexOf(i),p=d3.arc().outerRadius(s).innerRadius(n).startAngle(-c*this.fanAngleRatio).endAngle(c*this.fanAngleRatio),v=d3.arc().outerRadius(s).innerRadius(a).startAngle(-c*this.fanAngleRatio).endAngle(c*this.fanAngleRatio),g=function(a){var n=360/e.length*a;t.append("g").attr("class","dimFan").classed("metaGlyph",!0).attr("transform","rotate("+n+")").attr("index",i+"_"+a).attr("ptOpacity",function(){if(l){var t=(o[a]-h.min)/(h.max-h.min);return t=20*t-10,.9*(t=1/(Math.exp(-t)+1))}return 1}).attr("opacity",function(){return l?(o[a]-h.min)/(h.max-h.min):1}).append("path").classed("fill",0!=e[a]).attr("d",function(){return d?v():f?v():p()}).attr("fill",0==e[a]?"none":r).attr("stroke",function(){var t=!d3.select(this).classed("fill");return l&&t?r:"none"}).attr("stroke-width",function(){var t=!d3.select(this).classed("fill");return l&&t?u.strokeThin:"0px"})},y=0;y<e.length;y++)g(y);d&&(t.append("circle").attr("cx",0).attr("cy",0).attr("r",a).style("fill","#fff").style("stroke","#000").style("stroke-width",a/3),t.append("circle").attr("cx",0).attr("cy",0).attr("r",n).style("fill","#000")),f&&t.append("circle").attr("cx",0).attr("cy",0).attr("r",a).style("fill","#fff").style("stroke","#000").style("stroke-width",a/2)}},{key:"showBridge",value:function(t,e,i,r){var a=e.diffScale;t.selectAll(".subEdge").data(e).enter().append("g").attr("class","subEdge").attr("transform",function(t){return"rotate("+t.angle/Math.PI*180+")"}).call(function(t){t[0].forEach(function(t){var e=d3.select(t).data()[0],n=null!=e.diff;if(n){var s=n?a(e.diff):null,l=[i,.5*-s],o=[i,.5*s],h="M0 0 L"+l.join(" ")+" L"+o.join(" ")+" Z";d3.select(t).attr("opacity",e.dist).append("path").attr("d",h).attr("fill",r),d3.select(t).append("line").attr("x1",0).attr("x2",l[0]).attr("y1",0).attr("y2",l[1]).attr("stroke-width",3*e.dist),d3.select(t).append("line").attr("x1",0).attr("x2",o[0]).attr("y1",0).attr("y2",o[1]).attr("stroke-width",3*e.dist)}})})}},{key:"initializeFilter",value:function(t){var e=this.filterer,i=this.filterSettings;null==e&&(i.container=t,this.filterer=e=new m(i));i.getFilterFunc=function(t,e){var i=t.filter(function(t){return t>=0}).length;return 0===i?function(t){return!0}:function(r){for(var a=r[0].ID,n=e[a],s=0,l=!0,o=0;o<t.length;o++)t[o]>=0&&Number(n[o])===t[o]&&s++;return s<i&&(l=!1),l}},e.animation=function(t,e){var r=e?1:i.invisibleOpac;t.attr("ftOpacity",r).interrupt().transition().attr("opacity",function(){var t=d3.select(this),e=parseFloat(t.attr("zgOpacity")),i=parseFloat(t.attr("ptOpacity"));return e=isNaN(e)?1:e,i=isNaN(i)?1:i,e*r*i})},e.init()}},{key:"filterGlyphsByDims",value:function(t,e,i,r,a){var n=this.filterer;null!=n&&n.ready||this.initializeFilter(t);return b(null!=e&&e.needed?this.filterer.filter("filterDims","data",null,this.filterSettings.getFilterFunc(e,a),!0):this.filterer.restore("filterDims"),i,r)}},{key:"filterGlyphsByIDs",value:function(t,e,i,r){var a=this.filterer;return null!=a&&a.ready||(this.initializeFilter(t),a=this.filterer),b(null!=e?a.filter("filterIDs","index",e):a.restore("filterIDs"),i,r)}},{key:"pickGlyphsByIDs",value:function(t,e,i,r){var a=this.filterer;return null!=a&&a.ready||(this.initializeFilter(t),a=this.filterer),b(null!=e?a.pick("pickIDs","index",e):a.restore("pickIDs"),i,r)}},{key:"changeGlyph",value:function(t,e,i){var r=this,a=i.extent;switch(this.mapType){case"cell":switch(this.glyphType){case"fill":case"stick":break;case"fan":t.selectAll(".dimFan").attr("ptOpacity",function(){var t,r,n=d3.select(this).attr("index");t=(n=n.split("_"))[0],r=n[1];var s=i[t];if(e){var l=(s[r]-a.min)/(a.max-a.min);return l=20*l-10,.9*(l=1/(Math.exp(-l)+1))}return 1}).transition().attr("opacity",function(){return d3.select(this).attr("ptOpacity")}),t.selectAll(".dimFan").select("path").transition().attr("stroke",function(){return"#000"}).attr("stroke-width",function(){return!d3.select(this).classed("fill")?r.strokeThin:"0px"})}}}},{key:"showGlyph",value:function(t,e,i,r,a){var n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,o=null==i,h=this.r;switch(r&&r.length?(this.strokeThin=4/r.length,this.strokeThick=12/r.length):(this.strokeThin=.5,this.strokeThick=4),this.mapType){case"cell":switch(this.glyphType){case"fill":this.showFrames(t,d3.hexbin().hexagon(h),a,.8);break;case"stick":this.showFrames(t,d3.hexbin().hexagon(h),a,.8),h>0&&r&&r.length>0&&this.showStick(t,r);break;case"fan":this.showFrames(t,d3.hexbin().hexagon(h),null==i?"#000":a,null==i?.2:.4),!o&&r&&r.length>0&&this.showFan(t,r,i,"#000",.2*h,.1*h,.8*h,n,s,l)}break;case"diff":this.showFrames(t,d3.hexbin().hexagon(h),null==i?"#fff":a,.2),o||this.showBridge(t,e,this.maxR,a)}return t}}]),t}();e.a=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return new(Function.prototype.bind.apply(y,[null].concat(e)))};var m=function(){function e(t){p()(this,e),this.container=t.container,this.overallSelector=t.overallSelector,this.overallKey=t.overallKey;var i=t.overallFilterFunc;if(this.overallFilterFunc=null==i?function(t){return!0}:i,this.subSelector=t.subSelector,this.controlAttr=t.controlAttr,this.static=t.static,this.animation=t.animation,"object"===o()(this.animation)){var r=this.animation.duration;this.animation.duration=null==r?r:400}this.filterers=new Array,this.filterID=0,this.ready=!1}return g()(e,[{key:"init",value:function(){this.ready=!0;var e=this,i=this.animation,r=(this.overallFilterFunc,this.container.selectAll(this.overallSelector).filter(this.overallFilterFunc));null!=this.subSelector&&(r=r.selectAll(this.subSelector)),"function"==typeof i?i(r,!0):("function"!=typeof i.match&&(i.match=function(){return i.match}),"function"!=typeof i.miss&&(i.miss=function(){return i.miss}),r.attr(i.attr,i.match())),this.filterers.filters=new Array,this.filterers.pickers=new Array,this.filterers.reducers=new Array,this.filterers.otherFilters=new Array,this.filterers.otherPickers=new Array,this.filterers.otherReducers=new Array,this.filterers.add=function(t,i,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"filter",n=(e.animation,"PDfiltered_"+t+"_"+e.filterID);e.container.selectAll(e.overallSelector).filter(e.overallFilterFunc).classed(n,!0);switch(this.push({id:t,attr:i,sign:n,func:r,type:a}),a){case"reduce":this.reducers.push(n);break;case"filter":this.filters.push(n);break;case"pick":this.pickers.push(n)}return e.filterID++,e.filterID-1},this.filterers.findID=function(t){return this.findIndex(function(e){return e.id==t})},this.filterers.fitFilters=function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this.filters:[].concat(s()(this.filters),s()(this.otherFilters)),r=!0,a=0;a<i.length;a++){var n=i[a];if(n!=e&&!d3.select(t).classed(n)){r=!1;break}}return r&&(r=this.fitReducers(t,e)),r},this.filterers.fitPickers=function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this.pickers:[].concat(s()(this.pickers),s()(this.otherPickers)),r=!1,a=0;a<i.length;a++){var n=i[a];if((null==e||e!=n)&&d3.select(t).classed(n)){r=!0;break}}if(r){var l=this.fitReducers(t,e);r!=l&&(r=l)}return r},this.filterers.fitReducers=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this.reducers:[].concat(s()(this.reducers),s()(this.otherReducers)),r=!0;if(i.length>0)for(var a=0;a<i.length;a++){var n=i[a];if(n!=e&&!d3.select(t).classed(n)){r=!1;break}}return r},this.filterers.getPickers=function(i,r){var n=this,s=e.container.selectAll(e.overallSelector).filter(e.overallFilterFunc).filter(function(){return n.fitPickers(this,r)})._groups[0],l=new a.a,o=e.overallKey;i.each(function(){l.add(t(this).attr(o))});for(var h=0;h<s.length;h++){var c=t(s[h]).attr(o);l.has(c)||i._groups[0].push(s[h])}},this.filterers.restoreOthers=function(t){for(var i=this.filters,r=e.container.selectAll(e.overallSelector).filter(e.overallFilterFunc).classed(t,!0),a=function(e){var a=i[e];if(a==t)return"continue";r=r.filter(function(){return d3.select(this).classed(a)})},n=0;n<i.length;n++)a(n);return r}}},{key:"setStatic",value:function(t,e,i){var r=this.static,a=(this.filterers,this.container.selectAll(this.overallSelector).filter(this.overallFilterFunc)._groups[0].length==i),n=t;if(null!=r&&!n.empty())for(var s=r.attrs,l=r.match,o=r.miss,h=r.normal,c=0;c<s.length;c++){var u=s[c],d=null==h||h[c];if("class"==u){var f=d?e:!a&&e;"chosen"==l[c]&&null!=l[c]&&n.classed(l[c],f),null!=o[c]&&n.classed(o[c],!f)}else{var p=e?l[c]:o[c],v=e?o[c]:l[c],g=d?p:a?p:v;n.attr(u,g)}}}},{key:"setAnimation",value:function(t,e){var i=this.animation;"function"==typeof i?i(t,e):t.interrupt().transition().duration(i.duration).attr(i.attr,e?i.match():i.miss())}},{key:"filterChange",value:function(t,e,i,r){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=this.filterers.findID(t);-1==s&&(s=this.filterers.add(t,e,r,n?"reduce":"filter"));var l=this.filterers,o=l[s],h=o.sign,c=h+"_old",u=(this.animation,new a.a(i)),d=o.func,f=o.attr,p=this.container.selectAll(this.overallSelector+"."+h).filter(this.overallFilterFunc).classed(c,!0).classed(h,!1),v=this.container.selectAll(this.overallSelector).filter(this.overallFilterFunc).filter(function(){var t=d3.select(this).attr(f);return null==d?u.has(t):d(t)}).filter(function(){return l.fitFilters(this,h)}).classed(h,!0);l.getPickers(v);var g=v.filter(function(){return!d3.select(this).classed(c)}),y=p.filter(function(){return!d3.select(this).classed(h)});return this.container.selectAll("."+c).classed(c,!1),this.setStatic(g,!0,g[0].length),this.setStatic(y,!1,y[0].length),this.setAnimation(g,!0),this.setAnimation(y,!1),v}},{key:"pick",value:function(t,e,i,r){var n,s=this.filterers.findID(t);-1==s&&(s=this.filterers.add(t,e,r,"pick"));var l=this.filterers,o=l[s],h=o.sign,c=new a.a(i),u=o.func,d=o.attr;null!=r&&(o.func=u=r),this.restore(t,!1);var f=this.container.selectAll(this.overallSelector).filter(this.overallFilterFunc).filter(function(){var t=void 0;return t="data"==d?d3.select(this).data():d3.select(this).attr(d),null==u?c.has(t):u(t)}).filter(function(){return l.fitReducers(this)}).classed(h,!0);l.getPickers(f,h),n=f;var p=f._groups[0].length;return null!=this.subSelector&&(f=f.selectAll(this.subSelector)),this.setStatic(f,!0,p),this.setAnimation(f,!0),n}},{key:"filter",value:function(t,e,i,r){var n,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=this.filterers.findID(t);-1==l&&(l=this.filterers.add(t,e,r,s?"reduce":"filter"));var o=this.filterers,h=o[l],c=h.sign,u=new a.a(i),d=h.func,f=h.attr;null!=r&&(h.func=d=r),this.restore(t,!1);var p=this.container.selectAll(this.overallSelector).filter(this.overallFilterFunc).filter(function(){var t=void 0;return t="data"==f?d3.select(this).data():d3.select(this).attr(f),null==d?u.has(t):d(t)}).filter(function(){return o.fitFilters(this,c)}).classed(c,!0);o.getPickers(p),n=p;var v=p._groups[0].length;return null!=this.subSelector&&(p=p.selectAll(this.subSelector)),this.setStatic(p,!0,v),this.setAnimation(p,!0),n}},{key:"restore",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.filterers.find(function(e){return e.id==t});if(null==i)return null;var r=i.sign,a="pick"==i.type,n="reduce"==i.type,s=this.filterers,l=void 0,o=!0,h=this.container.selectAll(this.overallSelector).filter(this.overallFilterFunc);if(l=a?h.classed(r,!1):s.restoreOthers(r).classed(r,e),!a&&this.filterers.pickers.length>0){var c=l.filter(function(){return!s.fitPickers(this)});c._groups[0].length!=l._groups[0].length&&(o=!1,l=c)}var u=l._groups[0].length,d=!!e&&o;d&&(l=l.filter(function(){return s.fitReducers(this)})),null!=this.subSelector&&(l=l.selectAll(this.subSelector)),this.setStatic(l,d,u),this.setAnimation(l,d);var f=void 0;return e&&(f=n?h:h.filter(function(){return s.fitPickers(this)&&s.fitReducers(this)})),f}},{key:"getOther",value:function(t){var e=this.filterers,i=void 0;switch(t){case"reduce":i=e.otherReducers;break;case"filter":i=e.otherFilters;break;case"pick":i=e.otherPickers}return i}},{key:"get",value:function(t){var e=this.filterers,i=void 0;switch(t){case"reduce":i=e.reducers;break;case"filter":i=e.filters;break;case"pick":i=e.pickers}return i}},{key:"set",value:function(t,e){var i=this.filterers,r=void 0;switch(t){case"reduce":r=i.otherReducers;break;case"filter":r=i.otherFilters;break;case"pick":r=i.otherPickers}for(var a=0;a<e.length;a++){var n=e[a];r.indexOf(n)<0&&r.push(n)}}}]),e}();function b(e,i,r){if(null==e||e.empty())return null;var a=new Array;return null==i&&null==r?e:(null!=i?e.each(function(){a.push(t(this).attr(i))}):"function"==typeof r&&e.each(function(t){var e=r(this,t);a.push(e)}),a)}}).call(e,i("4kSj"))},"49/g":function(t,e,i){"use strict";var r=i("yqkC"),a={dimensions:{width:512,height:512}};a.colormap=r,a.context=null,a.init=function(t){var e=document.createElement("canvas");e.id="colormap",e.width=String(a.dimensions.width),e.height=String(a.dimensions.height),e.style="display:none",document.body.appendChild(e),a.context=e.getContext("2d");var i=new Image;i.onload=function(){a.context.drawImage(i,0,0),t()},i.src=a.colormap},a.ranges={x:[0,1],y:[0,1]},a.getScaledX=function(t){return(t+1-(a.ranges.x[0]+1))/(a.ranges.x[1]+1-(a.ranges.x[0]+1))*(a.dimensions.width-1)},a.getScaledY=function(t){return(t+1-(a.ranges.y[0]+1))/(a.ranges.y[1]+1-(a.ranges.y[0]+1))*(a.dimensions.height-1)},a.setColormap=function(t,e){a.colormap=t,null!==document.getElementById("colormap")&&(document.getElementById("colormap").outerHTML="",document.getElementById("colormap")),a.init(e)},a.getColor=function(t,e){var i=a.context.getImageData(a.getScaledX(t),a.getScaledY(e),1,1);return[i.data[0],i.data[1],i.data[2]]},e.a=a},"8KhV":function(t,e){},"9M+g":function(t,e){},BJfj:function(t,e,i){"use strict";var r=i("Dd8w"),a=i.n(r),n=i("NYxO"),s={name:"SubPanel",data:function(){return{legends:["National&nbsp;capital","Provincial&nbsp;capital","Land&nbsp;route","Sea&nbsp;route"],currMode:"browse",modes:["browse","airTravel","groundTravel"],modeTexts:["Browse","Travel in the air","Travel on the ground"],currScaleLevel:0,scaleLevel:{0:"National level",1:"Provincial level",2:"Urban level"}}},mounted:function(){this.$nextTick(function(){this.drawLegendIcon();var t=parseFloat(d3.select(this.$el).style("width")),e=parseFloat(d3.select(this.$el).select(".mapScaleBtnGroup").style("height")),i=parseFloat(d3.select(this.$el).select(".mapScaleText").style("height"));d3.select(this.$el).select(".mapScaleText").style("top",(e-i)/2+"px");var r=parseFloat(d3.select(this.$el).select(".mapScaleBtnGroup").select("button").style("width"));d3.select(this.$el).select(".mapScaleText").style("left",r+t/17.5+"px"),d3.select(this.$el).select(".mapScaleBtnGroup").selectAll("button").on("mouseover",function(){d3.select(this).classed("mapScaleBtnHovered",!0).classed("mapScaleBtnUnhovered",!1)}).on("mouseout",function(){d3.select(this).classed("mapScaleBtnHovered",!1).classed("mapScaleBtnUnhovered",!0)})})},computed:a()({},Object(n.c)(["updateMap","changeLevelByMap"])),watch:{updateMap:function(){d3.select("#mapPanel").style("visibility","visible")},changeLevelByMap:function(t){var e=void 0;e=void 0===t.level?2:t.level,this.currScaleLevel=e}},methods:a()({},Object(n.b)(["updateChangeLevelByPanel","updateChangeMode"]),{changeMode:function(t){this.updateChangeMode({mode:t})},changeScale:function(t){"plus"===t?(this.currScaleLevel+=1,this.updateChangeLevelByPanel({level:this.currScaleLevel})):"minus"===t&&(this.currScaleLevel-=1,this.updateChangeLevelByPanel({level:this.currScaleLevel}))},drawLegendIcon:function(){this.d3el=d3.select(this.$el);var t=this,e=Math.min(this.d3el.select(".mapLegend").node().getBoundingClientRect().width,this.d3el.select(".mapLegend").node().getBoundingClientRect().height);this.d3el.selectAll(".mapLegendIcon").each(function(i,r){var a=d3.select(this).append("svg").attr("width",e).attr("height",e);switch(t.legends[r]){case"National&nbsp;capital":!function(t,e){var i=t.append("g").attr("transform","translate("+e/2+", "+e/2+")"),r=e/2,a=.3*r,n=.6*r,s=.2*r;i.append("circle").attr("cx",0).attr("cy",0).attr("r",n).style("fill","#fff").style("stroke","#000").style("stroke-width",s),i.append("circle").attr("cx",0).attr("cy",0).attr("r",a).style("fill","#000")}(a,e);break;case"Provincial&nbsp;capital":!function(t,e){var i=t.append("g").attr("transform","translate("+e/2+", "+e/2+")"),r=e/2*.45,a=e/2*.2;i.append("circle").attr("cx",0).attr("cy",0).attr("r",r).style("fill","#fff").style("stroke","#000").style("stroke-width",a)}(a,e);break;case"Harbor":!function(t,e){var i=.012,r=t.append("g").attr("transform","translate("+e/2+", "+e/2+")scale("+i+")").style("opacity",0);r.append("path").attr("d","M512 0C375.467 0 273.067 106.974 273.067 238.933a238.387 238.387 0 0 0 170.666 227.874V879.07c-63.488-11.264-128-37.547-180.77-86.699C191.078 725.47 136.67 618.974 136.67 443.597a68.267 68.267 0 1 0-136.67 0C0 648.602 69.086 798.31 169.984 892.245 270.882 986.25 398.541 1024 512 1024c113.732 0 241.323-38.23 342.153-132.437s169.71-243.917 169.71-447.966c4.438-95.232-140.834-95.232-136.396 0 0 174.285-54.614 280.917-126.498 348.16-52.839 49.288-117.283 75.776-180.702 87.176V467.081a238.524 238.524 0 0 0 170.666-228.148C750.933 106.973 648.533 0 512 0z m0 136.533a102.4 102.4 0 1 1 0 204.8 102.4 102.4 0 0 1 0-204.8z");var a=r.node().getBoundingClientRect();r.attr("transform",function(){return function(t,r){var a=[e/2,e/2];return"translate("+[a[0]-r.width/2,a[1]-r.height/2]+")scale("+i+")"}(0,a)}).style("opacity",1)}(a,e);break;case"Land&nbsp;route":!function(t,e){var i=.7*e,r=(e-i)/2,a=[[r,e/2],[r+i,e/2]];t.append("g").append("path").attr("d",d3.line()(a)).style("stroke","#5a5a5a").style("fill","none").style("stroke-width",e/9)}(a,e);break;case"Sea&nbsp;route":!function(t,e){var i=1*e,r=(e-i)/2,a=[[r,e/2],[r+i,e/2]];t.append("g").append("path").attr("d",d3.line()(a)).style("stroke","#5a5a5a").style("fill","none").style("stroke-width",e/10).style("stroke-dasharray",4)}(a,e)}})}})},l={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"mapPanel"}},[i("el-row",[i("el-col",[i("div",{staticClass:"mapPanelContent"},[t._v("\n        Legends\n      ")])])],1),t._v(" "),t._l(t.legends,function(e){return[i("el-row",{key:e,staticClass:"mapLegend"},[i("el-col",{attrs:{span:4}},[i("div",{staticClass:"mapLegendIcon"})]),t._v(" "),i("el-col",{attrs:{span:20}},[i("div",{staticClass:"mapLegendContent",domProps:{innerHTML:t._s(e)}})])],1)]}),t._v(" "),i("el-row",[i("el-col",[i("div",{staticClass:"mapPanelContent"},[t._v("\n        Exploration mode\n      ")])])],1),t._v(" "),t._l(t.modes,function(e,r){return i("div",{key:e,staticClass:"mapMode"},[i("el-radio-group",{on:{change:t.changeMode},model:{value:t.currMode,callback:function(e){t.currMode=e},expression:"currMode"}},[i("el-radio",{attrs:{label:e}},[t._v(t._s(t.modeTexts[r]))])],1)],1)}),t._v(" "),i("el-row",[i("el-col",[i("div",{staticClass:"mapPanelContent"},[t._v("\n        Scale\n      ")])])],1),t._v(" "),i("div",{staticClass:"mapScale"},[i("div",{staticClass:"mapScaleBtnGroup"},[i("div",{staticClass:"mapScaleBtn",attrs:{id:"mapScaleBtnPlus"}},[i("el-button",{attrs:{plain:"",icon:"el-icon-plus",size:"mini",disabled:2===t.currScaleLevel},on:{click:function(e){return t.changeScale("plus")}}})],1),t._v(" "),i("div",{staticClass:"mapScaleBtn",attrs:{id:"mapScaleBtnMinus"}},[i("el-button",{attrs:{plain:"",icon:"el-icon-minus",size:"mini",disabled:0===t.currScaleLevel},on:{click:function(e){return t.changeScale("minus")}}})],1)]),t._v(" "),i("div",{staticClass:"mapScaleText",domProps:{innerHTML:t._s(t.scaleLevel[t.currScaleLevel])}})])],2)},staticRenderFns:[]};var o=i("VU/8")(s,l,!1,function(t){i("FweK")},null,null);e.a=o.exports},FweK:function(t,e){},GYmq:function(t,e){},Jmt5:function(t,e){},Lsc3:function(t,e,i){"use strict";var r=function(t){var e=function(t){var e,i=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.push(e);return i},i=function(t,e){return parseFloat(t)-parseFloat(e)},r=function(t,r,a,n){n=n||1/0;var s,l={},o={0:[r]},h={},c=function(t,e){var i=""+t;o[i]||(o[i]=[]),o[i].push(e)};for(l[r]=0;o&&(s=e(o)).length;){s.sort(i);var u=s[0],d=o[u],f=d.shift(),p=parseFloat(u),v=t[f]||{};for(var g in d.length||delete o[u],v)if(Object.prototype.hasOwnProperty.call(v,g)){var y=v[g]+p,m=l[g];(void 0===m||m>y)&&(l[g]=y,c(y,g),h[g]=f)}}return void 0===l[a]?null:h},a=function(t,e){for(var i=[],r=e;void 0!==r;)i.push(r),r=t[r];return i.reverse(),i},n=function(t,e){for(var i,n,s,l=e.shift(),o=[];e.length;){if(i=e.shift(),!(n=r(t,l,i)))return null;if(s=a(n,i),!e.length)return o.concat(s);o.push.apply(o,s.slice(0,-1)),l=i}},s=function(t,e){try{return Array.prototype.slice.call(t,e)}catch(n){for(var i=[],r=e||0,a=t.length;r<a;++r)i.push(t[r]);return i}},l=function(t){this.map=t};return l.prototype.findShortestPath=function(t,e){return"[object Array]"===Object.prototype.toString.call(t)?n(this.map,t):2===arguments.length?n(this.map,[t,e]):n(this.map,s(arguments))},l.findShortestPath=function(t,e,i){return"[object Array]"===Object.prototype.toString.call(e)?n(t,e):3===arguments.length?n(t,[e,i]):n(t,s(arguments,1))},l}();e.a=r},NHnr:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i("woOf"),a=i.n(r),n=i("mvHQ"),s=i.n(n),l=i("7+uW"),o=i("Uhku"),h={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"main"}},[i("div",{attrs:{id:"toolbar"}},[i("b-navbar",{attrs:{id:"navbar",toggleable:"md",type:"dark",variant:"info"}},[i("b-navbar-brand",{attrs:{href:"#"}},[t._v("Subspace Map")]),t._v(" "),i("b-collapse",{attrs:{"is-nav":"",id:"nav_collapse"}},[i("b-nav-item-dropdown",{attrs:{id:"my-dropdown",left:""}},[i("template",{slot:"button-content"},[t._v("Data")]),t._v(" "),t._l(t.fileList,function(e){return i("b-dropdown-item",{key:e,on:{click:function(i){return t.changeData(e)}}},[t._v(t._s(e))])})],2)],1)],1)],1),t._v(" "),i("section",{attrs:{id:"subListContainer"}},[i("SubList")],1),t._v(" "),i("section",{attrs:{id:"subMapContainer"}},[i("SubMap")],1),t._v(" "),i("div",{attrs:{id:"dimGlyphContainer"}},[i("svg",{attrs:{id:"dimGlyphSvg"}})]),t._v(" "),i("section",{attrs:{id:"subProjContainer"}},[i("SubProj")],1),t._v(" "),i("LoadingPage")],1)},staticRenderFns:[]};var c=function(t){i("WCga")},u={name:"App",components:{Main:i("VU/8")(o.a,h,!1,c,"data-v-32cce774",null).exports},methods:{},mounted:function(){}},d={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("Main")],1)},staticRenderFns:[]};var f=i("VU/8")(u,d,!1,function(t){i("GYmq")},null,null).exports,p=i("/ocq");l.default.use(p.a);var v=new p.a({mode:"history"}),g=i("4kSj"),y=i.n(g),m="http://127.0.0.1:22068/",b=i("mtWM");function S(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}function w(t,e,i,r,a){i&&(i=function t(e){for(var i in e)null===e[i]&&delete e[i],"string"===S(e[i])?e[i]=e[i].trim():"object"===S(e[i])?e[i]=t(e[i]):"array"===S(e[i])&&(e[i]=t(e[i]));return e}(i)),b({method:t,url:e,data:"POST"===t||"PUT"===t?i:null,params:"GET"===t||"DELETE"===t?i:null,baseURL:m,withCredentials:!1}).then(function(t){t.data?r&&r(t.data):a?a(t.data):window.alert("error: "+s()(t.data))}).catch(function(t){console.log("err: ",t);var e=t.response;t&&console.log("api error, HTTP CODE: "+e)})}var D,x={get:function(t,e,i,r){return w("GET",t,e,i,r)},post:function(t,e,i,r){return w("POST",t,e,i,r)},put:function(t,e,i,r){return w("PUT",t,e,i,r)},delete:function(t,e,i,r){return w("DELETE",t,e,i,r)}},P=i("zL8q"),C=i.n(P),M=(i("tvR6"),i("//63"),i("Tqaz")),A=(i("Jmt5"),i("9M+g"),i("vwbq")),I=i("1EFM"),R=i("NYxO"),k={loadingPage:null,loadedData:null,updateSubList:{},updateMapByDim:{},updateMapBySub:{},changeLevelByPanel:{},changeLevelByMap:{},changeMode:{},drawProjection:{},changeProjInBrowseMode:{},updateMap:{},resize:null,changeSubProjOpacity:{}},T={loadingPage:function(t){return t.loadingPage},loadedData:function(t){return t.loadedData},updateSubList:function(t){return t.updateSubList},updateMapByDim:function(t){return t.updateMapByDim},updateMapBySub:function(t){return t.updateMapBySub},changeLevelByPanel:function(t){return t.changeLevelByPanel},changeLevelByMap:function(t){return t.changeLevelByMap},changeMode:function(t){return t.changeMode},drawProjection:function(t){return t.drawProjection},changeProjInBrowseMode:function(t){return t.changeProjInBrowseMode},updateMap:function(t){return t.updateMap},resize:function(t){return t.resize},changeSubProjOpacity:function(t){return t.changeSubProjOpacity}},j=i("bOdI"),_=i.n(j),L=i("fZjL"),O=i.n(L),N={UPDATE_LOADING_PAGE:"UPDATE_LOADING_PAGE",UPDATE_UPDATE_SUB_LIST:"UPDATE_UPDATE_SUB_LIST",UPDATE_UPDATE_MAP_BY_DIM:"UPDATE_UPDATE_MAP_BY_DIM",UPDATE_UPDATE_MAP_BY_SUB:"UPDATE_UPDATE_MAP_BY_SUB",UPDATE_CHANGE_LEVEL_BY_PANEL:"UPDATE_CHANGE_LEVEL_BY_PANEL",UPDATE_CHANGE_LEVEL_BY_MAP:"UPDATE_CHANGE_LEVEL_BY_MAP",UPDATE_CHANGE_MODE:"UPDATE_CHANGE_MODE",UPDATE_DRAW_PROJECTION:"UPDATE_DRAW_PROJECTION",UPDATE_CHANGE_PROJ_IN_BROWSE_MODE:"UPDATE_CHANGE_PROJ_IN_BROWSE_MODE",UPDATE_UPDATE_MAP:"UPDATE_UPDATE_MAP",UPDATE_RESIZE:"UPDATE_RESIZE",UPDATE_CHANGE_SUB_PROJ_OPACITY:"UPDATE_CHANGE_SUB_PROJ_OPACITY"},F=(D={},_()(D,N.UPDATE_LOADING_PAGE,function(t,e){t.loadingPage=e}),_()(D,N.UPDATE_UPDATE_SUB_LIST,function(t,e){var i={};O()(e).forEach(function(t){i[t]=e[t]}),t.updateSubList=i}),_()(D,N.UPDATE_UPDATE_MAP_BY_DIM,function(t,e){var i={};O()(e).forEach(function(t){i[t]=e[t]}),t.updateMapByDim=i}),_()(D,N.UPDATE_UPDATE_MAP_BY_SUB,function(t,e){var i={};O()(e).forEach(function(t){i[t]=e[t]}),t.updateMapBySub=i}),_()(D,N.UPDATE_CHANGE_LEVEL_BY_PANEL,function(t,e){var i={};O()(e).forEach(function(t){i[t]=e[t]}),t.changeLevelByPanel=i}),_()(D,N.UPDATE_CHANGE_LEVEL_BY_MAP,function(t,e){var i={};O()(e).forEach(function(t){i[t]=e[t]}),t.changeLevelByMap=i}),_()(D,N.UPDATE_CHANGE_MODE,function(t,e){var i={};O()(e).forEach(function(t){i[t]=e[t]}),t.changeMode=i}),_()(D,N.UPDATE_DRAW_PROJECTION,function(t,e){var i={};O()(e).forEach(function(t){i[t]=e[t]}),t.drawProjection=i}),_()(D,N.UPDATE_CHANGE_PROJ_IN_BROWSE_MODE,function(t,e){var i={};O()(e).forEach(function(t){i[t]=e[t]}),t.changeProjInBrowseMode=i}),_()(D,N.UPDATE_UPDATE_MAP,function(t,e){var i={};O()(e).forEach(function(t){i[t]=e[t]}),t.updateMap=i}),_()(D,N.UPDATE_RESIZE,function(t,e){t.resize=Math.random()}),_()(D,N.UPDATE_CHANGE_SUB_PROJ_OPACITY,function(t,e){var i={};O()(e).forEach(function(t){i[t]=e[t]}),t.changeSubProjOpacity=i}),D),B={updateLoadingPage:function(t,e){(0,t.commit)(N.UPDATE_LOADING_PAGE,e)},updateUpdateSubList:function(t,e){(0,t.commit)(N.UPDATE_UPDATE_SUB_LIST,e)},updateUpdateMapByDim:function(t,e){(0,t.commit)(N.UPDATE_UPDATE_MAP_BY_DIM,e)},updateUpdateMapBySub:function(t,e){(0,t.commit)(N.UPDATE_UPDATE_MAP_BY_SUB,e)},updateChangeLevelByPanel:function(t,e){(0,t.commit)(N.UPDATE_CHANGE_LEVEL_BY_PANEL,e)},updateChangeLevelByMap:function(t,e){(0,t.commit)(N.UPDATE_CHANGE_LEVEL_BY_MAP,e)},updateChangeMode:function(t,e){(0,t.commit)(N.UPDATE_CHANGE_MODE,e)},updateDrawProjection:function(t,e){(0,t.commit)(N.UPDATE_DRAW_PROJECTION,e)},updateChangeProjInBrowseMode:function(t,e){(0,t.commit)(N.UPDATE_CHANGE_PROJ_IN_BROWSE_MODE,e)},updateUpdateMap:function(t,e){(0,t.commit)(N.UPDATE_UPDATE_MAP,e)},updateResize:function(t,e){(0,t.commit)(N.UPDATE_RESIZE,e)},updateChangeSubProjOpacity:function(t,e){(0,t.commit)(N.UPDATE_CHANGE_SUB_PROJ_OPACITY,e)}};i("sax8");l.default.use(R.a);var E=new R.a.Store({state:k,getters:T,mutations:F,actions:B,plugins:[]});l.default.config.productionTip=!1,l.default.prototype.$api=x;window.$=y.a,window.CommunicateWithServer=function(t,e,i,r){var a=new URLSearchParams;a.append("params",s()(e)),"get"==t?x.get(i,a,function(t){r(t)},function(t){r(t)}):"post"==t&&x.post(i,a,function(t){r(t)},function(t){r(t)})},l.default.use(C.a),l.default.use(M.a),l.default.config.productionTip=!1,window.d3=A,a()(A,I),window.Data=null,window.ratio2percent=function(t){return 100*t+"%"},window.ratio2px=function(t,e){return t*e},window.toPX=i("fF8k"),Array.prototype.remove=function(){for(var t=void 0,e=arguments,i=e.length,r=void 0;i&&this.length;)for(t=e[--i];-1!==(r=this.indexOf(t));)this.splice(r,1);return this},window.getTransformation=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttributeNS(null,"transform",t);var i,r,a,n=e.transform.baseVal.consolidate().matrix,s=n.a,l=n.b,o=n.c,h=n.d,c=n.e,u=n.f;return(i=Math.sqrt(s*s+l*l))&&(s/=i,l/=i),(a=s*o+l*h)&&(o-=s*a,h-=l*a),(r=Math.sqrt(o*o+h*h))&&(o/=r,h/=r,a/=r),s*h<l*o&&(s=-s,l=-l,a=-a,i=-i),{translateX:c,translateY:u,rotate:180*Math.atan2(l,s)/Math.PI,skewX:180*Math.atan(a)/Math.PI,scaleX:i,scaleY:r}},window.setProjPointsOpacity=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;A.selectAll(".projPoints").filter(function(){return A.select(this).attr("digit")===String(t)}).style("fill-opacity",e),A.selectAll(".projPoints").filter(function(){return A.select(this).attr("digit")!==String(t)}).style("fill-opacity",.01)},window.resetProjPointsOpacity=function(){A.selectAll(".projPoints").each(function(){var t=Number(A.select(this).attr("opc"));A.select(this).style("fill-opacity",t)})},new l.default({el:"#app",store:E,router:v,components:{App:f},template:"<App/>"})},PJka:function(t,e,i){"use strict";(function(t){var r=i("fZjL"),a=i.n(r),n=i("mvHQ"),s=i.n(n),l=i("gRE1"),o=i.n(l),h=i("lHA8"),c=i.n(h),u=i("BO1k"),d=i.n(u),f=i("pFYg"),p=i.n(f),v=i("c/Tr"),g=i.n(v),y=i("ifoU"),m=i.n(y),b=i("Zrlr"),S=i.n(b),w=i("wxAW"),D=i.n(w),x=i("NnIC"),P=i.n(x),C=i("Gu7T"),M=i.n(C),A=i("Dd8w"),I=i.n(A),R=i("NYxO"),k=i("wCY+"),T=i("umFo"),j=i("3su0"),_=i("X8Br"),L=i("Lsc3"),O=i("BJfj"),N=i("by4E");e.a={name:"SubMap",components:{MapPanel:O.a},data:function(){return{seaRouteDuration:2500}},mounted:function(){},computed:I()({},Object(R.c)(["loadedData","updateMapByDim","updateMapBySub","changeLevelByPanel","changeMode","resize"])),watch:{loadedData:function(t,e){this.updateParams(),null!=e?this.redraw():(this.init(),this.draw())},resize:function(t){this.updateParams(),this.redraw()},updateMapByDim:function(t){this.interactions.filterByDims(t.dimStates)},updateMapBySub:function(t){switch(t.type){case"hover":this.interactions.filterByIDs(t.subIds);break;case"click":this.interactions.pinByIDs(t.subIds)}},changeLevelByPanel:function(t){var e=this.d3el.select(".SubMapTiling"),i=void 0;i=null!==e.attr("transform")?this.getTranslate(e).map(function(t){return-t}):[0,0],this.visible.toLevel(e.node(),i,t.level,this.transition.long)},changeMode:function(t,e){switch(void 0!==e.mode&&(this.prevMode=e.mode),t.mode){case"browse":this.resetSubList(),this.updateUpdateSubList({path2This:null,type:"unclick"}),"groundTravel"===this.prevMode&&(this.updateUpdateSubList({path2This:void 0,subIds:[].concat(M()(Array(Data.subs.length).keys())),type:"changeShownItems"}),this.resetCapsOpacity(),this.unselectRoute(),this.resetTravelRouteSubs()),this.d3el.select(".SubMapTiling").selectAll(".travelIcon").remove(),this.d3el.select(".SubMapTiling").selectAll(".SubMapGrids").classed("travelUnselected",!1).classed("gridClicked",!1).classed("gridUnhovered",!1).attr("cursor","pointer").attr("opacity",1).on("mouseover",null).on("mouseout",null).on("click",null),this.recoverElemOrder(),this.bindSubMapClustersEvent();break;case"airTravel":if("groundTravel"===this.prevMode)this.resetCapsOpacity(),this.resetTravelRouteSubs(),this.updateUpdateSubList({path2This:void 0,subIds:[].concat(M()(Array(Data.subs.length).keys())),type:"changeShownItems"}),this.unselectRoute(),this.d3el.select(".SubMapTiling").selectAll(".travelIcon").remove(),this.d3el.select(".SubMapTiling").selectAll(".SubMapGrids").classed("travelUnselected",!1).classed("gridClicked",!1).attr("cursor","pointer").attr("opacity",1).on("mouseover",null).on("mouseout",null).on("click",null);this.resetSubList(),this.airTravelMode();break;case"groundTravel":if("airTravel"===this.prevMode)this.d3el.select(".SubMapTiling").selectAll(".SubMapGrids").classed("gridUnhovered",!1).classed("gridClicked",!1).on("mouseover",null).on("mouseout",null).on("click",null),this.d3el.select(".SubMapTiling").selectAll(".travelIcon").remove();this.resetSubList(),this.groundTravelMode()}}},methods:I()({},Object(R.b)(["updateLoadingPage","updateUpdateMap","updateUpdateSubList","updateChangeLevelByMap","updateDrawProjection","updateChangeProjInBrowseMode","updateChangeSubProjOpacity"]),{updateParams:function(){var t,e;this.width=this.$el.offsetWidth,this.height=this.$el.offsetHeight,this.d3el=d3.select(this.$el).select("#map"),this.mapWidth=parseFloat(this.d3el.style("width")),this.mapHeight=parseFloat(this.d3el.style("height")),this.fCodes=function(t){for(var e=new Array(t[0].length),i=0;i<e.length;i++)e[i]=i;return{codes:t,dataIndeces:null,dimIndeces:e}}(Data.subs),this.fMatrix=(Data.subs,this.fCodes.dataIndeces,t=function(){for(var t=new Array(Data.subs.length),e=0;e<t.length;e++)t[e]=new Array(Data.subs.length);for(var i=0;i<t.length-1;i++)for(var r=i+1;r<t[i].length;r++){for(var a=Data.subs[i],n=Data.subs[r],s=0,l=0;l<a.length;l++)a[l]!==n[l]&&s++;t[i][r]=s}return t}(),e=Math.max.apply(Math,M()(Data.subDistMat.map(function(t){return Math.max.apply(Math,M()(t))}))),{neighbors:Data.subKNN,distMat:Data.subDistMat,diffMat:t,distExt:e,colors:Data.colors}),this.overallClusters={clusters:null,level:null,paths:null,aggregate:null},this.currClusters={clusters:null,level:null,paths:null,aggregate:null},this.dimCounts=null,this.showSize=Math.min(this.mapWidth,this.mapHeight),this.canvasSize=340,this.scales={x:d3.scaleLinear().domain([0,1]).range([.5*-this.canvasSize,.5*this.canvasSize]),y:d3.scaleLinear().domain([0,1]).range([.5*-this.canvasSize,.5*this.canvasSize])},this.transition={duration:500,long:2e3,short:400,interval:50},this.pattern=!0,this.interactions={ready:!1,hoveredID:null},this.clsColorReady=!1,this.ovlDataWeights=null,this.sizeTolr=1e3*P.a*(this.showSize/this.canvasSize),this.snapshotPar={ringR:null,ringRRatio:.5,marginRatio:.01,sshotR:null,sshotRRatio:.05,outR:null,anchorR:4,angInterval:2},this.color={h:d3.scaleLinear().domain([0,1]).range([0,360]),c:d3.scaleLinear().domain([0,1]).range([30,80]),l:d3.scaleLinear().domain([0,1]).range([45,90])},this.travelIcon="M513.127753 0C298.854626 0 125.180617 171.418502 125.180617 381.180617c0 164.651982 239.0837 484.933921 340.581498 620.264317 11.277533 13.53304 27.066079 22.555066 45.110132 22.555066s36.088106-9.022026 47.365638-22.555066c101.497797-135.330396 340.581498-455.612335 340.581498-620.264317C901.07489 171.418502 725.145374 0 513.127753 0z m0 518.76652c-90.220264 0-164.651982-72.176211-164.651982-162.396476s74.431718-162.396476 164.651982-162.396476 164.651982 72.176211 164.651983 162.396476-74.431718 162.396476-164.651983 162.396476z",this.travelIconScale="Iris"===Data.file?.02:.008,this.currTime=0,this.travelIconPos=null,this.isTravelIconDragging=!1,this.subMapClustersEvent=null,this.prevMode="browse"},init:function(){this.svg=this.d3el.append("svg").attr("width",this.mapWidth).attr("height",this.mapHeight).append("g").attr("id","mapSvg").attr("transform","translate("+this.mapWidth/2+", "+this.mapHeight/2+")scale("+this.showSize/this.canvasSize+")")},redraw:function(){this.clear(),this.init(),this.draw()},clear:function(){d3.select(this.$el).select("#map").selectAll("*").remove()},draw:function(){var e=this,i=t.Deferred(),r=t.Deferred();this.initInteractions(),this.clustering(i),t.when(i).done(function(){e.showTiling(r)}),t.when(r).done(function(){setTimeout(function(){d3.select("#loading-page").style("display","none")},1e3)})},getTranslate:function(t){var e=t.attr("transform"),i=e.indexOf("("),r=e.indexOf(","),a=e.indexOf(")");return[parseFloat(e.substring(i+1,r)),parseFloat(e.substring(r+1,a))]},initInteractions:function(){var e=this,i=this.d3el,r=Data,a=this.interactions,n=this.transition.duration,s=this.fCodes,l=e.d3el;a.ready||(a.ready=!0,a.duration=n,a.container=e.d3el,a.clickTimer=null,a.checkRelation=function(t,e,i){var r=!1,a=!1,n=!0,s=void 0;switch(i){case"fellows":n=r=e.length===t.length,a=!0;break;case"brothers":r=e.length===t.length,s=t.length-1;break;case"descendants":r=e.length>t.length,s=t.length}if(a)return n;if(!r)return!1;for(var l=0;l<s;l++)if(e[l]!==t[l]){n=!1;break}return"brothers"===i&&(n=n&&e[s]!==t[s]),n},a.standOut=function(e,i){d3.select(e).selectAll("line").classed("chosen",!0).interrupt().transition().duration(n).attr("stroke","#000").attr("stroke-opacity",1);var r=l.selectAll(".SubMapSShot").filter(function(){return d3.select(this).attr("clsID")===i});E(r[0],t(r[0]).parent()[0])},a.fadeOutAll=function(){l.selectAll(".SubMapClusters path").interrupt().transition().duration(n).attr("fill-opacity",0),l.selectAll(".SubMapClusters line").classed("chosen",!1).interrupt().transition().duration(n).attr("stroke","#666").attr("stroke-opacity",.8)},a.fadeOutOthers=function(t){var e=l.selectAll(".SubMapClusters").filter(function(e,i){return t!==d3.select(this).attr("class")});e.selectAll("path").interrupt().transition().duration(n).attr("fill-opacity",.8),e.selectAll("line").interrupt().transition().duration(n).attr("stroke-opacity",0)},a.saveBrothers=function(t){var e=this.checkRelation,i=l.selectAll(".SubMapClusters").filter(function(i,r){var a=d3.select(this).attr("clsID");if(null!=a&&(a=a.split("_")),d3.select(this).classed("Outliers")){var n=t.slice(0,t.length-1);return e(n,a,"descendants")}return e(t,a,"brothers")});i.selectAll("path").interrupt().transition().duration(n).attr("fill-opacity",.1),i.selectAll("line").interrupt().transition().duration(n).attr("stroke","#666").attr("stroke-opacity",1)},a.mouseOver=function(t,i){if(!i){E(t,".SubMapTiling");var a=d3.select(t).attr("clsID");if(null!=a&&a.length>0){a=a.split("_");var n=this.filterByIDs(e.getClsByPath.call(e,a)),s=r.subtree.findByIndex(a).data.dataWeights,l=e.ovlDataWeights=r.subtree.data.dataWeights;s=N.sub(l,s),this.informOthers(n,s,!1),e.updateUpdateSubList({path2This:a,type:"mouseover"})}this.standOut(t,a)}},a.mouseOut=function(t){if(!t){this.fadeOutAll();var i=this.filterByIDs();this.informOthers(i,null,!1),e.updateUpdateSubList({path2This:null,type:"mouseout"}),this.filterByIDs(),this.informOthers()}},a.informOthers=function(t,i){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=void 0;null!=t&&(n=r?e.getClsByPath(t):t);a&&(!1===r?this.projectByIDs(n):this.projectByCluster(t))},a.pinning=function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=d3.select(t),n=a.classed("pinned"),s=void 0,l=void 0;i.selectAll(".SubMapClusters.pinned").classed("pinned",!1),n?(e.SubGlyph.pickGlyphsByIDs(i,null,"index"),e.resetSubList(),e.updateUpdateSubList({path2This:null,type:"unclick"}),e.updateUpdateSubList({path2This:void 0,subIds:[].concat(M()(Array(Data.subs.length).keys())),type:"changeShownItems"}),e.updateChangeProjInBrowseMode({parentClsID:null})):r?(s=a.attr("clsID").split("_"),l=e.getClsByPath.call(e,s),l=e.SubGlyph.pickGlyphsByIDs(i,l,"index"),a.classed("pinned",!0),e.updateUpdateSubList({path2This:s,subIds:void 0,type:"changeShownItems"}),e.updateChangeProjInBrowseMode({parentClsID:s})):(l=[a.attr("index")],l=e.SubGlyph.pickGlyphsByIDs(i,l,"index")),!0===r?this.informOthers(s,null,!0,!0):this.informOthers(l,null,!1,!0)},a.filterByDims=function(t){var r={indeces:e.SubGlyph.filterGlyphsByDims(i,t,"index",null,s.codes),illegal:t.filter(function(t){return 0!==t}).length<2};r.indeces.length==s.codes.length?a.projectByIDs(null):a.projectByIDs(r.indeces)},a.filterByIDs=function(t){return e.SubGlyph.filterGlyphsByIDs(i,t,"index")},a.pinByIDs=function(t){i.selectAll(".SubMapClusters.pinned").classed("pinned",!1),e.SubGlyph.pickGlyphsByIDs(i,t),this.projectByIDs(t)},a.projectByIDs=function(t){if(null==t||0===t.length);else{var e=r.subs;if(1===t.length)e[t[0]]}},a.projectByCluster=function(t){},a.fixCode=function(t){for(var i=e.dimCover,r=i.length,a=new Array(r),n=0,s=0;s<r;s++)i[s]>=0?a[s]=i[s]:(a[s]=t[n],n++);return a})},getClsByPath:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.fCodes.dataIndeces,r=t.length-1,a=this.currClusters.paths[r],n=t.slice(0,t.length-1).join("_"),s=t[t.length-1],l=a.filter(function(t){return!t.outlier&&t.previous.join("_")===n})[0].ids[s];if(e&&null!=i){for(var o=new Array(l.length),h=0;h<l.length;h++)o[h]=i[l[h]]+"";l=o}else for(var c=0;c<l.length;c++)l[c]=l[c]+"";return l},clustering:function(t){var e=this;null==this.overallClusters.clusters?(!function(){e.currClusters.clusters=Data.subHierClusters,e.currClusters.level=function t(e){return Array.isArray(e)?1+Math.max.apply(Math,M()(e.map(function(e){return t(e)}))):0}(e.currClusters.clusters)-1;var i=function(){function t(e,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments[3],n=arguments[4];S()(this,t);var s=new m.a,l=e?e.patterns:null,o=new Array(Data.dims.length).fill(0),h=e?e.dimCounts:null;this.dimCounts=null==n?h||o:n,this.patterns=null==a?l||s:a,this.index=null==i?[]:i,this.outliers=r}return D()(t,[{key:"combine",value:function(t){this.dimCounts=N.add(this.dimCounts,t.dimCounts),this.patterns=function(t,e,i){for(var r=new m.a,a=g()(t.entries()),n=g()(e.entries()),s=new Array(a.length).fill(!1),l=new Array(n.length).fill(!1),o=0;o<a.length;o++)for(var h=a[o][0],c=a[o][1],u=0;u<n.length;u++){var d=n[u][0],f=n[u][1],p=void 0;if(h==d){if(p=i(c,f),r.has(h)){var v=r.get(h);p=i(v,p),r.set(h,p)}else r.set(h,p);s[o]=!0,l[u]=!0}}for(var y=0;y<s.length;y++)if(!s[y]){var b=a[y][0],S=a[y][1];if(r.has(b)){var w=r.get(b),D=i(w,S);r.set(b,D)}else r.set(b,S)}for(var x=0;x<l.length;x++)if(!l[x]){var P=n[x][0],C=n[x][1];if(r.has(P)){var M=r.get(P),A=i(M,C);r.set(P,A)}else r.set(P,C)}return r}(this.patterns,t.patterns,function(t,e){return t+e})}}]),t}();!function(){for(var r=new Array(Data.subs.length),a=0;a<r.length;a++)r[a]=new Array(Data.dims.length).fill(0);var n=new m.a;n.findPair=function(t,e){var i=t<e?t+"_"+e:e+"_"+t;return this.get(i)},n.setPair=function(t,e,i){for(var a=t<e?t+"_"+e:e+"_"+t,n=0;n<i.length;n++)"1"==i[n]&&(r[t][n]++,r[e][n]++);return this.set(a,i)},e.currClusters.aggregate=function(t,e,i){var r=function t(e,i,r,a){if(null==e.length)return null;var n=[];var s=[];var l=[];var o=[];var h=!0;for(var c=0;c<e.length;c++){var u=e[c];if(null!=u.length){var d=[].concat(M()(a),[c]),f=t(u,i,r,d),p=f.subtree;p.supernode=i(p,d),s.push(p),n.push(p),h=!1}else l.push(u),o.push(c)}var v=r(l,h,[].concat(M()(a),[o]));l=v.leafnode;l.supernode=v.supernode;s.push(v.supernode);n.push(l);return{subtree:n,supernodes:s}}(t,e,i,[]),a=r.subtree;return a.supernode=e(r.subtree,[]),a}(e.currClusters.clusters,function(t,e){if(1==t.length){var r=new i(t[0].supernode,e);return r}var a=new i(null,e);if(0==t.length)return a;for(var n=0;n<t.length;n++)a.combine(t[n].supernode);return a},function(t,e,r){for(var a=new i(null,r,!e),s=a.patterns,l=a.dimCounts,o=0;o<t.length;o++){for(var h=t[o],c=Data.subKNN[h],u=Data.subs[h],d=0;d<c.length;d++){var f=c[d],p=Data.subs[f],v=n.findPair(h,f),g=void 0;if(null==v){g=new Array(Data.dims.length).fill(0);for(var y=0;y<u.length;y++)u[y]==p[y]&&(g[y]=1);g=g.join(""),n.setPair(h,f,g)}else g=v;s.has(g)||s.set(g,0),s.set(g,s.get(g)+1)}for(var m=0;m<u.length;m++)1==u[m]&&l[m]++}return{supernode:a,leafnode:t}}),r.extent={min:Math.min.apply(Math,M()(r.map(function(t){return Math.min.apply(Math,M()(t))}))),max:Math.max.apply(Math,M()(r.map(function(t){return Math.max.apply(Math,M()(t))})))},e.neighborDims=r,function t(i){var a=new Array(e.neighborDims[0].length).fill(0);for(var n=0;n<i.length;n++){var s=new Array(e.neighborDims[0].length).fill(0);if("object"==p()(i[n][0]))s=t(i[n]);else{for(var l=0;l<i[n].length;l++)s=N.add(s,r[i[n][l]]);i[n].supernode.neighborDims=s}a=N.add(a,s)}i.supernode.neighborDims=a;return a}(e.currClusters.aggregate),t.resolve()}()}(),this.overallClusters=this.currClusters):this.currClusters=this.overallClusters},showTiling:function(e){var i=this,r=this,a=new k.a(Data.subtree,Data.subDistMat,Data.subs,2);a.getMap(),this.map=a,this.updateUpdateMap({map:a,resize:!0});var n=this.scales,s=[.5*(n.x.range()[1]+n.x.range()[0]),.5*(n.y.range()[1]+n.y.range()[0])],l=[n.x.range()[1]-n.x.range()[0],n.y.range()[1]-n.y.range()[0]],o=t.Deferred(),h=t.Deferred(),c=t.Deferred(),u=a.coordsRange;u=Math.max(u.x.max-u.x.min,u.y.max-u.y.min),this.glyphSize=l[0]*a.cellRadius/u,this.d3el.select(".SubMapTiling").classed("SubMapTiling",!1).classed("SubOldTiling",!0),this.visible=Object(T.a)(this,s,l[0],this.glyphSize,this.currClusters.level,Data.colors,this.transition.duration,this.updateChangeLevelByMap);var d=this.visible.prepareContainer(this.svg);d.append("rect").attr("class","SubMapTilingFrame").attr("x",-this.mapWidth/2).attr("y",-this.mapHeight/2).attr("width",this.mapWidth).attr("height",this.mapHeight),this.renderMap(o,d,a),t.when(o).done(function(){i.showClusters(a,n),i.visible.update([0,0],1),i.clsColorReady=!0,i.updateClusterInfo(),c.resolve()}),t.when(c).done(function(){i.showRoutes(h,a,n)}),t.when(h).done(function(){function t(e,i,r){if(void 0==r&&(r=""),Array.isArray(i)){for(var a=0;a<i.length;a++)if(Array.isArray(i[a])){var n=t(e,i[a],r+a+",");if(n)return n}else if(i[a]==e)return r+a}else if(i==e)return r+a;return!1}i.showCaps(a,n),i.addBorderToLeaves(),d.selectAll(".SubMapGrids").on("dblclick",function(e){if(d3.event.shiftKey){var i=Number(d3.select(this).attr("index")),a=void 0;a=null!==d.attr("transform")?r.getTranslate(d).map(function(t){return-t}):[0,0];var n=void 0,s=void 0,l=void 0,o=void 0,h=void 0;if(Data.subtree.leaves.indexOf(i)>-1)return;if(!d.select(".SubCls_0").classed("visible")&&d.select(".SubCls0_0").classed("visible"))n=0,s=Number(t(i,Data.subHierClusters)[0]),l=r.currClusters.paths[0][0].paths[s].center,o=null,h=[];else if(!d.select(".SubCls0_0").classed("visible")){n=1,s=t((c=d.selectAll(".SubMapGrids").filter(function(){return d3.select(this).style("opacity")>.2}),Number(d3.select(c._groups[0][0]).attr("index"))),Data.subHierClusters).split(",").map(Number),l=r.currClusters.paths[1][s[0]].paths[s[1]].center,h=[s[0]],o=r.getClsByPath.call(r,h.map(String)),d.selectAll(".SubMapClusters.pinned").classed("pinned",!1)}r.visible.toLevel(d.node(),N.add(l.map(function(t){return-1*t}),a),n,r.transition.long),r.updateChangeLevelByMap({level:n}),r.SubGlyph.pickGlyphsByIDs(r.d3el,o,"index"),r.updateUpdateSubList({path2This:h,subIds:void 0,type:"changeShownItems"}),r.updateChangeProjInBrowseMode({parentClsID:h})}var c}),e.resolve()}),e.resolve()},renderMap:function(e,i,r){var a=this,n=t.Deferred();n.resolve(0),t.when(n).done(function(t){a.renderNewMap(i,r,t),e.resolve()})},hideOldMap:function(e,i){this.glyphSize,this.scales,Data.colors;var r=this.transition.long,a=this.visible.toLevel([0,0],0,r),n=t.Deferred();setTimeout(function(){n.resolve()},a),t.when(n).done(function(){e.resolve(0)})},renderNewMap:function(t,e,i){var r=this,a=this.fCodes,n=this.scales,s=this.glyphSize,l=Data.colors,o=g()(e.allLeaves.values()),h=e.coordsRange,u=h.aspectRatio;if(u>1){var f=(h.x.min+h.x.max)/2,p=(h.x.max-h.x.min)/2;n.x.domain([f-p*u,f+p*u]),n.y.domain([h.y.min,h.y.max])}else{var v=(h.y.min+h.y.max)/2,y=(h.y.max-h.y.min)/2;n.x.domain([h.x.min,h.x.max]),n.y.domain([v-y/u,v+y/u])}this.SubGlyph=Object(j.a)(s,s,"cell","fan",l),console.log("leafNodes: ",o);var m=t.selectAll(".SubMapGrids").data(o).enter().append("g").attr("class","SubMapGrids").attr("index",function(t){return null==a.dataIndeces?t.ID:a.dataIndeces[t.ID]}).attr("gSize",s).classed("empty",function(t){return null==t.ID}).attr("position",function(t){var e=t.center.coordinates;return B(n,[e.x,e.y]).join("_")}).attr("transform",function(t){var e=t.center.coordinates;return"translate("+B(n,[e.x,e.y])+")"});this.d3el.selectAll(".SubMapTiling").attr("opacity",0).transition().duration(i).attr("opacity",1);var b=this.fMatrix,S=d3.scaleLinear().domain([b.distExt.min,b.distExt.max]).range([0,.8]),w=this.neighborDims,D=this.pattern,x=function(t){var i=d3.select(t).data()[0],r=i.ID,n=l[r];n="rgb("+(n=[~~(255*n[0]),~~(255*n[1]),~~(255*n[2])])+")";for(var o=new Array(6),h=0;h<6;h++)o[h]={angle:60*h/180*Math.PI,diff:null,dist:null};o.diffScale=d3.scaleLinear().domain([1,a.codes[0].Length]).range([0,s*Math.sqrt(3)*2/3]);var c=!0,u=!1,f=void 0;try{for(var p,v=d()(i.neighbors);!(c=(p=v.next()).done);c=!0){var g=p.value,y=g[1].join("_");if(e.occupied.has(y)){var m=e.occupied.get(y),x=Math.round(g[0]/60);o[x].dist=S(b.distMat[r][m]),o[x].diff=b.diffMat[r][m]}}}catch(t){u=!0,f=t}finally{try{!c&&v.return&&v.return()}finally{if(u)throw f}}var M=w[r],A=[d3.select(t),o,r,a.codes[r],n,D,M,w.extent];null==r?P.add(A):C.add(A)},P=new c.a,C=new c.a;m._groups.forEach(function(t){t.forEach(x)});var A=this.interactions;C.forEach(function(t){var e;(e=r.SubGlyph).showGlyph.apply(e,M()(t)).on("click",function(t){null!=t.id&&A.pinning(this,!1)})})},showClusters:function(t,e){var i=[],r=this.currClusters.level;if(null!=this.overallClusters.paths)i=this.currClusters.paths;else{for(var a=this.currClusters.clusters,n=0;n<r;n++)i.push([]);this.getContourTree(t,a,i,0,[],null),this.currClusters.paths=i}for(var s=i.length;s>0;s--)for(var l=i[s-1],o=0;o<l.length;o++){var h=l[o];this.renderPaths(h.paths,"SubCls"+h.previous.join("_"),h.previous,h.outlier,e)}this.updateClusterInfo()},getContourTree:function(t,e,i,r,a,n){for(var s=[],l=[],o=[],h=0;h<e.length;h++)if(null!=e[h].length){var c,u=a.slice(0);u.push(h),c=this.getContourTree(t,e[h],i,r+1,u,h),s.push(c),o.push.apply(o,M()(c))}else o.push(e[h]),l.push(e[h]);if(s.length>0){var d=t.getClusterContours(s);i[r].push({previous:a,selfID:n+"",paths:d,ids:s,outlier:!1})}return o},renderPaths:function(t,e,i,r,a){var n=this.interactions,s=i.length,l=this,o=function(t,e){var i=[t.start.coordinates.x,t.start.coordinates.y],r=[t.end.coordinates.x,t.end.coordinates.y],n=B(a,i),s=B(a,r),l=[n,s].join("_");d3.select(this).attr("pos",l).selectAll("line").data([t]).enter().append("line").attr("x1",n[0]).attr("y1",n[1]).attr("x2",s[0]).attr("y2",s[1]).attr("stroke","#666")};this.d3el.select(".SubMapTiling").selectAll("."+e).data(t).enter().append("g").attr("class",function(t,i){return"SubMapClusters "+e+"_"+i+(r?" Outliers":"")}).attr("clsID",function(t,e){return[].concat(M()(i),[e]).join("_")}).attr("fill-opacity",0).on("mouseover",function(t,e){var i=d3.select(this).attr("clsID");n.hoveredID!==i&&(n.hoveredID=i,n.mouseOver(this,r),l.updateChangeSubProjOpacity({action:"mouseover",clsID:i,opacity:.2}))}).on("mouseout",function(t,e){n.hoveredID=null,n.mouseOut(r),l.updateChangeSubProjOpacity({action:"mouseout",clsID:null,opacity:1})}).on("click",function(t,e){var i=this;!function(t,e,i){var r=F[t];if(null==r)F[t]=function(t,e,i){return{start:new Date,past:0,duration:e,func:i,finished:!1,timer:setTimeout(function(){i(),F[t]=null},e)}}(t,e,i);else{r.finished&&(clearTimeout(r.timer),r=null);var a=F[t];a.past=new Date-a.start,a.past>=a.duration?(i(),a.finished=!0,clearTimeout(a.timer),F[t]=null):(a.start=new Date,a.func=i)}}("clickPinning",300,function(){n.pinning(i)})}).on("dblclick",function(t,e){var i;if(null!=(i=F["clickPinning"])&&(clearTimeout(i.timer),i=null),!r){var a=l.d3el.select(".SubMapTiling"),n=void 0;n=null!==a.attr("transform")?l.getTranslate(a).map(function(t){return-t}):[0,0];var s=d3.select(this).attr("clsID").split("_");if(d3.event.shiftKey){d3.event.preventDefault(),d3.event.stopPropagation(),s=s.slice(0,s.length-1);var o=l.currClusters.paths[0][0].paths[Number(s[0])].center;l.visible.toLevel(this.parentNode,N.add(o.map(function(t){return-1*t}),n),t.clsLevel-1,l.transition.long),l.updateChangeLevelByMap({level:t.clsLevel-1}),l.SubGlyph.pickGlyphsByIDs(l.d3el,null,"index"),s=[]}else l.updateChangeLevelByMap({level:t.clsLevel+1}),l.visible.toLevel(this.parentNode,N.add(n,t.center),t.clsLevel+1,l.transition.long);l.updateUpdateSubList({path2This:s,subIds:void 0,type:"changeShownItems"}),l.updateChangeProjInBrowseMode({parentClsID:s})}}).call(function(t){t._groups[0].forEach(function(t){for(var e,i,r=d3.select(t).data()[0],n=[],l=[],h=void 0,c=0,u=0;u<r.paths.length;u++){for(var d=r.paths[u],f=d.points,p=B(a,[f[0].coordinates.x,f[0].coordinates.y]),v="M"+p,g=1;g<f.length;g++){var y=B(a,[f[g].coordinates.x,f[g].coordinates.y]);v+=" L"+y,l.push(y)}d.closed&&(v+="L"+p),n.push(v)}for(var m=0;m<l.length-1;m++)for(var b=m+1;b<l.length;b++){var S=(e=l[m],i=l[b],N.norm2(N.sub(e,i)));S>c&&(c=S,h=[m,b])}for(var w=0;w<h.length;w++)h[w]=l[h[w]];r.center=function(t,e){for(var i=e?t:N.transpose(t),r=N.dim(i),a=new Array(r[0]),n=r[1],s=0;s<i.length;s++)a[s]=N.sum(i[s])/n;return a}(h,!1),r.diameter=c,r.clsLevel=s,d3.select(t).selectAll("path").data(n).enter().append("path").attr("d",function(t){return t}),d3.select(t).classed("Outliers")||d3.select(t).append("g").attr("class","SubClsPaths").selectAll(".SubClsPath").data(r.lines).enter().append("g").attr("class","SubClsPath").each(o)})})},updateClusterInfo:function(){var t,e,i,r,a=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.clsColorReady)if(n){t=new Array,e=a.currClusters.aggregate,i=Data.subtree,r=Data,a.d3el.selectAll(".SubMapClusters").each(function(n){var s=d3.select(this);if(!s.classed("Outliers")){var l=s.attr("clsID").split("_"),o=r.subtree.findByIndex(l).data.dataWeights,h=void 0==this.ovlDataWeights?r.subtree.data.dataWeights:this.ovlDataWeights;o=N.sub(o,h);var c=l.length-1,u={center:n.center,clsID:l,color:function(t){var e=a.currClusters.visible[t.length-1],i=t.join("_");return e.filter(function(t){return t.clsID==i})[0].avgCol}(l),count:i.findByIndex(l).dict.length,weights:function(t){for(var i=e,r=0;r<t.length;r++)i=i[t[r]];return i.supernode.dimensions}(l),data:o};void 0==t[c]&&(t[c]=[]),t[c].push(u)}})}else{!function(){var t=new Array;a.currClusters.aggregate,Data.subtree;a.d3el.selectAll(".SubMapClusters").each(function(e){var i=d3.select(this);if(!i.classed("Outliers")){var r,n,s,l=i.attr("clsID").split("_"),o=l.length-1,h={clsID:i.attr("clsID"),visible:(r=l,n=a.currClusters.visible[r.length-1],s=r.join("_"),n.filter(function(t){return t.clsID==s})[0].visible)};void 0===t[o]&&(t[o]=[]),t[o].push(h)}})}()}},showRoutes:function(e,i,r){var a=this,n=g()(i.allLeaves.values()),s="./../../../subspace-map/static/data/"+Data.file+"/route.json";function l(t){var i=new Date;a.Route=Object(_.a)(n,r,t),a.Route.draw(a.d3el.select(".SubMapTiling"));var s=new Date;console.log("duration: ",(s-i)/1e3),console.log("Route: ",a.Route),e.resolve()}t.ajax({url:s,dataType:"json",error:function(){console.log("route file load fail"),l(void 0)},success:function(t){console.log("route file load success"),l(t)}})},showCaps:function(t,e){for(var i=g()(t.allLeaves.values()),r=2*this.glyphSize*Math.sqrt(3)/3,a=this.d3el.select(".SubMapTiling").append("g").attr("class","mapCaps"),n=[],s=[],l=function(t){var r=i.find(function(e){return e.ID===Data.nationalCaps[t]});n.push(B(e,o()(r.center.coordinates)))},h=0;h<Data.nationalCaps.length;h++)l(h);var c=function(t){var r=i.find(function(e){return e.ID===Data.provincialCaps[t]});s.push(B(e,o()(r.center.coordinates)))};for(h=0;h<Data.provincialCaps.length;h++)c(h);a.selectAll(".nationalCaps").data(n).enter().append("g").attr("class","nationalCaps").classed("caps",!0).attr("index",function(t,e){return Data.nationalCaps[e]}).attr("transform",function(t){return"translate("+t[0]+", "+t[1]+")"}).each(function(){var t,e,i,a;t=d3.select(this),e=.3*r,i=.6*r,a=.2*r,t.append("circle").attr("cx",0).attr("cy",0).attr("r",i).style("fill","#fff").style("stroke","#000").style("stroke-width",a),t.append("circle").attr("cx",0).attr("cy",0).attr("r",e).style("fill","#000")}),a.selectAll(".provincialCaps").data(s).enter().append("g").attr("class","provincialCaps").classed("caps",!0).attr("index",function(t,e){return Data.provincialCaps[e]}).attr("transform",function(t){return"translate("+t[0]+", "+t[1]+")"}).each(function(){var t,e,i;t=d3.select(this),e=.45*r,i=.2*r,t.append("circle").attr("cx",0).attr("cy",0).attr("r",e).style("fill","#fff").style("stroke","#000").style("stroke-width",i)})},addBorderToLeaves:function(){d3.selectAll(".SubMapGrids").filter(function(){return-1!==Data.subtree.leaves.indexOf(Number(d3.select(this).attr("index")))}).each(function(){d3.select(this).select(".cell").style("stroke","#ccc").style("stroke-width","0.05rem").style("stroke-linecap","round")})},groundTravelMode:function(){var t=this,e=g()(this.map.allLeaves.values());this.cancelSubMapClustersEventBinding(),this.changeElemOrder();var i=this.d3el.select(".SubMapTiling").selectAll(".SubMapGrids"),r=Data.nationalCaps.concat(Data.provincialCaps),n=i.filter(function(){return-1!==r.indexOf(Number(d3.select(this).attr("index")))}),l=i.filter(function(){return-1===r.indexOf(Number(d3.select(this).attr("index")))}),h=this.d3el.select(".SubMapTiling").select(".mapCaps").selectAll(".caps");l.attr("cursor","default").transition().duration(this.transition.duration).attr("opacity",.2),this.updateUpdateSubList({path2This:void 0,subIds:r,type:"changeShownItems"});var u=0,d=[];function f(){var i=d3.select(this).attr("index");if(++u%2==1)t.d3el.select(".SubMapTiling").selectAll(".travelIcon").remove(),t.unselectRoute(),t.updateUpdateSubList({path2This:void 0,subIds:r,type:"changeShownItems"}),t.resetCapsOpacity(),t.resetTravelRouteSubs(),(d=[]).push(Number(i)),n.classed("travelUnselected",!1),n.classed("gridClicked",!1),n.filter(function(){return d3.select(this).attr("index")===i}).classed("gridClicked",!0),t.drawTravelIcon(d3.select(this)),t.updateDrawProjection({type:"origin",subId:Number(i)});else{if(d[0]===Number(i))return t.d3el.select(".SubMapTiling").selectAll(".travelIcon").remove(),t.travelIconPos=null,n.classed("gridClicked",!1),void n.classed("travelUnselected",!1);d.push(Number(i)),n.filter(function(){return d3.select(this).attr("index")===i}).classed("gridClicked",!0),n.filter(function(){return-1===d.indexOf(Number(d3.select(this).attr("index")))}).classed("travelUnselected",!0);var l=Number(tt(d[0],Data.subHierClusters)[0]),h=Number(tt(d[1],Data.subHierClusters)[0]),f=void 0,p=void 0,v=void 0;if(l===h){var y=et(t.Route.landMST[l]).findShortestPath(d[0],d[1]).map(Number);v=y,f=rt(y,t.Route.landRoute[l]),p=at("land",y,t.Route.landRoute[l],t.Route.landRouteCoords[l])}else{var m,b,S,w,D,x,P=t.Route.landMST[l],C=t.Route.landMST[h],A=et(P),I=et(C),R=it(l),k=it(h),T=A.findShortestPath(d[0],R).map(Number);v=JSON.parse(s()(T));var j=I.findShortestPath(k,d[1]).map(Number),_=function(e){var i={},a=et(t.Route.waterMST).findShortestPath(e[0],e[1]).map(Number),n=rt(a,t.Route.waterRoute),s=at("water",a,t.Route.waterRoute,t.Route.waterRouteCoords),l=function(e){for(var i=[],a=0;a<e.length;a++)-1===r.indexOf(e[a])&&-1===t.Route.harbor.indexOf(e[a])||i.push(e[a]);return i}(n);return i.subs=n,i.coords=s,i.OD=l,i}([l,h]),O=_.subs;if((f=rt(T,t.Route.landRoute[l])).pop(),(m=f).push.apply(m,M()(O)),v.pop(),(b=v).push.apply(b,M()(_.OD)),v.pop(),(S=v).push.apply(S,M()(JSON.parse(s()(j)))),f.pop(),(w=f).push.apply(w,M()(rt(j,t.Route.landRoute[h]))),(p=at("land",T,t.Route.landRoute[l],t.Route.landRouteCoords[l])).pop(),(D=p).push.apply(D,M()(_.coords)),p.pop(),(x=p).push.apply(x,M()(at("land",j,t.Route.landRoute[h],t.Route.landRouteCoords[h]))),1===j.length){f.push(k);var N=e.find(function(t){return t.ID===k}),F=B(t.scales,o()(N.center.coordinates));p.push({x:F[0],y:F[1]})}}var E=nt(f),G=st(f,E);st(p,E),!function(t,e,i){st(t,e);var r=t.length,a=0;for(;a<r;)i.indexOf(t[a])>-1?(t.splice(a,1),r-=1):a++}(v,nt(v),G),console.log("travelRouteSubs: ",f);for(var H=[0],U=[[]],W=0;W<f.length-1;W++){var z,Y=f[W],V=f[W+1];if(t.Route.harbor.indexOf(Y)>-1&&t.Route.harbor.indexOf(V)>-1)H.push(W+1),(z=U[U.length-1]).push.apply(z,M()(t.Route.landSubCoords.get(Y))),U.push([]);else if(t.Route.harbor.indexOf(Y)>-1&&-1===t.Route.harbor.indexOf(V)){var X,q=JSON.parse(s()(t.Route.landSubCoords.get(Y)));(X=U[U.length-1]).push.apply(X,M()(q.reverse()))}else U[U.length-1].push(t.Route.landSubCoords.get(Y))}H.push(f.length);var J=f[f.length-1];t.Route.harbor.indexOf(J)>-1?(U[U.length-1].push(t.Route.landSubCoords.get(J)[0]),l!==h&&U[U.length-1].push(t.Route.landSubCoords.get(J)[1])):U[U.length-1].push(t.Route.landSubCoords.get(J)),console.log("highlightLandRouteCoords",U),t.fadeIrrelevantRoutesAndCaps(U,v),t.highlightTravelRouteSubs(f),t.updateUpdateSubList({path2This:void 0,subIds:g()(new c.a(r.concat(f))),type:"changeShownItems"});for(var K=lt(f,H),Q=lt(p,H),Z=[],$=0;$<K.length;$++)Z.push(800*K[$].length);t.travelIconPos=Number(i),t.updateDrawProjection({type:"destination",subId:Number(i)}),function i(r,a,n,s,l,o,h,c){var u=setInterval(function(){if(t.currTime>=a[c]){if(clearInterval(u),t.currTime=0,c===a.length-1)return void t.d3el.select(".SubMapTiling").select(".travelIcon").call(d3.drag().on("drag",function(){!function(i,r){for(var a=e.find(function(e){return e.ID===t.travelIconPos}),n=B(t.scales,[a.center.coordinates.x,a.center.coordinates.y]),s=[],l=[],o=Math.sqrt(Math.pow(d3.event.x-n[0],2)+Math.pow(d3.event.y-n[1],2)),h=function(i){var a=e.find(function(t){return t.ID===r[i]}),n=B(t.scales,[a.center.coordinates.x,a.center.coordinates.y]),h=Math.sqrt(Math.pow(n[0]-d3.event.x,2)+Math.pow(n[1]-d3.event.y,2)),c=o-h;c>0&&(l.push(c),s.push(a))},c=0;c<r.length;c++)h(c);if(0!==l.length){var u=l.indexOf(Math.min.apply(Math,l)),d=s[u];t.travelIconPos=d.ID;var f=[t.scales.x(d.center.coordinates.x)-t.travelIconSizeDiff.width,t.scales.y(d.center.coordinates.y)-t.travelIconSizeDiff.height];i.attr("transform","translate("+f+")scale("+t.travelIconScale+")"),t.resetSubList(),t.updateUpdateSubList({path2This:void 0,subIds:[t.travelIconPos],type:"mouseover"}),t.updateDrawProjection({type:"transition",subId:t.travelIconPos})}}(d3.select(this),n)}));var d=n[l[c+1]-1],f=n[l[c+1]],p=[d,f],v=!1,g=t.d3el.select(".SubMapTiling").selectAll(".seaRoute").filter(function(){var t=d3.select(this).attr("od");return t===String(p)});0===g._groups[0].length&&(v=!0,p.reverse(),g=t.d3el.select(".SubMapTiling").selectAll(".seaRoute").filter(function(){var t=d3.select(this).attr("od");return t===String(p)})),t.d3el.select(".SubMapTiling").select(".travelIcon").transition().duration(t.seaRouteDuration).ease(d3.easePoly.exponent(2)).attrTween("transform",(m=g.node(),b=v,S=m.getTotalLength(),function(){return function(e){var i=b?m.getPointAtLength(S-e*S):m.getPointAtLength(e*S);return"translate("+[i.x-t.travelIconSizeDiff.width,i.y-t.travelIconSizeDiff.height]+")scale("+t.travelIconScale+")"}})).on("end",function(){var e=s[l[c+1]];t.updateDrawProjection({type:"transition",subId:f}),t.updateView(e,f),i(r,a,n,s,l,o,h,c+1)})}else{var y=t.currTime/r;t.updateDrawProjection({type:"transition",subId:o[c][y]}),t.updateView(h[c][y],o[c][y]),t.currTime+=r}var m,b,S},r)}(800,Z,f,p,H,K,Q,0)}function tt(t,e,i){if(void 0==i&&(i=""),Array.isArray(e)){for(var r=0;r<e.length;r++)if(Array.isArray(e[r])){var a=tt(t,e[r],i+r+",");if(a)return a}else if(e[r]==t)return i+r}else if(e==t)return i+r;return!1}function et(t){for(var e={},i=function(t){var e=[].concat(M()(new c.a(t.map(function(t){return t.u})))),i=[].concat(M()(new c.a(t.map(function(t){return t.v}))));return g()(new c.a(e.concat(i)))}(t),r=0;r<i.length;r++){for(var a=i[r],n={},s=0;s<t.length;s++)t[s].u===a?n[t[s].v]=t[s].w:t[s].v===a&&(n[t[s].u]=t[s].w);e[a]=n}return new L.a(e)}function it(e){for(var i=0;i<t.Route.harbor.length;i++)if(Number(tt(t.Route.harbor[i],Data.subHierClusters)[0])===e)return t.Route.harbor[i]}function rt(t,e){for(var i=JSON.parse(s()(e)),r=[],n=a()(i),l=0;l<t.length-1;l++){var o=[t[l],t[l+1]],h=void 0;h=n.indexOf(String(o))>-1?i[o]:[].concat(M()(i[o.reverse()])).reverse(),l===t.length-2?r.push.apply(r,M()(h)):(h.pop(),r.push.apply(r,M()(h)))}return r}function at(t,e,i,r){for(var n=JSON.parse(s()(i)),l=JSON.parse(s()(r)),o=[],h=a()(n),c=0;c<e.length-1;c++){var u=[e[c],e[c+1]],d=void 0,f=void 0;"land"===t?h.indexOf(String(u))>-1?f=l[d=h.indexOf(String(u))]:(d=h.indexOf(String(u.reverse())),f=[].concat(M()(l[d])).reverse()):"water"===t&&(f=h.indexOf(String(u))>-1?l[String(u)]:[].concat(M()(l[String(u.reverse())])).reverse()),c===e.length-2?o.push.apply(o,M()(f)):(f.pop(),o.push.apply(o,M()(f)))}return o}function nt(t){for(var e=[],i=0,r=0;r<t.length;r++){var a=t[r];if(s(t,a)>1){var n=l(t,a);e.push([r+1-i,n-i]),i+=n-r,r=n}}return e;function s(t,e){return t.filter(function(t){return t===e}).length}function l(t,e){for(var i=0,r=0;r<t.length;r++)if(t[r]===e&&2===++i)return r;return null}}function st(t,e){for(var i=[],r=0;r<e.length;r++){var a=e[r],n=t.splice(a[0],a[1]-a[0]+1);(i=i.concat(n)).pop()}return[].concat(M()(new c.a(i)))}function lt(t,e){for(var i=[],r=0;r<e.length-1;r++)if(i.push([]),r>0)for(var a=e[r]+1;a<e[r+1];a++)i[r].push(t[a]);else for(var n=e[r];n<e[r+1];n++)i[r].push(t[n]);return i}}n.on("mouseover",function(){t.travelModeHoverGrid(d3.select(this),n)}).on("mouseout",function(){t.travelModeUnhoverGrid(d3.select(this),n,"groundTravel")}).on("click",f),h.on("mouseover",function(){var e=d3.select(this).attr("index"),i=t.d3el.select(".SubMapTiling").selectAll(".SubMapGrids").filter(function(){return d3.select(this).attr("index")===e});t.travelModeHoverGrid(i,n)}).on("mouseout",function(){var e=d3.select(this).attr("index"),i=t.d3el.select(".SubMapTiling").selectAll(".SubMapGrids").filter(function(){return d3.select(this).attr("index")===e});t.travelModeUnhoverGrid(i,n,"groundTravel")}).on("click",f)},airTravelMode:function(t){var e=this,i=g()(this.map.allLeaves.values());this.cancelSubMapClustersEventBinding(),this.changeElemOrder();var r=this.d3el.select(".SubMapTiling").selectAll(".SubMapGrids"),a=this.d3el.select(".SubMapTiling").select(".mapCaps").selectAll(".caps");function n(t){var i=t.attr("index");if(e.travelIconPos===Number(i))e.d3el.select(".SubMapTiling").selectAll(".travelIcon").remove(),e.travelIconPos=null,e.d3el.select(".SubMapTiling").selectAll(".SubMapGrids").classed("gridClicked",!1),e.updateUpdateSubList({path2This:null,type:"unclick"}),e.updateDrawProjection({type:"clear",subId:null});else{if(0===document.getElementsByClassName("travelIcon").length)e.drawTravelIcon(t),e.d3el.select(".SubMapTiling").select(".travelIcon").call(d3.drag().on("start",function(){e.isTravelIconDragging=!0}).on("drag",l)).on("end",function(){e.isTravelIconDragging=!1}),e.updateDrawProjection({type:"origin",subId:Number(i)});else{e.resetSubList();var r=e.getTranslate(t);e.d3el.select(".SubMapTiling").select(".travelIcon").attr("transform","translate("+[r[0]-e.travelIconSizeDiff.width,r[1]-e.travelIconSizeDiff.height]+")scale("+e.travelIconScale+")"),e.updateDrawProjection({type:"transition",subId:Number(i)})}e.d3el.select(".SubMapTiling").selectAll(".SubMapGrids").classed("gridClicked",!1),t.classed("gridClicked",!0),e.travelIconPos=Number(i),e.updateUpdateSubList({path2This:void 0,subIds:[e.travelIconPos],type:"click"})}}function l(){for(var t=i.find(function(t){return t.ID===e.travelIconPos}),r=B(e.scales,[t.center.coordinates.x,t.center.coordinates.y]),a=g()(t.neighbors.values()),n=[],l=[],h=Math.sqrt(Math.pow(d3.event.x-r[0],2)+Math.pow(d3.event.y-r[1],2)),c=function(t){var r=i.find(function(e){return s()(o()(e.position))===s()(a[t])});if(void 0!==r){var c=B(e.scales,[r.center.coordinates.x,r.center.coordinates.y]),u=Math.sqrt(Math.pow(c[0]-d3.event.x,2)+Math.pow(c[1]-d3.event.y,2)),d=h-u;d>0&&(l.push(d),n.push(r))}},u=0;u<a.length;u++)c(u);if(0!==l.length){var d=l.indexOf(Math.min.apply(Math,l)),f=n[d];e.travelIconPos=f.ID;var p=[e.scales.x(f.center.coordinates.x)-e.travelIconSizeDiff.width,e.scales.y(f.center.coordinates.y)-e.travelIconSizeDiff.height];d3.select(this).attr("transform","translate("+p+")scale("+e.travelIconScale+")");var v=e.d3el.select(".SubMapTiling").selectAll(".SubMapGrids").filter(function(){return d3.select(this).attr("index")===e.travelIconPos+""});e.d3el.select(".SubMapTiling").selectAll(".SubMapGrids").classed("gridClicked",!1),v.classed("gridClicked",!0),e.resetSubList(),e.updateUpdateSubList({path2This:void 0,subIds:[e.travelIconPos],type:"click"}),e.updateDrawProjection({type:"transition",subId:e.travelIconPos})}}r.on("mouseover",function(){e.travelModeHoverGrid(d3.select(this),r)}).on("mouseout",function(){e.travelModeUnhoverGrid(d3.select(this),r,"airTravel")}).on("click",function(){n(d3.select(this))}),a.on("mouseover",function(){var t=d3.select(this).attr("index"),i=e.d3el.select(".SubMapTiling").selectAll(".SubMapGrids").filter(function(){return d3.select(this).attr("index")===t});e.travelModeHoverGrid(i,r)}).on("mouseout",function(){var t=d3.select(this).attr("index"),i=e.d3el.select(".SubMapTiling").selectAll(".SubMapGrids").filter(function(){return d3.select(this).attr("index")===t});e.travelModeUnhoverGrid(i,r,"airTravel")}).on("click",function(){var t=d3.select(this).attr("index");n(e.d3el.select(".SubMapTiling").selectAll(".SubMapGrids").filter(function(){return d3.select(this).attr("index")===t}))})},travelModeHoverGrid:function(t,e){if(!this.isTravelIconDragging){var i=t.attr("index");e.filter(function(){return d3.select(this).attr("index")!==i}).classed("gridUnhovered",!0),t.classed("gridUnhovered")&&t.classed("gridUnhovered",!1),this.updateUpdateSubList({path2This:void 0,subIds:[Number(i)],type:"mouseover"})}},travelModeUnhoverGrid:function(t,e,i){if(!this.isTravelIconDragging){var r=t.attr("index");"airTravel"===i?0!==document.getElementsByClassName("travelIcon").length?e.filter(function(){return d3.select(this).attr("index")===r}).classed("gridUnhovered",!0):a():"groundTravel"===i&&a(),this.updateUpdateSubList({path2This:null,type:"mouseout"})}function a(){e.filter(function(){return d3.select(this).attr("index")!==r}).classed("gridUnhovered",!1)}},drawTravelIcon:function(t){var e=this.getTranslate(t),i=void 0;(i=this.d3el.select(".SubMapTiling").append("g").attr("class","travelIcon").attr("transform","translate("+e+")scale("+this.travelIconScale+")").style("opacity",0)).append("path").attr("d",this.travelIcon);var r=i.node().getBoundingClientRect(),a=getTransformation(d3.select("#mapSvg").attr("transform")),n=a.scaleX,s=a.scaleY;if(null!==this.d3el.select(".SubMapTiling").attr("transform")){var l=getTransformation(this.d3el.select(".SubMapTiling").attr("transform"));n*=l.scaleX,s*=l.scaleY}i.attr("transform","translate("+[e[0]-2*r.width/3/n,e[1]-r.height/s]+")scale("+this.travelIconScale+")").style("opacity",1),this.travelIconSizeDiff={width:2*r.width/3/n,height:r.height/s}},fadeIrrelevantRoutesAndCaps:function(t,e){for(var i=[],r=0;r<e.length-1;r++)i.push(String([e[r],e[r+1]])),i.push(String([e[r+1],e[r]]));this.Route.drawHighlightLandRoute(this.d3el.select(".SubMapTiling"),t),this.d3el.select(".SubMapTiling").selectAll(".mapCaps").raise(),this.d3el.select(".SubMapTiling").select(".travelIcon").raise(),this.Route.showHighlightLandRoute(this.d3el.select(".SubMapTiling")),this.d3el.select(".SubMapTiling").selectAll(".landRoute").classed("routeUnselected",!0),this.d3el.select(".SubMapTiling").selectAll(".seaRoute").filter(function(){var t=d3.select(this).attr("od");return-1===i.indexOf(t)}).classed("routeUnselected",!0);var a=this.d3el.select(".SubMapTiling").select(".mapCaps");a.selectAll(".nationalCaps").filter(function(){return-1===e.indexOf(Number(d3.select(this).attr("index")))}).each(function(){d3.select(this).selectAll("circle").each(function(t,e){0===e?d3.select(this).style("stroke-opacity",.25):1===e&&d3.select(this).style("fill-opacity",.25)})}),a.selectAll(".provincialCaps").filter(function(){return-1===e.indexOf(Number(d3.select(this).attr("index")))}).each(function(){d3.select(this).select("circle").style("stroke-opacity",.25)})},highlightTravelRouteSubs:function(t){this.d3el.select(".SubMapTiling").selectAll(".SubMapGrids").each(function(){var e=d3.select(this);t.indexOf(Number(e.attr("index")))>-1&&e.classed("gridClicked",!0)})},resetTravelRouteSubs:function(){this.d3el.select(".SubMapTiling").selectAll(".SubMapGrids").classed("gridClicked",!1)},unselectRoute:function(){this.d3el.select(".SubMapTiling").selectAll(".landRoute").classed("routeUnselected",!1),this.d3el.select(".SubMapTiling").selectAll(".seaRoute").classed("routeUnselected",!1),this.d3el.select(".SubMapTiling").selectAll(".hightlightLandRoute").remove()},cancelSubMapClustersEventBinding:function(){var t=this;if(null===this.subMapClustersEvent){var e=["mouseover","mouseout","click","dblclick"];this.subMapClustersEvent={};for(var i=0;i<e.length;i++)this.subMapClustersEvent[e[i]]={};this.d3el.select(".SubMapTiling").selectAll(".SubMapClusters").each(function(){for(var i=0;i<e.length;i++)t.subMapClustersEvent[e[i]][d3.select(this).attr("clsID")]=d3.select(this).on(""+e[i])})}this.d3el.select(".SubMapTiling").selectAll(".SubMapClusters").on("mouseover",null).on("mouseout",null).on("click",null).on("dblclick",null)},bindSubMapClustersEvent:function(){this.interactions;var t=this,e=["mouseover","mouseout","click","dblclick"];this.d3el.select(".SubMapTiling").selectAll(".SubMapClusters").each(function(){for(var i=d3.select(this).attr("clsID"),r=0;r<e.length;r++)d3.select(this).on(""+e[r],t.subMapClustersEvent[""+e[r]][i])})},recoverElemOrder:function(){this.d3el.select(".SubMapTiling").selectAll(".SubMapClusters").raise(),this.d3el.select(".SubMapTiling").selectAll(".mapLandRoute").raise(),this.d3el.select(".SubMapTiling").selectAll(".mapCaps").raise()},changeElemOrder:function(){this.d3el.select(".SubMapTiling").selectAll(".SubMapGrids").raise(),this.d3el.select(".SubMapTiling").selectAll(".mapLandRoute").raise(),this.d3el.select(".SubMapTiling").selectAll(".mapCaps").raise()},updateView:function(t,e){this.resetSubList(),this.d3el.select(".SubMapTiling").select(".travelIcon").attr("transform","translate("+[t.x-this.travelIconSizeDiff.width,t.y-this.travelIconSizeDiff.height]+")scale("+this.travelIconScale+")"),this.updateUpdateSubList({path2This:void 0,subIds:[Number(e)],type:"mouseover"})},resetSubList:function(){d3.select("#subList").select("#subListSvg").selectAll(".listItemG").each(function(){var t=d3.select(this);t.classed("listItemClicked")||(t.classed("listItemHovered",!1),t.classed("listItemHoverDisabled",!1),t.select(".subSelected").style("opacity",0))})},resetCapsOpacity:function(){var t=this.d3el.select(".SubMapTiling").select(".mapCaps");t.selectAll(".nationalCaps").each(function(){d3.select(this).selectAll("circle").each(function(t,e){0===e?d3.select(this).style("stroke-opacity",1):1===e&&d3.select(this).style("fill-opacity",1)})}),t.selectAll(".provincialCaps").each(function(){d3.select(this).select("circle").style("stroke-opacity",1)})}})};var F={};function B(t,e){return[t.x(e[0]),t.y(e[1])]}function E(e,i){t(i).append(t(e))}}).call(e,i("4kSj"))},QJJ7:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZYAAABACAYAAAA56FEQAAAACXBIWXMAACxKAAAsSgF3enRNAAAMpklEQVR4nO1d23ruKAhN9ovPPPg0mW83zd9ERUEOQuK6aZuIoBhRRLru+/7vvu//LBfs+/79x/nzxHb+nbz/lNr372f7tczn1Z02q+tSx41u28A60ufQz4/82/Yh+pGyTbvf6/nQbb/l0rpOHtu+3f7OeBTq+u2G/fZ3T13f71ZYrlJbz7pu/FOey97sN3AMbWXet7YiyrTKUeVL+5tTZypX9r1cvgGI7wLUlev9IhtRrpR3xpNYF5o3s86/5ag6yH9u5XJbrudrmdvclnxHqPH4tRVpc55fH3luz/eftu+lMnlb/uJr+zrkhuTbto/seRuOOfOcX7av/27vl59p6Wv/uj3/swTCuq4fYa+/SyCdtK6Q5pUi5X3+jeEL0WLo8zbjaT3jlP02XrIWfjrBrM1+9PwL6zZLQVPutdZfalwPbBziSlcjRhiHeNmTQqEMS3FlJ4QREyk0sfz9u9S++zOYtsarXjauMbmitMM5f8taaKj3Pj3DtCXg9GyHiAuUfaDMrAmZJTavzWtimMQMS2sA1d5r0l7LaK2e+rCi2gWvTHEDgbIq1oaVnpekd0htN16wtPWMg7ieGbriscXXK/0189qE7C/x8aVbQWow7oDNh5hhaU3atffFVRaHNuksT5Pr8hlbsGvjih43CZXeCuJjBNDzkvQuaUGh7GINo2eGrnhs8fVKj2xem5D9JT6+dCtIXVx3wI47t64wloqJvW29k7mOrZLRg+TB+ugx7fG1e+uDZRukeL1Jz6N4s/hG7a+RcheeNQ0LZyUEuSawPEqHsFTaFj3mPQXUukrlMW2ilOstYwWOvBg9S7RVsr9aO2ivepYY2xa8s7IUOYS/C5bclD1ZOmbwlHlV3PLrn7Zh4VhRyDWB5VE6hKXS5nLoWnZKf2EPbjnPAMZouS1WnZyVNyagQ+q5FCiH9thnC3KXL/U9W2PUap7vaSrUgJZnjNw12hUVIrbFigqTAKpjrGSp7FZah7ntZ7Xwwf5d0pMwss1ier7SE/hOIPWk0U+BdYBdmD/asHj/iHQPY98zgTzhzg2jAilRJibE8GjD0tw+D93awwe5LfcHNtKozDf+oX2KSG2aep54No45TdSwSB30m9Ei6TQ+0vx8MT+EhtwkFpfl1G5Mc2iVx4jFLfG36Fkbo8ZnVHPNkptEfBQWNSyjDgYtDltHgMt3lKGvwTKMnEqr1uYG7yfqWRujxmdUxyNL7g7i1x3eQxixcoOi3nBRTBxa6Nnz3SdZCwfeheHoiqdnO4TcETm7ExKAOKOehuUHI1Zu0D0dKBy1lNKFc+eBFTcfFHnMvV2b+/QM02J41MpaIOSOaGR/xSTOqF9lWLysnsqh7feHlPxmPfd8JgjKEcTUsxxCtjicnuq3WiC8yrBQDj915ch599ypwORA89LmMFDurzfpWf3sU4Ovdn8h9NwFNblrO5mDZyljWDjDorG19uYqwPrPOZPJ0y/KSbdPo7+erueQQS9R+2ug3CUjEs6wcFdB2ildKIDaAiUbxCQwLNFneMF9CM9Rhq2kkr16nnvQIHi8t2Bl/l8Z4TBHbH012lYNI1O6YA5gew9zIVpAEDQtOxSWQ6s0Rs72q7W5Qc85tF9qciNkmy7QO7JvMnmv0lsrdxYal60BkV7yu9dYhkV6VYitr0br+bOhuC56+hadK6xJKwfpeysSY2QBdgxSMNUzkX7mCrsjC+NO3mv1lmxwL5W8n35D/vPkGW48ELX0HZCbpITyuzmBeIS4nqehmHAINcMS4jaxo1xhLb967T2lr7y5Qt52azyqnuddmA6MCl4YwvVkfpgUNcPCPmS3OHx1lCvs/k7mDCBCDilPh+z2Yedx9OwtbHmUPCSujmQ0u9G/H66yUK6wWoI+LlhRVsK8MfcWWrQY+lpKl8i++FJGg/O3TMuE/uLCj55/Yd1mKWjKvdb6S43rAdwJBoBKVyNGGIc4+9/4Lg0LJm4fs8qjDL4REyk0seDuLXBoobJxjAnmQuFtvJx0S7JdHJzSpQSMrnh6tkPEBcru7E4IGiyxuXFq93Hn0rBIuUewiftGgTo5lnKFYfvjadFAareUjcdIW8+0et4U9RUycHqmdBkL6fsPtefWKI0t6KC2x03isc0aUGmbsWto6rkfIVscTk81eeHx6NawSN9/kCzPxf0aQv9KU4I2MizboJ0rDMM7mp6HHbC7zLmFYR1T7kfkCtPAzBU2YdlfJfdX6X2L98wVpsB35gojIzcizJQuETFzhdFWN29MAaKelRdwf81cYS/B478pZkqXiBiZKyxFbbfSOsxt73Rq4YP4XdKTdzYj2yym5ys9ge8EUk8a/RQ5lB85fz7asHifFGuhoT2y90SNlWljoVd2D24itp6J9NMFSsPsrTuwHh9TwyKdvqNVGzeEUxtYl0fr/ZNWodwDaux9j1GYen4z3mOmTA2LeDZkLu+B6SzSKktGBpowOYe73lN4SKcCotRn0eapZxmESOkiTD2MM4n4GKPvjgpDrmY1Vr2YXGHc+zhYnz2Hx5Ng3eap534MizgbwpUPu0v5hxWaucJ+4Cnen7PK5q3Qn+Fq6c0Vpg0/erZDxB1RLVeYNrRyhSkTx8gVBgGTK6wX3nKFtd0bMG2NV73sM3YpzVxhVwzOFYZ1Y81cYXaYucJ6qO/jTsywtAZQ7b0m7bWMr9XTimrXk3KFWel5SXqH1HbjBUtbzziI65mhKx5bfL3SXzOvTcj+Eh9fuhWkBuMO2HyIGRbNaBdupEzro7M2OAe7+6q6505Fi7ZGP8LIWul5SSYdUluF+wvrwnKnZ4auOLwpNFCPsXTV/V0g+wuhZxLXPf2ltwLgddVgbj9lcoQ7vNc5SLc+tM15Y0KPsQkMZ0oX+fZJ1fcmPc+ULlTWQeUuPGsaFqm7J7VaWlExPSGYmgf9NUjw0ogS8gyqmwt6Do0Tr3dZouk5rJEKa1wZc+8QrmcFf9qGReruSa2W1sqtx0UCHfRr5wrjRutIPwMYo+W2cJlx3CqYgA6p51KgHNpT7qhgpJa+S2YFFm9Om5nt49yf43DnyF2jRaV02beZK2wkavcPenJI3Z9Vhgfh3sOTXWYj2yym5ys9ge8EUk8a/RRYBy5TuljD+0fUcxiLx3smkMiTJVv2aSgmHOLRhqW5fR66tYfPBFruj6iX5bQQqU1TzxPPxjGniRoWqYN+M1okncZHmrIuHUJDbhKLy3JaExPrUFF5jKi1GdDdk/WsjVHjM6q5ZslNIj4KixqWUQeDEoNM1y1F40257FZb1bboayldtNrMOlQUGCNZDQbRY1AQyjg9/8J6bEtBdXzW+kuFa8JfgRgxwjjEGbVLV5hYiDOhnhF++lpKl1r5n78YtFDZOP76Xn2tS3aRSEymJm9BXWnsXjQQ8vzL2Z2QAMQZtUvDIhbi7Hybj7ltDZenDYSnRQONCj+VhrQhmFFfEx7wqnBjL4amHNpevvjJTZ0xD3GJUO6vqWc5hGxxOD3Vb7VAeJVh8ZI3634Nof8WNsZH7ylXWAgo99eb9Kx+0VSDr3Z/Eb0UaKjJXdsBHzxLqf5nrjCHPmhqDiksPYb2KfCaK+yKp+t55gqjso4pd8mIhDMs3FWQdkoXCqC2QMkGMQkMS/QZXnAfwnPqEmgHwtXz3IMGweO9BSvz/8oIHzJyku99Ela2aAdGPmEie7CHuZSdToEYTctddUrfW5EYI2f71drcoIdyhXH1jJF6ukDvyL7J5L1Kb63cWYg5hzHGNyK95HevsQyL9KoQW1+N1vNng7lJTTnMhWh/amfQykH63orEGFmAHYMUKC4qtp6J9DNq7I7sm0zea/UW1+/CI++n35D/PNnUFSa+wzHirYWaywNyk5RQfhdzApHeLXjTu7iep6EIhPfoSs2wsFw1yA8Oqg3Ne2jEzP3vll+dYoTqfH3t6SgTa4u2RO+5vZH0PC9ZdiCT22YsDu2t9TApaoaFfchucfg6MJ9SjXXLTcLJA+Uth5SnQ3b7sPM4evYWtjxKHhJXRzKyJKEQ74erLFRUWG+6FgxmrrBlscgVZoFPIMd1vGQtPB/YtXnmCpODptxrrb/UuB7AnWAAqHQ1YoRxiLP/jR8qVxgmXcvMFYa/8/DUXGGlpI/nb+uSbBcN9T5zhcXA7uxOCBossblxavdx96pcYd7PF64oTY49ucIoq+JIULulbDxG2nqm1fOmqK+QgdPhwr1r8sJjza0rTPr+Q+25NcpxBOWD2h43icc2a0ClbcauoannfoRscTg91eSFx6NbwyJ9/0GyPBf3awj9K00J2siwbIN2rjAM72h6HnbArrWbVUZUubNzoWVZ/gfXT/Jl4M0dQgAAAABJRU5ErkJggg=="},QlnS:function(t,e){},T76Q:function(t,e,i){"use strict";var r=i("fZjL"),a=i.n(r),n=i("Gu7T"),s=i.n(n),l=i("lHA8"),o=i.n(l),h=i("c/Tr"),c=i.n(h),u=i("Dd8w"),d=i.n(u),f=i("NYxO"),p=i("by4E"),v={name:"SubProj",data:function(){return{dimDominatingThreshold:{browse:{low:.1,high:.9},airTravel:{low:.2,high:.8},groundTravel:{low:.2,high:.8}},showType:"respective",switchVal:!1,mode:"browse",groundTravelLegends:["Origin","Current position","Destination"],airTravelProjParam:2,btmLevelClsParam:2,maxProjNumOnScreen:4}},mounted:function(){var t=this;this.$nextTick(function(){t.setLayout()})},computed:d()({},Object(f.c)(["updateMap","changeMode","drawProjection","changeProjInBrowseMode","changeSubProjOpacity"])),watch:{updateMap:function(t,e){d3.select(this.$el).select("#switchBtn").style("visibility","visible"),this.updateParams(),this.map=t.map,this.leafNodes=c()(this.map.allLeaves.values()),t.resize&&this.setLayout(),null!=e.map&&this.clear(),this.init(),this.drawCapsProj(this.svg.select("#capsProjG"),null,"respective")},changeMode:function(t){switch(this.mode=t.mode,d3.selectAll(this.d3el.select("#projSvg").node().children).style("visibility","hidden"),t.mode){case"browse":var e=this.d3el.select("#projSvg").select("#capsProjG");e.selectAll("*").remove(),this.drawCapsProj(e,null,this.showType),e.style("visibility","visible");break;case"airTravel":(e=this.svg.select("#airTravelProjG")).select("#transitionProj").selectAll("*").remove(),e.style("visibility","visible");break;case"groundTravel":(e=this.svg.select("#groundTravelProjG")).select("#originProj").selectAll("*").remove(),e.select("#transitionProj").selectAll("*").remove(),e.select("#destinationProj").selectAll("*").remove(),this.updateProjParams(3),e.style("visibility","visible")}},drawProjection:function(t){if("groundTravel"===this.mode){if("origin"===t.type){var e=this.svg.select("#groundTravelProjG");e.select("#originProj").selectAll("*").remove(),e.select("#transitionProj").selectAll("*").remove(),e.select("#destinationProj").selectAll("*").remove(),this.drawProj(e.select("#originProj"),this.showType,t.subId,"city",null),this.originSubId=t.subId}else if("destination"===t.type){var i=this.svg.select("#groundTravelProjG");this.drawProj(i.select("#transitionProj"),this.showType,this.originSubId,"city",null),this.drawProj(i.select("#destinationProj"),this.showType,t.subId,"city",null)}else if("transition"===t.type){var r=this.svg.select("#groundTravelProjG").select("#transitionProj");this.switchCityProj(r,this.showType,t.subId)}}else if("airTravel"===this.mode){var a=this.svg.select("#airTravelProjG").select("#transitionProj");"origin"===t.type?(this.updateProjParams(this.airTravelProjParam),a.selectAll("*").remove(),this.drawProj(a,this.showType,t.subId,"city",null)):"transition"===t.type?this.switchCityProj(a,this.showType,t.subId):"clear"===t.type&&a.selectAll("*").remove()}},changeProjInBrowseMode:function(t){this.svg.select("#capsProjG").selectAll("*").remove(),this.drawCapsProj(this.svg.select("#capsProjG"),t.parentClsID,this.showType)},changeSubProjOpacity:function(t){var e=this;if("mouseover"===t.action){var i=t.clsID;i.includes("_")&&(i=i.replace("_",","));var r=c()(this.svg.select("#capsProjG").node().children).findIndex(function(t){return t.attributes.clsID.nodeValue===i});if(r+1>this.maxProjNumOnScreen){var a=this.svg.select("#capsProjG").selectAll(".capProj")._groups[0].length-this.maxProjNumOnScreen,n=(r-a>0?a:r)*(this.projHeight+this.projYPadding);d3.select("#subProjSvgContainer").transition().duration(1500).tween("uniquetweenname",s(n)).on("end",function(){e.svg.select("#capsProjG").selectAll(".capProj").filter(function(){return d3.select(this).attr("clsID")!==String(i)}).style("opacity",.2)})}else this.svg.select("#capsProjG").selectAll(".capProj").filter(function(){return d3.select(this).attr("clsID")!==String(i)}).style("opacity",.2)}else this.svg.select("#capsProjG").selectAll(".capProj").style("opacity",1),d3.select("#subProjSvgContainer").transition().duration(1500).tween("uniquetweenname",s(0));function s(t){return function(){var e=d3.interpolateNumber(this.scrollTop,t);return function(t){this.scrollTop=e(t)}}}}},methods:d()({},Object(f.b)(["updateUpdateSubList"]),{setLayout:function(){var t=d3.select(this.$el).select("#switchBtn"),e=t.node().getBoundingClientRect().width,i=parseFloat(d3.select(this.$el).select("#switchBtn").select(".el-switch").style("height"));t.style("width",e+"px").style("top","0px").style("height",i+"px");var r=this.$el.offsetHeight-i;d3.select(this.$el).select("#subProjSvgContainer").style("position","absolute").style("top",i+"px").style("left","0px").style("height",r+"px").style("width",this.$el.offsetWidth+"px")},updateParams:function(){this.switchBtnHeight=d3.select(this.$el).select("#switchBtn").node().getBoundingClientRect().height,this.width=this.$el.offsetWidth,this.height=this.$el.offsetHeight-this.switchBtnHeight,this.projYPadding=2*parseFloat(toPX("1rem")),this.d3el=d3.select(this.$el).select("#subProjSvgContainer"),this.boundaryCircleStrokeWidth=.00675*this.width,this.circleR=.0075*this.width,"Pendigits"===Data.file?this.circleR=.003*this.width:"Cloud"===Data.file&&(this.circleR=.005*this.width),"Pendigits"===Data.file&&(this.dimDominatingThreshold.browse.low=1/6,this.dimDominatingThreshold.browse.high=5/6),this.dimCircleR=.03*this.width,this.dimPointR={backgroundDimPoint:{"-1":.55*this.dimCircleR,0:.45*this.dimCircleR,1:.7*this.dimCircleR},midgroundDimPoint:{"-1":.55*this.dimCircleR,0:.45*this.dimCircleR,1:.7*this.dimCircleR},foregroundDimPoint:{"-1":.55*this.dimCircleR,0:.45*this.dimCircleR,1:.325*this.dimCircleR}},this.dimPointStrokeWidth={backgroundDimPoint:{"-1":.2*this.dimCircleR,0:0,1:.2*this.dimCircleR},midgroundDimPoint:{"-1":.2*this.dimCircleR,0:0,1:.2*this.dimCircleR},foregroundDimPoint:{"-1":.2*this.dimCircleR,0:0,1:0}},this.opcScale={browse:d3.scaleLinear().range([.1,1]),airTravel:d3.scaleLinear().domain(d3.extent(Data.dataWeights.flat())).range([.1,1]),groundTravel:d3.scaleLinear().range([.1,1]).clamp(!0)};var t=c()(new o.a(Data.nationalCaps.concat(Data.provincialCaps)));this.opcScale.groundTravel.domain(d3.extent(Data.dataWeights.filter(function(e,i){return-1!==t.indexOf(i)}).flat())),this.opcScaleNew=function(t){var e=20*t-10;return 1/(Math.exp(-e)+1)},this.unifiedProj=[];for(var e=Data.dataProjs[0].length,i=Math.ceil(Math.sqrt(e)),r=0;r<i;r++)for(var a=0;a<i;a++)this.unifiedProj.push([1*a/i,1*(i-r-1)/i]);this.unifiedProj.splice(e)},init:function(){var t=this;this.svgProjWidthDiff=2*this.switchBtnHeight,"Forestfires"===Data.file&&(this.svgProjWidthDiff=3.5*this.switchBtnHeight),this.svg=this.d3el.append("svg").attr("width",this.width).attr("height",this.height).append("g").attr("id","projSvg"),this.svg.append("g").attr("id","capsProjG");var e=this.svg.append("g").attr("id","groundTravelProjG").style("visibility","hidden"),i=this.svg.append("g").attr("id","airTravelProjG").style("visibility","hidden");this.updateProjParams(3),this.drawGroundTravelLegend(e),e.selectAll(".groundTravelProj").data([0,1,2]).enter().append("g").attr("id",function(t,e){return 0===e?"originProj":1===e?"transitionProj":2===e?"destinationProj":void 0}).attr("transform",function(e,i){return"translate("+t.svgProjWidthDiff/2+", "+(t.projHeight*i+t.projYPadding*(i+.5))+")"}),i.append("g").attr("id","transitionProj").attr("transform","translate("+this.svgProjWidthDiff/2+", "+this.projYPadding/2+")")},changeShowType:function(){var t=this;if("unified"===this.showType?(this.showType="respective",this.switchVal=!1):"respective"===this.showType&&(this.showType="unified",this.switchVal=!0),"browse"===this.mode)this.svg.select("#capsProjG").selectAll(".capProj").each(function(e,i){var r=Number(d3.select(this).attr("subId")),a=void 0;"unified"===t.showType?a=t.unifiedProj:"respective"===t.showType&&(a=Data.dataProjs[r]),d3.select(this).selectAll(".projPoints").data(a).join("circle").transition().duration(600).attr("cx",function(e){return t.projPointScale.x(e[0])}).attr("cy",function(e){return t.projPointScale.y(e[1])})});else if("groundTravel"===this.mode){var e=d3.select("#subMap").select(".SubMapTiling");e.selectAll(".landRoute").classed("routeUnselected",!1),SubMapTiling.selectAll(".seaRoute").classed("routeUnselected",!1),e.selectAll(".travelIcon").remove();var i=e.selectAll(".SubMapGrids");i.classed("travelUnselected",!1).classed("gridClicked",!1).attr("cursor","pointer").attr("opacity",1).on("mouseover",null).on("mouseout",null).on("click",null),this.resetSubList(),this.resetCapsOpacity();var r=Data.nationalCaps.concat(Data.provincialCaps),a=i.filter(function(){return-1!==r.indexOf(Number(d3.select(this).attr("index")))}),n=i.filter(function(){return-1===r.indexOf(Number(d3.select(this).attr("index")))});a.classed("travelUnselected",!1),a.classed("gridClicked",!1),n.attr("opacity",.2);var s=this.svg.select("#groundTravelProjG");s.select("#originProj").selectAll("*").remove(),s.select("#transitionProj").selectAll("*").remove(),s.select("#destinationProj").selectAll("*").remove(),this.updateUpdateSubList({path2This:void 0,subIds:r,type:"changeShownItems"})}else if("airTravel"===this.mode){var l=d3.select("#subMap").select(".SubMapTiling");l.selectAll(".landRoute").classed("routeUnselected",!1),SubMapTiling.selectAll(".seaRoute").classed("routeUnselected",!1),l.selectAll(".travelIcon").remove(),l.selectAll(".SubMapGrids").classed("travelUnselected",!1).classed("gridUnhovered",!1).classed("gridClicked",!1).attr("opacity",1),this.resetSubList(),this.svg.select("#airTravelProjG").select("#transitionProj").selectAll("*").remove()}},redraw:function(){this.clear(),this.drawCapsProj(this.svg.select("#capsProjG"),null,"respective")},clear:function(){this.showType="respective",this.mode="browse",this.switchVal=!1,d3.select(this.$el).select("#subProjSvgContainer").selectAll("*").remove()},drawCapsProj:function(t,e,i){var r=this,a=this,n=this.leafNodes,l=void 0,o=[],h=[],c=[],u=[];if(null===e){l=Data.nationalCaps.length,o=x(c=Data.nationalCaps);for(var d=0;d<o.length;d++)h.push([o[d]]),u.push(c[o[d]]);this.updateProjParams(l)}else{var f=Data.subtree.findByIndex(e);if(0===(l=f.children.length))l=1,h.push(e),u.push(f.data.centerLeafName[0]),this.updateProjParams(this.btmLevelClsParam);else{for(var v=0;v<l;v++){var g=f.children[v].data.centerLeafName[0];c.push(g)}o=x(c);for(var y=0;y<o.length;y++)h.push(e.concat(o[y])),u.push(c[o[y]]);this.updateProjParams(l)}}for(var m=[],b=0;b<h.length;b++){var S=h[b],w=Data.subtree.findByIndex(S).data.dataWeights;m.push.apply(m,s()(w))}var D=p.sub(1,m);function x(t){for(var e=[],i=function(i){var r=t[i],a=n.find(function(t){return t.ID===r});e.push(a.center.coordinates.y)},r=0;r<t.length;r++)i(r);return e.map(function(t,e){return{ind:e,val:t}}).sort(function(t,e){return t.val>e.val?1:t.val==e.val?0:-1}).map(function(t){return t.ind})}this.opcScale[this.mode].domain(d3.extent(D)),t.selectAll(".capProj").data(u).enter().append("g").attr("class","capProj").attr("subId",function(t){return t}).attr("clsID",function(t,e){return h[e]}).attr("transform",function(t,e){return"translate("+r.svgProjWidthDiff/2+", "+(r.projHeight*e+r.projYPadding*(e+.5))+")"}).each(function(t,e){a.drawProj(d3.select(this),i,t,"cap",h[e])})},updateProjParams:function(t){var e=t>this.maxProjNumOnScreen?this.maxProjNumOnScreen:t;this.projWidth=this.width-this.svgProjWidthDiff,this.projHeight=this.height/e-this.projYPadding,this.updateSvgHeight(t),this.projSize=Math.min(this.projHeight,this.projWidth),this.boundaryCircle={r:.95*this.projSize/2,cx:this.projWidth/2,cy:this.projHeight/2},this.boundaryCircleOffset={x:this.projWidth/2-this.boundaryCircle.r,y:this.projHeight/2-this.boundaryCircle.r},this.projOffset=.45*this.dimCircleR,this.projPointScale={x:d3.scaleLinear().domain([0,1]).range([this.boundaryCircleOffset.x+this.projOffset+(1-Math.sqrt(2)/2)*this.boundaryCircle.r,this.boundaryCircleOffset.x+2*this.boundaryCircle.r-this.projOffset-(1-Math.sqrt(2)/2)*this.boundaryCircle.r]),y:d3.scaleLinear().domain([1,0]).range([this.boundaryCircleOffset.y+this.projOffset+(1-Math.sqrt(2)/2)*this.boundaryCircle.r,this.boundaryCircleOffset.y+2*this.boundaryCircle.r-this.projOffset-this.projOffset-(1-Math.sqrt(2)/2)*this.boundaryCircle.r])},this.dimCircleCoords=[];for(var i=0;i<Data.dims.length;i++)this.dimCircleCoords.push([this.projWidth/2+this.boundaryCircle.r*Math.sin(2*Math.PI/Data.dims.length*i),this.projHeight/2-this.boundaryCircle.r*Math.cos(2*Math.PI/Data.dims.length*i)])},updateSvgHeight:function(t){var e=t>this.maxProjNumOnScreen?(this.projHeight+this.projYPadding)*t:this.height;this.d3el.select("svg").attr("height",e)},drawProj:function(t,e,i,r,n){var s=this,l=this,o=void 0;"unified"===e?o=this.unifiedProj:"respective"===e&&(o=Data.dataProjs[i]);var h="rgb("+[~~(255*Data.colors[i][0]),~~(255*Data.colors[i][1]),~~(255*Data.colors[i][2])]+")";"Pendigits"===Data.file&&30===i&&(h="rgb(5, 250, 120)");var c=void 0,u=void 0,d=void 0;if("cap"===r){var f=Data.subtree.findByIndex(n).data;c=f.dataWeights,u=f.dimCounts,d=this.checkDimDominating(u,f.aggrNum)}else if("city"===r){c=Data.dataWeights[i],d=[];for(var v=0;v<Data.subs[i].length;v++)"0"===Data.subs[i][v]?d.push(-1):d.push(1)}var g=p.sub(1,c);t.append("circle").attr("class","boundaryCircle").attr("cx",this.boundaryCircle.cx).attr("cy",this.boundaryCircle.cy).attr("r",this.boundaryCircle.r).style("stroke-width",this.boundaryCircleStrokeWidth).style("stroke",h).style("fill","white"),t.selectAll(".dimPointsG").data(this.dimCircleCoords).enter().append("g").attr("class","dimPointsG").attr("transform",function(t){return"translate("+t+")"}).each(function(t,e){!function(t,e,i,r){t.append("circle").attr("class","backgroundDimPoint").attr("cx",0).attr("cy",0).attr("r",l.getDimPointR("backgroundDimPoint",r)).style("fill","#fff").style("stroke","#fff").style("stroke-width",l.getDimPointStrokeWidth("backgroundDimPoint",r)),t.append("circle").attr("class","midgroundDimPoint").attr("cx",0).attr("cy",0).attr("r",l.getDimPointR("midgroundDimPoint",r)).style("fill","#fff").style("stroke",function(){return 1===r?i:"white"}).style("stroke-width",l.getDimPointStrokeWidth("midgroundDimPoint",r)),t.append("circle").attr("class","foregroundDimPoint").attr("cx",0).attr("cy",0).attr("r",l.getDimPointR("foregroundDimPoint",r)).style("fill",function(){return-1===r?"white":i}).style("stroke",function(){return 1===r?"none":i}).style("stroke-width",l.getDimPointStrokeWidth("foregroundDimPoint",r))}(d3.select(this),l.dimCircleR,h,d[e])}),t.append("g").attr("class","projPointsG").selectAll(".projPoints").data(o).enter().append("circle").attr("class","projPoints").attr("cx",function(t){return s.projPointScale.x(t[0])}).attr("cy",function(t){return s.projPointScale.y(t[1])}).attr("r",this.circleR).attr("opc",function(t,e){return.95*s.opcScaleNew(.9-s.opcScale[s.mode](g[e]))+.05}).style("fill",h).style("fill-opacity",function(t,e){return.95*s.opcScaleNew(.9-s.opcScale[s.mode](g[e]))+.05}),"Pendigits"===Data.file&&t.select(".projPointsG").selectAll(".projPoints").attr("digit",function(t,e){return Data.digit[e]}),function(e){for(var i=t.append("g").attr("transform","translate("+l.boundaryCircle.cx+", "+l.boundaryCircle.cy+")"),r=Data.dims,n=Data.dims.length,s=[],o=parseFloat(toPX("0.6rem")),h=l.boundaryCircle.r,c=0;c<n;c++){var u=o+h;0===c?u=1.3*o+h:n%2==0&&c===n/2?u=1.3*o+h:n%2!=1||c!==Math.ceil(n/2)-1&&c!==Math.ceil(n/2)||(u=1.3*o+h),s.push([u*Math.sin(2*Math.PI/n*c),-u*Math.cos(2*Math.PI/n*c)])}i.selectAll(".legend_text").data(s).enter().append("text").attr("class","legend_text").attr("id",function(t,e){return"legend_text"+e}).attr("x",function(t){return t[0]}).attr("y",function(t){return t[1]}).style("dominant-baseline","middle").style("font-size","0.85rem").style("text-anchor",function(t,e){return 0===e||e===n/2?"middle":e<n/2?"start":"end"}).text(function(t,e){return r[e]}).style("opacity",function(t,i){if("significant"===e){if(0===d[i])return 0}else if("involved"===e&&-1===d[i])return 0});var f={"OD280/OD315 of diluted wines":.75,"Nonflavanoid phenols":.8},p=a()(f);i.selectAll(".legend_text").each(function(t,e){p.indexOf(r[e])>-1&&d3.select(this).style("font-size",f[r[e]]+"rem")}),"Pendigits"===Data.file&&i.selectAll(".legend_text").style("font-size","0.75rem");var v={"OD280/OD315 of diluted wines":["OD280/OD315","of diluted wines"],"Alcalinity of ash":["Alcalinity of","ash"]},g=a()(v);i.selectAll(".legend_text").each(function(t,e){if(g.indexOf(r[e])>-1){for(var i=v[r[e]],a=.71*(i.length-1),n=[],s=0;s<i.length;s++)n.push(-a/2+.71*s);var l=d3.select(this);l.text(null).append("tspan").attr("x",t[0]).attr("y",t[1]).attr("dy",n[0]+"rem").text(i[0]);for(var o=1;o<i.length;o++)l.append("tspan").attr("x",t[0]).attr("y",t[1]).attr("dy",n[o]+"rem").text(i[o])}})}("cap"===r?"significant":"involved")},checkDimDominating:function(t,e){var i=this,r=new Array(t.length).fill(0),a=function(t){var e=i.dimDominatingThreshold[i.mode].low*t,r=i.dimDominatingThreshold[i.mode].high*t;return{low:e<1?1:e,high:r>t-1?t-1:r}}(e);if("Pendigits"===Data.file)for(var n=0;n<t.length;n++)t[n]>=a.high?r[n]=1:t[n]<=a.low&&(r[n]=-1);else for(var s=0;s<t.length;s++)t[s]>a.high?r[s]=1:t[s]<a.low&&(r[s]=-1);return r},getDimPointR:function(t,e){return this.dimPointR[t][String(e)]},getDimPointStrokeWidth:function(t,e){return this.dimPointStrokeWidth[t][String(e)]},switchCityProj:function(t,e,i){var r=this,a=void 0;"unified"===e?a=this.unifiedProj:"respective"===e&&(a=Data.dataProjs[i]);var n="rgb("+[~~(255*Data.colors[i][0]),~~(255*Data.colors[i][1]),~~(255*Data.colors[i][2])]+")";"Pendigits"===Data.file&&30===i&&(n="rgb(5, 250, 120)");for(var s=Data.dataWeights[i],l=p.sub(1,s),o=[],h=0;h<Data.subs[i].length;h++)"0"===Data.subs[i][h]?o.push(-1):o.push(1);this.dimCircleR;t.select(".boundaryCircle").transition().duration(600).style("stroke",n),t.selectAll(".projPoints").data(a).join("circle").transition().duration(600).attr("cx",function(t){return r.projPointScale.x(t[0])}).attr("cy",function(t){return r.projPointScale.y(t[1])}).style("fill",n).style("fill-opacity",function(t,e){return.95*r.opcScaleNew(.9-r.opcScale[r.mode](l[e]))+.05}),t.selectAll(".backgroundDimPoint").transition().duration(600).attr("r",function(t,e){return r.getDimPointR("backgroundDimPoint",o[e])}).style("stroke-width",function(t,e){return r.getDimPointStrokeWidth("backgroundDimPoint",o[e])}),t.selectAll(".midgroundDimPoint").transition().duration(600).attr("r",function(t,e){return r.getDimPointR("midgroundDimPoint",o[e])}).style("stroke",function(t,e){return 1===o[e]?n:"white"}).style("stroke-width",function(t,e){return r.getDimPointStrokeWidth("midgroundDimPoint",o[e])}),t.selectAll(".foregroundDimPoint").transition().duration(600).attr("r",function(t,e){return r.getDimPointR("foregroundDimPoint",o[e])}).style("fill",function(t,e){return-1===o[e]?"white":n}).style("stroke",function(t,e){return 1===o[e]?"none":n}).style("stroke-width",function(t,e){return r.getDimPointStrokeWidth("foregroundDimPoint",o[e])}),t.selectAll(".legend_text").transition().duration(600).style("opacity",function(t,e){return-1===o[e]?0:1})},drawGroundTravelLegend:function(t){var e=this,i=this.groundTravelLegends.length,r=.0125*this.width,a=this.height/i*.008;t.selectAll(".projLegend").data(this.groundTravelLegends).enter().append("text").attr("class","projLegend").attr("x",r).attr("y",function(t,r){return e.height/i*r+a}).text(function(t){return t})},resetSubList:function(){d3.select("#subList").select("#subListSvg").selectAll(".listItemG").each(function(){var t=d3.select(this);t.classed("listItemClicked")||(t.classed("listItemHovered",!1),t.classed("listItemHoverDisabled",!1),t.select(".subSelected").style("opacity",0))})},resetCapsOpacity:function(){var t=d3.select("#subMap").select(".SubMapTiling").select(".mapCaps");t.selectAll(".nationalCaps").each(function(){d3.select(this).selectAll("circle").each(function(t,e){0===e?d3.select(this).style("stroke-opacity",1):1===e&&d3.select(this).style("fill-opacity",1)})}),t.selectAll(".provincialCaps").each(function(){d3.select(this).select("circle").style("stroke-opacity",1)})}})},g={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"subProj"}},[i("div",{attrs:{id:"subProjSvgContainer"}}),t._v(" "),i("div",{attrs:{id:"switchBtn"}},[i("el-switch",{attrs:{"active-color":"#ddd","inactive-color":"#ddd","active-text":"Stability","inactive-text":"Projection"},on:{change:t.changeShowType},model:{value:t.switchVal,callback:function(e){t.switchVal=e},expression:"switchVal"}})],1)])},staticRenderFns:[]};var y=i("VU/8")(v,g,!1,function(t){i("8KhV")},null,null);e.a=y.exports},Uhku:function(t,e,i){"use strict";(function(t){var r=i("fZjL"),a=i.n(r),n=i("Dd8w"),s=i.n(n),l=i("NYxO"),o=i("VLFt"),h=i("l8Mu"),c=i("VScy"),u=i("T76Q"),d=i("49/g"),f=i("yqkC"),p=i("QJJ7");e.a={name:"Main",components:{LoadingPage:o.a,SubList:h.a,SubMap:c.a,SubProj:u.a},data:function(){return{popoverActive:!1,defaultFile:"Forestfires",fileList:["Forestfires","Glass","Pendigits"],changeSubColor:!1,fanRRatio:.95,circleRRatio:1}},mounted:function(){var t=this;this.$nextTick(function(){d3.select(t.$el).select("#my-dropdown").select(".nav-link.dropdown-toggle").style("color","white").style("opacity",.7).style("box-shadow","none").style("outline","none").on("mouseover",function(){d3.select(this).style("opacity",1)}).on("mouseout",function(){d3.select(this).style("opacity",.7)}),t.loadData(t.defaultFile);window.onresize=function(){d3.select("#loading-page").raise().style("display","block"),setTimeout(function(){t.updateResize(),t.drawDimGlyphLegends()},10)}})},methods:s()({},Object(l.b)(["updateResize"]),{changeData:function(t){var e=this;d3.select("#loading-page").raise().style("display","block"),setTimeout(function(){e.loadData(t)},10)},loadData:function(e){var i=this,r=t.Deferred();d3.json("./../../subspace-map/static/data/"+e+"/result.json").then(function(t){Data=t,Data.file=e,"Pendigits-k25"===e&&(Data.subtree.data.initProjection[0]=[.48,.56]),Data.nationalCaps=[],Data.provincialCaps=[];for(var a=0;a<Data.subtree.children.length;a++){var n=Data.subtree.children[a];Data.nationalCaps.push(n.data.centerLeafName[0]);for(var s=0;s<n.children.length;s++){var l=n.children[s].data.centerLeafName[0];-1===Data.nationalCaps.indexOf(l)&&Data.provincialCaps.push(l)}}Data.dataWeightsExtent=d3.extent(Data.dataWeights.flat()),Data.subtree.findByIndex=function(t){if(null==t)return null;for(var e=this,i=0;i<t.length;i++)0==e.children.length&&0==parseInt(t[i])||(e=e.children[t[i]]);return e},i.changeSubColor?(Data.colors=[],d.a.ranges={x:d3.extent(Data.subProjs,function(t){return t[0]}),y:d3.extent(Data.subProjs,function(t){return t[1]})},d.a.setColormap(f,function(){for(var t=0;t<Data.subProjs.length;t++){var e=d.a.getColor(Data.subProjs[t][0],Data.subProjs[t][1]);Data.colors.push(e.map(function(t){return t/255}))}r.resolve()})):r.resolve()}),t.when(r).done(function(){i.$store.state.loadedData=e,i.drawDimGlyphLegends(),console.log("Data:\n",Data)})},drawDimGlyphLegends:function(){d3.select("#dimGlyphSvg").selectAll("*").remove();var t=parseFloat(d3.select("#dimGlyphContainer").style("width")),e=parseFloat(d3.select("#dimGlyphContainer").style("height"))/1.25,i=Math.min(t,e)-2.5*toPX("0.9rem"),r=i/2*this.fanRRatio,n=.1*r,s=.9*r,l=i/2*this.circleRRatio;d3.select("#dimGlyphSvg").attr("width",t).attr("height",e);var o=d3.select("#dimGlyphSvg").append("g");!function(i,r){for(var a=Data.dims,n=o.append("g").attr("transform","translate("+t/2+", "+e/2+")"),s=2*Math.PI/a.length,l=d3.arc().outerRadius(r).innerRadius(i).startAngle(.3*-s).endAngle(.3*s),h=0;h<a.length;h++){var c=360/a.length*h;n.append("g").attr("class","legend_dimFan").attr("transform","rotate("+c+")").attr("id","legend_dimFan"+h).append("path").attr("d",l()).attr("fill","#252525")}}(n,s),function(i){for(var r=o.append("g").attr("transform","translate("+t/2+", "+e/2+")"),a=Data.dims.length,n=.05*i,s=[],l=0;l<a;l++)s.push([i*Math.sin(2*Math.PI/a*l),-i*Math.cos(2*Math.PI/a*l)]);r.append("circle").attr("class","legend_boundaryCircle").attr("cx",0).attr("cy",0).attr("r",i).style("stroke-width",.02*i).style("stroke","#252525").style("fill","none"),r.selectAll(".legend_dimPointsG").data(s).enter().append("g").attr("class","legend_dimPointsG").attr("id",function(t,e){return"legend_dimPointsG"+e}).attr("transform",function(t){return"translate("+t+")"}).each(function(){var t=d3.select(this);t.append("circle").attr("cx",0).attr("cy",0).attr("r",n).attr("fill","#252525")})}(l),function(i){for(var r=o.append("g").attr("transform","translate("+t/2+", "+e/2+")"),n=Data.dims,s=Data.dims.length,l=[],h=parseFloat(toPX("0.35rem")),c=0;c<s;c++){var u=h+i;0===c?u=1.75*h+i:s%2==0&&c===s/2?u=1.75*h+i:s%2!=1||c!==Math.ceil(s/2)-1&&c!==Math.ceil(s/2)||(u=1.75*h+i),l.push([u*Math.sin(2*Math.PI/s*c),-u*Math.cos(2*Math.PI/s*c)])}r.selectAll(".legend_text").data(l).enter().append("text").attr("class","legend_text").attr("id",function(t,e){return"legend_text"+e}).attr("x",function(t){return t[0]}).attr("y",function(t){return t[1]}).style("dominant-baseline","middle").style("text-anchor",function(t,e){return 0===e||e===s/2?"middle":e<s/2?"start":"end"}).style("font-size","0.85rem").text(function(t,e){return n[e]});var d={"OD280/OD315 of diluted wines":["OD280/OD315","of diluted wines"],"Alcalinity of ash":["Alcalinity of","ash"]},f=a()(d);r.selectAll(".legend_text").each(function(t,e){if(f.indexOf(n[e])>-1){for(var i=d[n[e]],r=.71*(i.length-1),a=[],s=0;s<i.length;s++)a.push(-r/2+.71*s);var l=d3.select(this);l.text(null).append("tspan").attr("x",t[0]).attr("y",t[1]).attr("dy",a[0]+"rem").text(i[0]);for(var o=1;o<i.length;o++)l.append("tspan").attr("x",t[0]).attr("y",t[1]).attr("dy",a[o]+"rem").text(i[o])}})}(l),function(){var i=o.append("g").attr("transform","translate(0, "+e+")"),r=parseFloat(toPX("1rem")),a=r,n=.1*a,s=.9*a,l=Math.PI/4,h=d3.arc().outerRadius(s).innerRadius(n).startAngle(.3*-l).endAngle(.3*l),c=r/2*.9,u=t/5,d=u+r/6;d3.select("#dimGlyphSvg").attr("height",e+3*r);var f=parseFloat(d3.select("#dimGlyphSvg").style("height")),v=parseFloat(d3.select("#dimGlyphContainer").style("top"));d3.select("#dimGlyphContainer").style("height",f+"px");var g=parseFloat(d3.select("#subMapContainer").style("height"));d3.select("#subProjContainer").style("top",v+f+"px").style("height",g-f+"px");var y=t/20,m=t/2,b=i.append("g"),S=b.append("g").attr("transform","translate("+y+", 0)"),w=b.append("g").attr("transform","translate("+m+", 0)");S.append("g").attr("transform","translate("+u/2+", "+r+")rotate(45)").append("path").attr("d",h()).attr("fill","#252525"),S.append("text").attr("x",d).attr("y",r/2).style("dominant-baseline","middle").style("font-size","0.85rem").text("Included"),w.append("circle").attr("cx",c).attr("cy",r/2).attr("r",.7*c).attr("fill","white").attr("stroke","#252525").attr("stroke-width",.15*c),w.append("circle").attr("cx",c).attr("cy",r/2).attr("r",.325*c).attr("fill","#252525"),w.append("text").attr("x",2*c).attr("y",r/2).style("dominant-baseline","middle").style("font-size","0.85rem").text("Commonly included");var D=i.append("g").attr("transform","translate(0, "+r+")"),x=D.append("g").attr("transform","translate("+y+", 0)"),P=D.append("g").attr("transform","translate("+m+", 0)");x.append("g").attr("transform","translate("+u/2+", "+r+")rotate(45)").append("path").attr("d",h()).attr("fill","none").attr("stroke-width",a/15).attr("stroke","#252525"),x.append("text").attr("x",d).attr("y",r/2).style("dominant-baseline","middle").style("font-size","0.85rem").text("Excluded"),P.append("circle").attr("cx",c).attr("cy",r/2).attr("r",.55*c).attr("fill","white").attr("stroke","#252525").attr("stroke-width",.15*c),P.append("text").attr("x",2*c).attr("y",r/2).style("dominant-baseline","middle").style("font-size","0.85rem").text("Commonly excluded");var C=i.append("g").attr("transform","translate(0, "+2*r+")"),M=C.append("g").attr("transform","translate("+y+", 0)"),A=C.append("g").attr("transform","translate("+m+", 0)");M.append("image").attr("href",p).attr("x",0).attr("y",0).attr("height",.9*r).attr("width",u),M.append("text").attr("x",d).attr("y",r/2).style("dominant-baseline","middle").style("font-size","0.85rem").text("Stability"),A.append("circle").attr("cx",c).attr("cy",r/2).attr("r",.45*c).attr("fill","#252525"),A.append("text").attr("x",2*c).attr("y",r/2).style("dominant-baseline","middle").style("font-size","0.85rem").text("Normal")}()}})}}).call(e,i("4kSj"))},VLFt:function(t,e,i){"use strict";i("NYxO");var r={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"loading-page"}},[e("div",{staticClass:"background"}),this._v(" "),e("div",{staticClass:"loading-icon"},[e("span",[e("i",{staticClass:"fa fa-spinner fa-spin",attrs:{"aria-hidden":"true"}})])])])}]};var a=i("VU/8")({name:"LoadingPage",data:function(){return{}},mounted:function(){},computed:{},watch:{}},r,!1,function(t){i("QlnS")},"data-v-792ef50e",null);e.a=a.exports},VScy:function(t,e,i){"use strict";var r=i("PJka"),a={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"subMap"}},[e("div",{attrs:{id:"map"}}),this._v(" "),e("MapPanel")],1)},staticRenderFns:[]};var n=function(t){i("xTLl")},s=i("VU/8")(r.a,a,!1,n,null,null);e.a=s.exports},WCga:function(t,e){},X8Br:function(t,e,i){"use strict";var r=i("lHA8"),a=i.n(r),n=(i("pFYg"),i("fZjL")),s=i.n(n),l=i("gRE1"),o=i.n(l),h=i("mvHQ"),c=i.n(h),u=i("c/Tr"),d=i.n(u),f=i("d7EF"),p=i.n(f),v=i("BO1k"),g=i.n(v),y=i("ifoU"),m=i.n(y),b=i("Gu7T"),S=i.n(b),w=i("Zrlr"),D=i.n(w),x=i("wxAW"),P=i.n(x),C=i("Lsc3");function M(t,e,i,r){if(!(t>e)){for(var a,n=t,s=e,l=i[n];n!=s;){for(;i[s][r]>=l[r]&&n<s;)s--;for(;i[n][r]<=l[r]&&n<s;)n++;n<s&&(a=i[n],i[n]=i[s],i[s]=a)}i[t]=i[n],i[n]=l,M(t,n-1,i,r),M(n+1,e,i,r)}}var A,I=(A=new a.a,function(t){return t.parent=t,t.rank=0,A.has(t)||A.add(t),A});function R(t){return t.parent!=t&&(t.parent=R(t.parent)),t.parent}function k(t,e){var i=R(t),r=R(e);i!=r&&(i.rank<r.rank?i.parent=r:i.rank>r.rank?r.parent=i:(r.parent=i,i.rank=i.rank+1))}function T(t){var e=[],i=!0,r=!1,a=void 0;try{for(var n,s=g()(t.V);!(i=(n=s.next()).done);i=!0){var l=n.value;I(l)}}catch(t){r=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw a}}var o=!0,h=!1,c=void 0;try{for(var u,d=g()(t.E);!(o=(u=d.next()).done);o=!0){u.value;M(0,t.E.length-1,t.E,"w")}}catch(t){h=!0,c=t}finally{try{!o&&d.return&&d.return()}finally{if(h)throw c}}var f=!0,p=!1,v=void 0;try{for(var y,m=g()(t.E);!(f=(y=m.next()).done);f=!0){var b=y.value,S=t.V[t.refer.get(b.u)],w=t.V[t.refer.get(b.v)];R(S)!=R(w)&&(e.push(b),k(S,w))}}catch(t){p=!0,v=t}finally{try{!f&&m.return&&m.return()}finally{if(p)throw v}}return e}function j(){if(!(this instanceof j))return new j;this.edges=null,this.id=null,this.data=null}function _(){if(!(this instanceof _))return new _;this.V=[],this.E=[],this.refer=new m.a}_.prototype={constructor:_,initVertex:function(t){var e=!0,i=!1,r=void 0;try{for(var a,n=g()(t);!(e=(a=n.next()).done);e=!0){var s=a.value,l=j();l.id=s.id,this.V.push(l)}}catch(t){i=!0,r=t}finally{try{!e&&n.return&&n.return()}finally{if(i)throw r}}for(var o in this.V)this.refer.set(this.V[o].id,o)},initEdge:function(){function t(e,i,r,a){if(e>=i)return null;var n=function t(){if(!(this instanceof t))return new t;this.index=null,this.sibling=null,this.w=null}();return n.index=a.get(r[e].id),n.w=r[e].w,n.sibling=t(++e,i,r,a),n}return function(e){for(var i in e){var r=this.refer.get(i);this.V[r].edges=t(0,e[i].length,e[i],this.refer)}}}(),storageEdge:function(t){this.E=t}};var L=i("/8dj"),O=i("t4zo"),N=function(){function t(e,i,r){D()(this,t);if(void 0===r){this.nearestSeaRoute=!1,this.kc=3,this.ks=10,this.leafNodes=e,this.gridScales=i,this.cls=[];for(var a=0;a<Data.subHierClusters.length;a++){var n;if(Array.isArray(Data.subHierClusters[a]))this.cls.push((n=[]).concat.apply(n,S()(Data.subHierClusters[a])))}this.distMat=Data.subDistMat,this.caps=[];for(var s=0;s<Data.subtree.children.length;s++){var l=Data.subtree.children[s];this.caps.push([]),this.caps[s].push(l.data.centerLeafName[0]);for(var o=0;o<l.children.length;o++){var h=l.children[o].data.centerLeafName[0];this.caps[s].push(h)}}this.initShapeInfo(i,.0015),this.init(i),this.saveRes()}else for(var c in r)if("landSubCoords"===c){this[c]=new m.a;var u=!0,d=!1,f=void 0;try{for(var p,v=g()(r[c]);!(u=(p=v.next()).done);u=!0){var y=p.value;this[c].set(y[0],y[1])}}catch(t){d=!0,f=t}finally{try{!u&&v.return&&v.return()}finally{if(d)throw f}}}else this[c]=r[c]}return P()(t,[{key:"initShapeInfo",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=d3.select("#subMap").select(".SubMapTiling");this.shapes=[];for(var a=0;a<Data.nationalCaps.length;a++){var n=o(r.select(".SubCls_"+a).data()[0].center,r.select(".SubCls_"+a).data()[0].paths[0].points,t,i);this.shapes.push(L.b.path(d3.line()(n)))}for(var s=function(i){for(var a=Data.subtree.leaves[i],n=function(t,e,i){for(var r=[],a=0;a<t.length;a++)r.push([F(e,[t[a].start.coordinates.x,t[a].start.coordinates.y]),F(e,[t[a].end.coordinates.x,t[a].end.coordinates.y])]);return r}(d()(r.selectAll(".SubMapGrids").filter(function(){return d3.select(this).attr("index")===String(a)}).data()[0].edges._c.values()),t),s=0;s<n.length;s++)e.shapes.push(L.b.line(n[s].flat()))},l=0;l<Data.subtree.leaves.length;l++)s(l);function o(t,e,i,r){for(var a=[],n=i.x.range()[1]-i.x.range()[0],s=i.y.range()[1]-i.y.range()[0],l=0;l<e.length;l++){var o=F(i,[e[l].coordinates.x,e[l].coordinates.y]),h=p()(o,2),c=h[0],u=h[1],d=c<t[0]?c-n*r:c+n*r,f=u<t[1]?u-s*r:u+s*r;a.push([d,f])}return a}}},{key:"init",value:function(t){this.harborIcon="M512 0C375.467 0 273.067 106.974 273.067 238.933a238.387 238.387 0 0 0 170.666 227.874V879.07c-63.488-11.264-128-37.547-180.77-86.699C191.078 725.47 136.67 618.974 136.67 443.597a68.267 68.267 0 1 0-136.67 0C0 648.602 69.086 798.31 169.984 892.245 270.882 986.25 398.541 1024 512 1024c113.732 0 241.323-38.23 342.153-132.437s169.71-243.917 169.71-447.966c4.438-95.232-140.834-95.232-136.396 0 0 174.285-54.614 280.917-126.498 348.16-52.839 49.288-117.283 75.776-180.702 87.176V467.081a238.524 238.524 0 0 0 170.666-228.148C750.933 106.973 648.533 0 512 0z m0 136.533a102.4 102.4 0 1 1 0 204.8 102.4 102.4 0 0 1 0-204.8z",this.harborIconScale=.005,this.initLandRoute(t),this.initBoundaryGraph(),this.initWaterRoute(t),this.addLandRoute(t),this.splitLandRoute(),this.combineLandRoute(),this.getLandSubCoords()}},{key:"saveRes",value:function(){var t=new Blob([c()(this)],{type:"text/plain;charset=utf-8"});Object(O.saveAs)(t,"route.json")}},{key:"initLandRoute",value:function(t){var e=this;this.landGraph=[],this.landRoute=[],this.landMST=[],this.landRouteCoords=[];for(var i=0;i<this.cls.length;i++){for(var r=this.cls[i],a={},n=function(t){for(var i=r[t],n=e.leafNodes.find(function(t){return t.ID===i}),s=d()(n.neighbors.values()),l={},h=function(t){var r=e.leafNodes.find(function(e){return c()(o()(e.position))===c()(s[t])});void 0!==r&&(l[r.ID]=e.distMat[i][r.ID])},u=0;u<s.length;u++)h(u);a[i]=l},s=0;s<r.length;s++)n(s);this.landGraph.push(new C.a(a));var l={};for(s=0;s<this.caps[i].length;s++)for(var h=s+1;h<this.caps[i].length;h++)l[[this.caps[i][s],this.caps[i][h]]]=this.landGraph[i].findShortestPath(this.caps[i][s],this.caps[i][h]).map(Number);for(var u=[],f=[],p=0;p<this.caps[i].length;p++){u.push({id:this.caps[i][p]});for(var v=p+1;v<this.caps[i].length;v++)f.push({u:this.caps[i][p],v:this.caps[i][v],w:l[[this.caps[i][p],this.caps[i][v]]].length})}var g=_();g.initVertex(u),g.storageEdge(f),this.landMST[i]=T(g),this.landRoute[i]={},this.landRouteCoords.push([]);for(var y=function(r){e.landRouteCoords[i].push([]);var a=l[[e.landMST[i][r].u,e.landMST[i][r].v]];e.landRoute[i][[e.landMST[i][r].u,e.landMST[i][r].v]]=a;for(var n=function(n){var s=e.leafNodes.find(function(t){return t.ID===a[n]});e.landRouteCoords[i][r].push({x:t.x(s.center.coordinates.x),y:t.y(s.center.coordinates.y)})},s=0;s<a.length;s++)n(s)},m=0;m<this.landMST[i].length;m++)y(m)}}},{key:"initBoundaryGraph",value:function(){var t=this,e=this.leafNodes,i=(this.cls,function(){for(var t=[],i=0;i<e.length;i++)t.push(o()(e[i].position));return t}()),r=function(e,i){for(var r=[],a=e[0][0];a<e[0][1];a++)for(var n=e[1][0];n<e[1][1];n++)t._arrayAlreadyHasArray(i,[a,n])||r.push([a,n]);return r}(function(t){var e=d3.extent(t,function(t){return t[0]}),i=d3.extent(t,function(t){return t[1]});return[e,i]}(i),i);this.emptyPositions=r;var a=this._boundarySubs();this.clusterBoundarySubs=JSON.parse(c()(a));var n=this._boundarySubPositions();this.clusterBoundaryPositions=JSON.parse(c()(n)),n=n.flat();var s=r.concat(n),l={},h=!0,u=!1,d=void 0;try{for(var f,p=g()(s);!(h=(f=p.next()).done);h=!0){var v=f.value,y={},m=M(v,r),b=!0,S=!1,w=void 0;try{for(var D,x=g()(m);!(b=(D=x.next()).done);b=!0){var P=D.value;y[String(P)]=this._neighborManhattanDist(v,P)}}catch(t){S=!0,w=t}finally{try{!b&&x.return&&x.return()}finally{if(S)throw w}}l[String(v)]=y}}catch(t){u=!0,d=t}finally{try{!h&&p.return&&p.return()}finally{if(u)throw d}}function M(e,i){var r=function(t){var e={i:t[0],j:t[1]},i=[],r=void 0,a=void 0,n=void 0,s=void 0;e.j%2==0?(r=1,a=e.i>=0?1:0,n=e.i<=0?-1:0,s=-1):(r=-1===e.i?2:1,a=e.i<0?1:0,n=e.i>0?-1:0,s=1===e.i?-2:-1);return i.push([e.i+r,e.j]),i.push([e.i+a,e.j+1]),i.push([e.i+n,e.j+1]),i.push([e.i+s,e.j]),i.push([e.i+n,e.j-1]),i.push([e.i+a,e.j-1]),i}(e),a=[],n=!0,s=!1,l=void 0;try{for(var o,h=g()(r);!(n=(o=h.next()).done);n=!0){var c=o.value;t._arrayAlreadyHasArray(i,c)&&a.push(c)}}catch(t){s=!0,l=t}finally{try{!n&&h.return&&h.return()}finally{if(s)throw l}}return a}this.boundaryGraph=new C.a(l)}},{key:"initWaterRoute",value:function(t){var e=this,i=this;this.waterGraph={},this.waterMST=null,this.waterRoute={},this.waterRouteCoords={},this.harbor=[],this.harborCityPos=[],this.harborPos=[],this.harborCoords=[],this.harborRouteCorrespondence=[],this.seaGraph=[],this.seaRoutePos=[],this.seaRouteOD=[],this.seaRouteCoords=[];for(var r={},a={},n=[],l=0;l<this.cls.length;l++){for(var h=this.cls[l],u={},f=function(t){for(var i=h[t],r=e.leafNodes.find(function(t){return t.ID===i}),a=o()(r.position),n=d()(r.neighbors.values()),s={},l=function(t){var i=e.leafNodes.find(function(e){return c()(o()(e.position))===c()(n[t])});void 0!==i&&(s[i.ID]=e._neighborManhattanDist(a,n[t]))},f=0;f<n.length;f++)l(f);u[i]=s},p=0;p<h.length;p++)f(p);n.push(new C.a(u))}for(var v=this._nearestCapPair(),y=this._capsInNearestCapPair(v),b=this._capNearestBoundarySubs(y),w=0;w<n.length;w++){var D=Tt(n[w].map);for(p=w+1;p<n.length;p++){var x=jt(D,Tt(n[p].map)),P=!0,M=!1,A=void 0;try{for(var I,R=g()(v[[w,p]]);!(P=(I=R.next()).done);P=!0){var k=I.value,j=b[k[0]],L=b[k[1]],O=!0,N=!1,B=void 0;try{for(var E,G=g()(j);!(O=(E=G.next()).done);O=!0){var H=E.value,U=_t(H),W=!0,z=!1,Y=void 0;try{for(var V,X=g()(L);!(W=(V=X.next()).done);W=!0){var q=V.value,J=_t(q),K=this._boundarySubManhattanDist(U,J);x[H][q]=K,x[q][H]=K}}catch(t){z=!0,Y=t}finally{try{!W&&X.return&&X.return()}finally{if(z)throw Y}}}}catch(t){N=!0,B=t}finally{try{!O&&G.return&&G.return()}finally{if(N)throw B}}}}catch(t){M=!0,A=t}finally{try{!P&&R.return&&R.return()}finally{if(M)throw A}}this.waterGraph[[w,p]]=new C.a(x);var Q=this._shortestPathBetweenCapPair(w,p);r[[w,p]]=Q.route,a[[w,p]]=Q.dist}}for(var Z=[],$=[],tt=0;tt<this.landGraph.length;tt++){Z.push({id:tt});for(var et=tt+1;et<this.landGraph.length;et++)$.push({u:tt,v:et,w:a[[tt,et]]})}var it=_();it.initVertex(Z),it.storageEdge($),this.waterMST=T(it);for(var rt=0;rt<this.waterMST.length;rt++){var at,nt,st=[this.waterMST[rt].u,this.waterMST[rt].v];this.waterRoute[st]=r[st],this.waterRouteCoords[st]=[];for(var lt=function(i){var r=e.waterRoute[st][i],a=e.leafNodes.find(function(t){return t.ID===r}),n=t.x(a.center.coordinates.x),s=t.y(a.center.coordinates.y);e.waterRouteCoords[st].push({x:n,y:s})},ot=0;ot<this.waterRoute[st].length;ot++)lt(ot);this.harborRouteCorrespondence.push(String(st)),this.harborRouteCorrespondence.push(String(st));var ht=this._routeHarbor(this.waterRoute[st]);(at=this.harbor).push.apply(at,S()(ht));var ct=this._routeHarborPos(ht);(nt=this.harborPos).push.apply(nt,S()(ct))}for(var ut=0;ut<this.harborPos.length;ut++)this.harborCoords.push(Lt(this.harborPos[ut],t));for(var dt=0;dt<s()(this.waterRoute).length;dt++){for(var ft=o()(this.waterRoute)[dt],pt=[],vt=[],gt=[],yt=0;yt<ft.length;yt++){var mt=this._allIndexes(this.harbor,ft[yt]);if(mt.length>0){var bt=String(s()(this.waterRoute)[dt]),St=!0,wt=!1,Dt=void 0;try{for(var xt,Pt=g()(mt);!(St=(xt=Pt.next()).done);St=!0){var Ct=xt.value;this.harborRouteCorrespondence[Ct]===bt&&(pt.push(this.harbor[Ct]),vt.push(this.harborPos[Ct]),gt.push(this.harborCoords[Ct]))}}catch(t){wt=!0,Dt=t}finally{try{!St&&Pt.return&&Pt.return()}finally{if(wt)throw Dt}}}}for(var Mt=0;Mt<pt.length-1;Mt++){Number(this._findIndex(pt[Mt],Data.subHierClusters)[0])===Number(this._findIndex(pt[Mt+1],Data.subHierClusters)[0])&&(pt.splice(Mt,1),Mt--)}for(var At=0;At<pt.length;At++){var It=this.harbor.indexOf(pt[At]);vt.push(this.harborPos[It]),gt.push(this.harborCoords[It])}var Rt=void 0,kt=(Rt=Nt(Ot(pt),t)).findShortestPath(String(gt[0]),String(gt[1])).map(function(t){return t.split(",").map(Number)});kt.unshift(Ut(pt[0],String(vt[0]),t)),kt.push(Ut(pt[1],String(vt[1]),t)),kt=zt(kt),this.seaRouteOD.push(pt),this.seaGraph.push(Rt),this.seaRouteCoords.push(kt)}function Tt(t){var e={};for(var i in t)for(var r in e[i]={},t[i])e[i][r]=t[i][r];return e}function jt(t,e){var i={};for(var r in t)i[r]=t[r];for(var a in e)i[a]=e[a];return i}function _t(t){var e=i.leafNodes.find(function(e){return e.ID===t});return[e.position.i,e.position.j]}function Lt(t,e){var i=[parseInt(t[0]),parseInt(t[1])];return F(e,[i[1]%2==0?2*i[0]:0===i[0]?0:1*(2-1/Math.abs(i[0]))*i[0],1*Math.sqrt(3)*i[1]])}function Ot(t){for(var e=Wt(t[0]),r=Wt(t[1]),a=Math.min(e.x[0],r.x[0])-3,n=Math.max(e.x[1],r.x[1])+3,s=Math.min(e.y[0],r.y[0])-3,l=Math.max(e.y[1],r.y[1])+3,o=[],h=function(t){for(var e=function(e){void 0===i.leafNodes.find(function(i){return i.position.i===t&&i.position.j===e})&&o.push(t+","+e)},r=s;r<l+1;r++)e(r)},c=a;c<n+1;c++)h(c);return o}function Nt(t,e){for(var i={},r=[[0,1],[0,2],[0,3],[0,4],[0,5],[0,6],[1,2],[1,6],[2,3],[3,4],[4,5],[5,6]].map(String),a=0;a<t.length;a++){var n=t[a],s=Ft(n.split(",").map(Number));Gt(i,r,Et(s,t,Bt(n.split(",").map(Number),e)));for(var l=0;l<s.length;l++){var o=s[l];if(t.indexOf(o)>-1)Ht(i,Lt(n.split(",").map(Number),e),Lt(o.split(",").map(Number),e))}}return new C.a(i)}function Ft(t){var e={i:t[0],j:t[1]},i=[],r=void 0,a=void 0,n=void 0,s=void 0;return e.j%2==0?(r=1,a=e.i>=0?1:0,n=e.i<=0?-1:0,s=-1):(r=-1===e.i?2:1,a=e.i<0?1:0,n=e.i>0?-1:0,s=1===e.i?-2:-1),i.push([e.i+r,e.j]),i.push([e.i+a,e.j+1]),i.push([e.i+n,e.j+1]),i.push([e.i+s,e.j]),i.push([e.i+n,e.j-1]),i.push([e.i+a,e.j-1]),i.map(String)}function Bt(t,e){var i=[],r=Lt(t,e),a=(Lt([t[0]+1,t[1]],e)[0]-r[0])/2/Math.cos(Math.PI/6);i[0]=r;for(var n=0;n<6;n++){var s=[r[0]+a*Math.cos(-Math.PI/6+Math.PI/3*n),r[1]+a*Math.sin(-Math.PI/6+Math.PI/3*n)];i.push(s)}return i}function Et(t,e,i){for(var r=new m.a,a=0;a<i.length;a++)r.set(a,i[a]);for(var n=0;n<t.length;n++)-1===e.indexOf(t[n])&&(5===n?(r.delete(1),r.delete(n+1)):(r.delete(n+1),r.delete(n+2)));return r}function Gt(t,e,i){for(var r=d()(i.keys()),a=0;a<r.length;a++)for(var n=0;n<r.length;n++){var s=String([r[a],r[n]]);if(e.indexOf(s)>-1){var l=i.get(r[a]),o=i.get(r[n]);Ht(t,l,o),Ht(t,o,l)}}}function Ht(t,e,i){var r=String(e),a=String(i);if(t.hasOwnProperty(r)||(t[r]={}),!t[r].hasOwnProperty(a)){var n=function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}(e,i);t[r][a]=n}}function Ut(t,e,r){var a=i.leafNodes.find(function(e){return e.ID===t}),n=Lt([a.position.i,a.position.j],r),s=Lt(e.split(",").map(Number),r);return[n[0]+(s[0]-n[0])/2,n[1]+(s[1]-n[1])/2]}function Wt(t){for(var e=Number(i._findIndex(t,Data.subHierClusters)[0]),r=Data.subHierClusters[e].flat(),a=[],n=[],s=function(t){var e=i.leafNodes.find(function(e){return e.ID===r[t]});a.push(e.position.i),n.push(e.position.j)},l=0;l<r.length;l++)s(l);return{x:d3.extent(a),y:d3.extent(n)}}function zt(t){for(var e=[],r=0;r<t.length-1;r++){var a=t[r],n=t[r+1];e.push([[a[0],a[1]],[n[0],n[1]]]);for(var s=e.length,l=r+1;l<t.length-1;l++){r=l-1;JSON.parse(c()(e[s-1])),t[l];var o=t[l+1],h=[[a[0],a[1]],[o[0],o[1]]];if(i.shapeIntersect(h))break;if(e[s-1][1]=[o[0],o[1]],l===t.length-2)return Yt(e)}}return Yt(e)}function Yt(t){var e=[];e.push.apply(e,S()(t[0]));for(var i=1;i<t.length;i++)e.push(t[i][1]);return e}}},{key:"_routeHarbor",value:function(t){for(var e=0;e<t.length-1;e++){if(Number(this._findIndex(t[e],Data.subHierClusters)[0])!==Number(this._findIndex(t[e+1],Data.subHierClusters)[0]))return[t[e],t[e+1]]}}},{key:"_allIndexes",value:function(t,e){var i=[],r=void 0;for(r=0;r<t.length;r++)t[r]===e&&i.push(r);return i}},{key:"_nearestCapPair",value:function(){for(var t=this,e={},i=this.caps,r=0;r<i.length;r++)for(var a=function(a){for(var n={},l=0;l<i[r].length;l++)for(var o=i[r][l],h=0;h<i[a].length;h++){var c=i[a][h];n[[o,c]]=t._subCoordsEuclideanDist(o,c)}var u=s()(n).sort(function(t,e){return n[t]-n[e]});e[[r,a]]=u.slice(0,t.kc).map(function(t){return t.split(",").map(Number)})},n=r+1;n<i.length;n++)a(n);return e}},{key:"_subCoordsEuclideanDist",value:function(t,e){var i=this._getCoordsFromSub(t),r=this._getCoordsFromSub(e);return Math.sqrt(Math.pow(i[0]-r[0],2)+Math.pow(i[1]-r[1],2))}},{key:"_getCoordsFromSub",value:function(t){var e=this.leafNodes.find(function(e){return e.ID===t});return[this.gridScales.x(e.center.coordinates.x),this.gridScales.y(e.center.coordinates.y)]}},{key:"_capsInNearestCapPair",value:function(t){var e=[],i=!0,r=!1,n=void 0;try{for(var s,l=g()(o()(t));!(i=(s=l.next()).done);i=!0){var h=s.value,c=!0,u=!1,f=void 0;try{for(var p,v=g()(h);!(c=(p=v.next()).done);c=!0){var y=p.value;e.push.apply(e,S()(y))}}catch(t){u=!0,f=t}finally{try{!c&&v.return&&v.return()}finally{if(u)throw f}}}}catch(t){r=!0,n=t}finally{try{!i&&l.return&&l.return()}finally{if(r)throw n}}return d()(new a.a(e))}},{key:"_capNearestBoundarySubs",value:function(t){var e=this,i={},r=function(t){var r=Number(e._findIndex(t,Data.subHierClusters)[0]),a=e.clusterBoundarySubs[r],n={},l=!0,o=!1,h=void 0;try{for(var c,u=g()(a);!(l=(c=u.next()).done);l=!0){var d=c.value;n[d]=e._subCoordsEuclideanDist(t,d)}}catch(t){o=!0,h=t}finally{try{!l&&u.return&&u.return()}finally{if(o)throw h}}var f=s()(n).sort(function(t,e){return n[t]-n[e]});i[t]=f.slice(0,e.ks).map(Number)},a=!0,n=!1,l=void 0;try{for(var o,h=g()(t);!(a=(o=h.next()).done);a=!0){r(o.value)}}catch(t){n=!0,l=t}finally{try{!a&&h.return&&h.return()}finally{if(n)throw l}}return i}},{key:"_boundarySubs",value:function(){var t=this,e=[],i=!0,r=!1,a=void 0;try{for(var n,s=g()(this.cls);!(i=(n=s.next()).done);i=!0){var l=n.value,h=[],u=function(e){var i=t.leafNodes.find(function(t){return t.ID===e}),r=d()(i.neighbors.values()),a=function(i){if(void 0===t.leafNodes.find(function(t){return c()(o()(t.position))===c()(i)}))return h.push(e),"continue"},n=!0,s=!1,l=void 0;try{for(var u,f=g()(r);!(n=(u=f.next()).done);n=!0)a(u.value)}catch(t){s=!0,l=t}finally{try{!n&&f.return&&f.return()}finally{if(s)throw l}}},f=!0,p=!1,v=void 0;try{for(var y,m=g()(l);!(f=(y=m.next()).done);f=!0){u(y.value)}}catch(t){p=!0,v=t}finally{try{!f&&m.return&&m.return()}finally{if(p)throw v}}h=h.map(c.a).reverse().filter(function(t,e,i){return-1===i.indexOf(t,e+1)}).reverse().map(JSON.parse),e.push(h)}}catch(t){r=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw a}}return e}},{key:"_boundarySubPositions",value:function(){var t=[],e=!0,i=!1,r=void 0;try{for(var a,n=g()(this.clusterBoundarySubs);!(e=(a=n.next()).done);e=!0){var s=a.value,l=[],o=!0,h=!1,c=void 0;try{for(var u,d=g()(s);!(o=(u=d.next()).done);o=!0){var f=u.value;l.push(this._subPos(f))}}catch(t){h=!0,c=t}finally{try{!o&&d.return&&d.return()}finally{if(h)throw c}}t.push(l)}}catch(t){i=!0,r=t}finally{try{!e&&n.return&&n.return()}finally{if(i)throw r}}return t}},{key:"_subPos",value:function(t){var e=this.leafNodes.find(function(e){return e.ID===t});return[e.position.i,e.position.j]}},{key:"_routeHarborPos",value:function(t){var e=t[0],i=t[1],r=o()(this.leafNodes.find(function(t){return t.ID===e}).position),a=o()(this.leafNodes.find(function(t){return t.ID===i}).position),n=this._copy2dObj(this.boundaryGraph.map);for(var s in n[String(a)])n[s][String(a)]=n[String(a)][s];var l=(n=new C.a(n)).findShortestPath(String(r),String(a));return[l[1].split(",").map(Number),l[l.length-2].split(",").map(Number)]}},{key:"_angle",value:function(t,e,i,r){var a=Math.atan2(r-e,i-t);return(a*=180/Math.PI)<0&&(a+=360),a}},{key:"_getSubEmptyNeighborPositions",value:function(t){var e=d()(t.neighbors.values()),i=[],r=!0,a=!1,n=void 0;try{for(var s,l=g()(e);!(r=(s=l.next()).done);r=!0){var o=s.value;this._arrayAlreadyHasArray(this.emptyPositions,o)&&i.push(o)}}catch(t){a=!0,n=t}finally{try{!r&&l.return&&l.return()}finally{if(a)throw n}}return i}},{key:"_findIndex",value:function(t,e,i){if(void 0==i&&(i=""),Array.isArray(e)){for(var r=0;r<e.length;r++)if(Array.isArray(e[r])){var a=this._findIndex(t,e[r],i+r+",");if(a)return a}else if(e[r]==t)return i+r}else if(e==t)return i+r;return!1}},{key:"_arrayAlreadyHasArray",value:function(t,e){for(var i=0;i<t.length;i++){for(var r=!1,a=0;a<t[i].length;a++){if(t[i][a]!==e[a]){r=!1;break}r=!0}if(r)return!0}return!1}},{key:"_neighborManhattanDist",value:function(t,e){return t[1]===e[1]?1:2}},{key:"_boundarySubManhattanDist",value:function(t,e){var i=this._copy2dObj(this.boundaryGraph.map);for(var r in i[String(e)])i[r][String(e)]=i[String(e)][r];var a=(i=new C.a(i)).findShortestPath(String(t),String(e)),n=1/0;return null!==a&&(n=this._routeManhattanDist(i,a)),n}},{key:"_routeManhattanDist",value:function(t,e){for(var i=0,r=0;r<e.length-1;r++)i+=t.map[e[r]][e[r+1]];return i}},{key:"_copy2dObj",value:function(t){var e={};for(var i in t)for(var r in e[i]={},t[i])e[i][r]=t[i][r];return e}},{key:"_shortestPathBetweenCapPair",value:function(t,e){for(var i=this.waterGraph[[t,e]],r=this.caps[t],a=this.caps[e],n=void 0,s=99999,l=99999,o=0;o<r.length;o++)for(var h=r[o],u=0;u<a.length;u++){var d=a[u],f=i.findShortestPath(h,d);(l=this._routeManhattanDist(i,f))<s&&(s=l,n=JSON.parse(c()(f)).map(Number))}return{route:n,dist:s}}},{key:"addLandRoute",value:function(t){for(var e=this,i=this,r=0;r<this.landRoute.length;r++)for(var a=0;a<this.harbor.length;a++)Number(this._findIndex(this.harbor[a],Data.subHierClusters)[0])===r&&function(){var i=n(r,e.harbor[a]),s=void 0;s=i===e.harbor[a]?[i,i]:e.landGraph[r].findShortestPath(i,e.harbor[a]).map(Number);var l=[];e.landRoute[r][[i,e.harbor[a]]]=s;for(var o=function(i){var r=e.leafNodes.find(function(t){return t.ID===s[i]}),n=t.x(r.center.coordinates.x),o=t.y(r.center.coordinates.y);l.push({x:n,y:o}),i===s.length-1&&l.push({x:n+(e.harborCoords[a][0]-n)/2,y:o+(e.harborCoords[a][1]-o)/2})},h=0;h<s.length;h++)o(h);e.landRouteCoords[r].push(l)}();function n(t,e){for(var r=i.caps[t],a=s(e),n=99999,o=99999,h=void 0,c=0;c<r.length;c++){var u=r[c];(o=l(s(u),a))<n&&(n=o,h=u)}return h}function s(t){var e=i.leafNodes.find(function(e){return e.ID===t});return[e.position.i,e.position.j]}function l(t,e){for(var i=0,r=0;r<t.length;r++)i+=Math.abs(t[r]-e[r]);return i}}},{key:"splitLandRoute",value:function(){var t=this;this.landSplittedRoute=[],this.landSplittedRouteCoords=[];for(var e=0;e<this.landRoute.length;e++){this.landSplittedRoute[e]=[],this.landSplittedRouteCoords[e]=[];for(var i=o()(this.landRoute[e]),r=0;r<i.length;r++){var a=i[r],n=this.landRouteCoords[e][r];this.landSplittedRoute[e]=this.landSplittedRoute[e].concat(s(a)),this.landSplittedRouteCoords[e]=this.landSplittedRouteCoords[e].concat(l(a,n))}h(this.landSplittedRoute[e],this.landSplittedRouteCoords[e])}function s(t){for(var e=[],i=0;i<t.length-1;i++)e.push([t[i],t[i+1]]);return e}function l(e,i){for(var r=[],a=0;a<e.length-1;a++)t.harbor.indexOf(e[a+1])>-1&&void 0!==i[a+2]?r.push([i[a],i[a+1],i[a+2]]):r.push([i[a],i[a+1]]);return r}function h(t,e){for(var i=[],r=0;r<t.length;r++)for(var a=r+1;a<t.length;)t[r][0]==t[a][0]&&t[r][1]==t[a][1]?(t.splice(a,1),i.push(a)):a++;for(var n=0;n<i.length;n++)e.splice(i[n],1)}}},{key:"shapeIntersect",value:function(t){for(var e=L.b.line(t.flat()),i=0;i<this.shapes.length;i++){if(L.a.intersect(this.shapes[i],e).points.length>0)return!0}return!1}},{key:"combineLandRoute",value:function(){this.landCombinedRoute=[],this.landCombinedRouteCoords=[];for(var t=0;t<this.landSplittedRoute.length;t++){this.landCombinedRoute[t]=[],this.landCombinedRouteCoords[t]=[];for(var e=this.landSplittedRoute[t],i=this.landSplittedRouteCoords[t],r=JSON.parse(c()(e[0])),a=JSON.parse(c()(i[0])),n=0;n<e.length-1;n++){var s=i[n+1];if(e[n][1]===e[n+1][0]){r.push(e[n+1][1]);for(var l=1;l<s.length;l++)a.push(s[l])}else if(e[n][0]===e[n+1][1]){r.unshift(e[n+1][0]);for(var o=s.length-2;o>-1;o--)a.unshift(s[o])}else this.landCombinedRoute[t].push(r),this.landCombinedRouteCoords[t].push(a),r=JSON.parse(c()(e[n+1])),a=JSON.parse(c()(s))}if(this.landCombinedRoute[t].push(r),this.landCombinedRouteCoords[t].push(a),this.landCombinedRoute[t].length>1)for(var h=0;h<this.landCombinedRoute[t].length;h++)for(var u=h+1;u<this.landCombinedRoute[t].length;){var d=this.landCombinedRoute[t][h].length,f=this.landCombinedRoute[t][u].length;this.landCombinedRoute[t][h][0]===this.landCombinedRoute[t][u][0]?(p(this.landCombinedRoute[t],h,u,!0,"front"),p(this.landCombinedRouteCoords[t],h,u,!0,"front")):this.landCombinedRoute[t][h][0]===this.landCombinedRoute[t][u][f-1]?(p(this.landCombinedRoute[t],h,u,!1,"front"),p(this.landCombinedRouteCoords[t],h,u,!1,"front")):this.landCombinedRoute[t][h][d-1]===this.landCombinedRoute[t][u][0]?(p(this.landCombinedRoute[t],h,u,!1,"end"),p(this.landCombinedRouteCoords[t],h,u,!1,"end")):this.landCombinedRoute[t][h][d-1]===this.landCombinedRoute[t][u][f-1]?(p(this.landCombinedRoute[t],h,u,!0,"end"),p(this.landCombinedRouteCoords[t],h,u,!0,"end")):u++}}function p(t,e,i,r,a){var n=t.splice(i,1)[0];r&&n.reverse(),"front"===a?(t[e].splice(0,1),t[e]=n.concat(t[e])):"end"===a&&(t[e].splice(t[e].length-1,1),t[e]=t[e].concat(n))}}},{key:"getLandSubCoords",value:function(){this.landSubCoords=new m.a;for(var t=0;t<this.landSplittedRoute.length;t++)for(var e=this.landSplittedRoute[t],i=this.landSplittedRouteCoords[t],r=0;r<e.length;r++){var a=e[r],n=i[r];this.landSubCoords.set(a[0],n[0]),this.harbor.indexOf(a[1])>-1?this.landSubCoords.set(a[1],[n[1],n[2]]):this.landSubCoords.set(a[1],n[1])}}},{key:"draw",value:function(t){this.drawLandRoute(t),this.drawSeaRoute(t)}},{key:"drawLandRoute",value:function(t){var e=this,i=d3.line().x(function(t){return t.x}).y(function(t){return t.y});t.selectAll(".mapLandRoute").data(this.landCombinedRoute).enter().append("g").attr("class","mapLandRoute").attr("id",function(t,e){return"mapLandRoute"+e}).each(function(t,r){d3.select(this).selectAll(".landRoute").data(e.landCombinedRouteCoords[r]).enter().append("path").attr("class","landRoute").attr("id",function(t,e){return"landRoute"+r+"_"+e}).attr("d",i)})}},{key:"drawHarbor",value:function(t){var e=this;t.append("g").attr("class","mapHarbor").selectAll(".harbor").data(this.harborCoords).enter().append("g").attr("class","harbor").attr("transform",function(t){return"translate("+t+")scale("+e.harborIconScale+")"}).style("opacity",0).append("path").attr("d",this.harborIcon);var i=t.select(".harbor").node().getBoundingClientRect();t.select(".mapHarbor").selectAll(".harbor").attr("transform",function(){return function(t,i){var r=e.getTranslate(t),a=getTransformation(d3.select("#mapSvg").attr("transform"));return"translate("+[r[0]-i.width/2/a.scaleX,r[1]-i.height/2/a.scaleY]+")scale("+e.harborIconScale+")"}(d3.select(this),i)}).style("opacity",1)}},{key:"drawSeaRoute",value:function(t){var e=this,i=d3.line().x(function(t){return t[0]}).y(function(t){return t[1]}).curve(d3.curveCatmullRom.alpha(1));t.append("g").attr("class","mapSeaRoute").selectAll(".seaRoute").data(this.seaRouteCoords).enter().append("path").attr("class","seaRoute").attr("od",function(t,i){return e.seaRouteOD[i]}).attr("id",function(t,e){return"seaRoute"+e}).attr("d",i)}},{key:"drawHighlightLandRoute",value:function(t,e){var i=d3.line().x(function(t){return t.x}).y(function(t){return t.y});t.selectAll(".hightlightLandRoute").data(e).enter().append("path").attr("class","hightlightLandRoute").attr("d",i).style("visibility","hidden")}},{key:"showHighlightLandRoute",value:function(t){t.selectAll(".hightlightLandRoute").style("visibility","visible")}},{key:"getTranslate",value:function(t){var e=t.attr("transform"),i=e.indexOf("("),r=e.indexOf(","),a=e.indexOf(")");return[parseFloat(e.substring(i+1,r)),parseFloat(e.substring(r+1,a))]}}]),t}();function F(t,e){return[t.x(e[0]),t.y(e[1])]}e.a=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return new(Function.prototype.bind.apply(N,[null].concat(e)))}},l8Mu:function(t,e,i){"use strict";var r=i("3q+s"),a={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"subList"}},[e("div",{attrs:{id:"list"}}),this._v(" "),e("div",{attrs:{id:"hist"}})])}]};var n=function(t){i("tfsm")},s=i("VU/8")(r.a,a,!1,n,null,null);e.a=s.exports},tfsm:function(t,e){},tvR6:function(t,e){},umFo:function(t,e,i){"use strict";var r=i("NnIC"),a=i.n(r),n=i("mvHQ"),s=i.n(n),l=i("Gu7T"),o=i.n(l),h=i("ifoU"),c=i.n(h),u=i("lHA8"),d=i.n(u),f=i("Zrlr"),p=i.n(f),v=i("wxAW"),g=i.n(v),y=i("by4E"),m=function(){function t(e,i,r,a,n,s,l,o){var h=this;p()(this,t),this.zoomScale=1;var c=[1,Math.sqrt(n)+1],u=Math.log(Math.pow(c[1],4))/Math.log(2),d=d3.zoom().scaleExtent(c).on("zoom",function(t){var e=[d3.event.transform.x,d3.event.transform.y],i=d3.event.transform.k;h.zoomScale=i,d3.select(".SubMapTiling").attr("transform",d3.event.transform),h.update(e,i)});this.roundView=!1,this.center=i,this.diameter=r,this.glyphSize=a,this.clsLevel=n,this.colors=s,this.parent=e,this.zoom={extent:c,maxLevel:u,zoomer:d},this.duration=l,this.container=null,this.ctr=u/n,this.div=.5*this.ctr,this.clsToScale=function(t){return Math.pow(Math.pow(2,t*h.ctr),.25)},this.updateChangeLevelByMap=o}return g()(t,[{key:"changeVisible",value:function(t,e){var i=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t.interrupt().transition().duration(this.duration).attr("opacity",function(t,i){var a=e(this);return a?(d3.select(this).classed("visible",!0),r?a:1):(d3.select(this).classed("visible",!1),0)}).on("end",function(){i.parent.d3el.selectAll(".mapLandRoute").raise(),i.parent.d3el.selectAll(".mapCaps").raise(),0!==document.getElementsByClassName("travelIcon").length&&i.parent.d3el.selectAll(".travelIcon").raise()})}},{key:"pointVisible",value:function(t){if(this.roundView){var e=this.parent.snapshotPar.ringRRatio;return t[0]=t[0]*this.scale-this.center[0]+this.translate[0],t[1]=t[1]*this.scale-this.center[1]+this.translate[1],Math.sqrt(t[0]*t[0]+t[1]*t[1])+this.glyphSize*this.scale<=this.diameter*e-7.2}return!0}},{key:"SubClsVisible",value:function(t,e){var i=this,r=this.parent.d3el.selectAll(".SubMapClusters"),a=this;this.changeVisible(r,function(r){var a=void 0;if(d3.select(r).classed("Outliers")){var n=(i.clsLevel-1)*i.ctr;a=e<n+i.div}else{var s=d3.select(r).attr("clsID").split("_"),l=(s.length-1)*i.ctr;a=e>=l-i.div&&e<l+i.div,t[s.length-1].atLevel=a}return a}),this.parent.d3el.selectAll(".visible .SubClsPath").each(function(t){var e=d3.select(this).attr("pos").split("_"),i=a.pointVisible(e[0].split(","))&&a.pointVisible(e[1].split(","));d3.select(this).attr("display",i?"block":"none")})}},{key:"MapRouteVisible",value:function(t){var e=this,i=this.parent.d3el.selectAll(".mapLandRoute");this.changeVisible(i,function(i){var r=e.clsLevel*e.ctr;if(t>=r-e.div&&t<r+e.div)return!((e.div-Math.abs(t-r))/e.div*1);return!0})}},{key:"MapCapVisible",value:function(t){var e=this,i=this.parent.d3el.selectAll(".mapCaps");this.changeVisible(i,function(i){var r=e.clsLevel*e.ctr;if(t>=r-e.div&&t<r+e.div)return!((e.div-Math.abs(t-r))/e.div*1);return!0})}},{key:"SubGlyphVisible",value:function(t){var e=this,i=this.parent.d3el.selectAll(".dimFan");this.changeVisible(i,function(i){var r=e.clsLevel*e.ctr;if(t>=r-e.div&&t<r+e.div){var a=e.parent.pattern?parseFloat(d3.select(i).attr("ptOpacity")):1;return(e.div-Math.abs(t-r))/e.div*a}return!1},!0)}},{key:"SubGridVisible",value:function(t,e){var i=this,r=new d.a,a=this;this.parent.d3el.selectAll(".SubMapGrids").classed("visible",!1).classed("invisible",!0).interrupt().transition().duration(this.duration).attr("opacity",0);var n=function(t){var e=t,i={scale:1,translate:[0,0],scaleFirst:!0};if(null!=e&&""!=e){var r=e.indexOf("scale"),a=e.indexOf("translate"),n=void 0,s=void 0,l=void 0,o=void 0,h=void 0;l=i.scaleFirst=r>=0&&r>a,r<0?(o=0,h=a<0?0:e.length):a<0?(h=0,o=e.length):l?(h=r,o=e.length-h):(o=h,h=e.length-o),o>0&&(s=e.slice(r,r+o).replace("scale","").replace("(","").replace(")",""),i.scale=parseFloat(s)),h>0&&(n=e.slice(a,r+h).replace("translate","").replace("(","").replace(")","").split(","),i.translate[0]=parseFloat(n[0]),i.translate[1]=parseFloat(n[1]))}return i}(this.parent.d3el.select(".SubMapTiling").attr("transform")),s=this.parent.colors;this.parent.d3el.selectAll(".SubMapGrids").filter(function(i){var l,o,h=d3.select(this).attr("position").split("_");if(a.pointVisible(h)&&null!=i.id){r.add(i.id);var c=(l=e,o=i.pos,[l.x(o[0]),l.y(o[1])]),u=n.scale,d=n.translate;n.scaleFirst?(c[0]=c[0]*u+d[0],c[1]=c[1]*u+d[1]):(c[0]=(c[0]+d[0])*u,c[1]=(c[1]+d[1])*u),t.update(i.id,s[i.id],c)}return t}).attr("display","block").classed("visible",!0).classed("invisible",!1).interrupt().transition().duration(this.duration).attr("opacity",function(){var t=parseFloat(d3.select(this).attr("zgOpacity")),e=parseFloat(d3.select(this).attr("ftOpacity")),i=parseFloat(d3.select(this).attr("ptOpacity"));return(t=isNaN(t)?1:t)*(e=isNaN(e)?1:e)*(i=isNaN(i)?1:i)}),setTimeout(function(){i.parent.d3el.selectAll(".SubMapGrids.invisible").attr("display","none")})}},{key:"initializeVisible",value:function(){var t=this.parent.currClusters.visible,e=this.parent.currClusters.paths,i=this.parent;if(null==t){(t=this.parent.currClusters.visible=[]).dictionary=new c.a;for(var r=this.parent.currClusters.paths,a=0;a<r.length;a++){var n=r[a],s=[];s.atLevel=!1;for(var l=0;l<n.length;l++){if(!n[l].outlier)for(var h=n[l].ids,u=0;u<h.length;u++)s.push({index:[l,u],clsID:[].concat(o()(n[l].previous),[u]).join("_"),visible:!1,positions:[],colors:[],avgPos:null,avgCol:b(S(this.colors,h[u],[0,1,2]),!1),SShotAngle:0})}t.push(s)}t.update=function(t,i,r){for(var a=function(e){return e===t},n=0;n<this.length;n++)if(this[n].atLevel)for(var s=this[n],l=this.dictionary,o=0;o<s.length;o++){var h=s[o],c=h.index;if(e[n][c[0]].ids[c[1]].findIndex(a)>=0){h.visible=!0,h.positions.push(r),h.colors.push(i),l.set(t,[n,o]);break}}},t.updateColors=function(t){i.d3el.selectAll(".SubMapSShot").filter(function(){var e,i=d3.select(this).attr("index"),r=!1;if(t.has(i)){r=!0;var a=b(t.get(i),!1);a="rgb("+[~~(255*(e=a)[0]),~~(255*e[1]),~~(255*e[2])]+")"}return r})}}else{t.dictionary=new c.a;for(var d=0;d<t.length;d++){var f=t[d];t[d].atLevel=!1;for(var p=0;p<f.length;p++){var v=f[p];v.visible=!1,v.avgPos=null,v.avgCol=null,v.sshotAngle=0}}}return t}},{key:"SubSnapshotVisible",value:function(t){for(var e=this.center,i=180/this.parent.snapshotPar.angInterval,r=0;r<t.length;r++)for(var a=t[r],n=0;n<a.length;n++){var s=a[n];if(s.positions.length>0){var l=w(e,s.avgPos=b(s.positions,!1));l=Math.round(l/Math.PI*i)*Math.PI/i,s.positions=[],s.SShotAngle=l}s.colors.length>0&&(s.avgCol=b(s.colors,!1),s.colors=[])}}},{key:"update",value:function(t,e,i){var r=this,a=Math.log(Math.pow(e,4))/Math.log(2),n=this.initializeVisible();this.scale=e,this.translate=t,this.MapCapVisible(a),this.MapRouteVisible(a),this.SubClsVisible(n,a);for(var l=void 0,h=0;h<n.length;h++)!0===n[h].atLevel&&(l=h);this.updateChangeLevelByMap({level:l}),1===l?d3.selectAll(".SubMapGrids").filter(function(){for(var t=[],e=0;e<Data.subtree.children.length;e++)t.push.apply(t,o()(JSON.parse(s()(Data.subtree.children[e].leaves))));return-1!==t.indexOf(Number(d3.select(this).attr("index")))}).each(function(){d3.select(this).select(".cell").transition().duration(r.duration).style("stroke","#ccc").style("stroke-width","0.025rem").style("stroke-linecap","round")}):d3.selectAll(".SubMapGrids").filter(function(){for(var t=[],e=0;e<Data.subtree.children.length;e++)t.push.apply(t,o()(JSON.parse(s()(Data.subtree.children[e].leaves))));return-1!==t.indexOf(Number(d3.select(this).attr("index")))}).each(function(){d3.select(this).select(".cell").transition().duration(r.duration).style("stroke","#ccc").style("stroke-width","0px").style("stroke-linecap","round")}),this.SubGlyphVisible(a),this.SubGridVisible(n,this.parent.scales),this.SubSnapshotVisible(n),this.parent.updateClusterInfo(!1)}},{key:"toLevel",value:function(t,e,i,r){var a=this,n=this.clsToScale(i),s=[-e[0],-e[1]],l=this.zoom.zoomer,o=d3.zoomIdentity.translate(s[0],s[1]).scale(n);d3.select(t).transition().duration(this.duration).call(l.transform,o);var h=this.zoomScale;n>h?this.update(s,n,this.duration):setTimeout(function(){a.update(s,n,a.duration)},this.duration)}},{key:"prepareContainer",value:function(t){return(this.container=t.append("g").append("g").attr("class","SubMapTiling")).call(this.zoom.zoomer).on("dblclick.zoom",null)}}]),t}();function b(t,e){for(var i=e?t:y.transpose(t),r=y.dim(i),a=new Array(r[0]),n=r[1],s=0;s<i.length;s++)a[s]=y.sum(i[s])/n;return a}function S(t,e,i){for(var r=new Array(e.length),a=0;a<r.length;a++)r[a]=new Array(i.length);for(var n=0;n<e.length;n++)for(var s=e[n],l=0;l<i.length;l++){var o=i[l];r[n][l]=t[s][o]}return r}function w(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=Math.PI,s=100*a.a,l=void 0;return Math.abs(i)<s?Math.abs(r)>s&&(l=(r>0?1:-1)*n*.5):(l=Math.atan(r/i),i<0&&(l+=n)),l}e.a=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return new(Function.prototype.bind.apply(m,[null].concat(e)))}},"wCY+":function(t,e,i){"use strict";var r=i("Gu7T"),a=i.n(r),n=i("d7EF"),s=i.n(n),l=i("BO1k"),o=i.n(l),h=i("lHA8"),c=i.n(h),u=i("ifoU"),d=i.n(u),f=i("Zrlr"),p=i.n(f),v=i("wxAW"),g=i.n(v),y=i("NnIC"),m=i.n(y),b={},S=function(t){return function(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];return new(Function.prototype.bind.apply(t,[null].concat(i)))}},w=function(){function t(e,i){p()(this,t),this.type="point",this.ID=e,this.tolerance=100*m.a,this.coordinates=this.getCoordinates(i)}return g()(t,[{key:"getCoordinates",value:function(t){var e=t[0],i=t[1];return Math.abs(e)<this.tolerance&&(e=0),Math.abs(i)<this.tolerance&&(i=0),{x:e,y:i}}}]),t}();b.Point=S(w);var D=function(){function t(e,i,r,a){p()(this,t),this.type="edge",this.ID=e,this.start=b.Point(0,i),this.end=b.Point(1,r),this.length=this.getLength(),this.tolerance=100*m.a,this.nghPositions=this.getNeighbors(a)}return g()(t,[{key:"getLength",value:function(){var t=this.start,e=this.end;return Math.sqrt(Math.pow(e.coordinates.x-t.coordinates.x,2)+Math.pow(e.coordinates.y-t.coordinates.y,2))}},{key:"sameTo",value:function(t){return null!=this.nghPositions&&null!=t.nghPositions?this.nghPositions===t.nghPositions:this.compareWith(t)}},{key:"compareWith",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Math.sqrt(Math.pow(this.start.coordinates.x-t.start.coordinates.x,2)+Math.pow(this.start.coordinates.y-t.start.coordinates.y,2)),a=Math.sqrt(Math.pow(this.end.coordinates.x-t.end.coordinates.x,2)+Math.pow(this.end.coordinates.y-t.end.coordinates.y,2)),n=Math.sqrt(Math.pow(this.start.coordinates.x-t.end.coordinates.x,2)+Math.pow(this.start.coordinates.y-t.end.coordinates.y,2)),s=Math.sqrt(Math.pow(this.end.coordinates.x-t.start.coordinates.x,2)+Math.pow(this.end.coordinates.y-t.start.coordinates.y,2));return null==e?i?r<this.tolerance&&a<this.tolerance:r<this.tolerance&&a<this.tolerance||n<this.tolerance&&s<this.tolerance:e.call(this,[r,a],[n,s])}},{key:"connectTo",value:function(t){return this.compareWith(t,function(e,i){var r=s()(e,2),a=r[0],n=r[1],l=s()(i,2),o=l[0],h=l[1];return a<this.tolerance&&n<this.tolerance?[this.start,this.end]:o<this.tolerance&&h<this.tolerance?[this.start,this.end]:a<this.tolerance?[this.end,this.start,t.end]:h<this.tolerance?[this.start,this.end,t.end]:n<this.tolerance?[this.start,this.end,t.start]:o<this.tolerance&&[this.end,this.start,t.start]})}},{key:"getNeighbors",value:function(t){if(null==t)return null;var e="";return t[0][0]<t[1][0]&&(e=[t[0].join(","),t[1].join(",")].join("_")),t[0][0]>t[1][0]&&(e=[t[1].join(","),t[0].join(",")].join("_")),t[0][0]===t[1][0]&&(e=t[0][1]<t[1][1]?[t[0].join(","),t[1].join(",")].join("_"):[t[1].join(","),t[0].join(",")].join("_")),e}}]),t}();b.Edge=S(D);b.Path=S(function t(e,i,r){p()(this,t),this.type="path",this.ID=e,this.points=i,this.closed=r}),b.Methods={getPathsByEdges:function(t){for(var e=[],i=0;i<t.length;i++)e.push(i);var r=t[e[0]];e.splice(0,1);var n=[];n.push([]);for(var s=!0,l=0;e.length>0;){for(var o=!1,h=0;h<e.length;h++){var c=r.connectTo(t[e[h]]);if(!1!==c&&null!=c){var u;if(o=!0,s)s=!1,(u=n[l]).push.apply(u,a()(c));else null==c[2]&&console.log(r,t[e[h]]),n[l].push(c[2]);r=t[e[h]],e.splice(h,1);break}}o||(r=t[e[0]],e.splice(0,1),n.push([]),s=!0,l++)}for(var d=[],f=0;f<n.length;f++)if(0!==n[f].length){var p=b.Path("Path_"+d.length,n[f],!0);d.push(p)}return d}};var x=b,P=function(){function t(e,i,r){p()(this,t),this.update(e,i,r)}return g()(t,[{key:"update",value:function(t,e,i){null!=t&&(this.ID=t),null!=e&&(this.radius=e),null!=i&&(this.position={i:Math.round(i[0]),j:Math.round(i[1])}),(e||i)&&(this.center=x.Point("center",this.getCenterCoordinates()),this.neighbors=this.getNeighborsInPosition(),this.edges=this.getEdges())}},{key:"getCenterCoordinates",value:function(){var t=this.position;return this.getCoordinatesByPosition(this.radius,[t.i,t.j])}},{key:"getCoordinatesByPosition",value:function(t,e){var i=[parseInt(e[0]),parseInt(e[1])];return[i[1]%2==0?2*t*i[0]:(2-1/Math.abs(i[0]))*t*i[0],Math.sqrt(3)*t*i[1]]}},{key:"getNeighborsInPosition",value:function(){var t=new d.a,e=this.position,i=void 0,r=void 0,a=void 0,n=void 0;return e.j%2==0?(i=1,r=e.i>=0?1:0,a=e.i<=0?-1:0,n=-1):(i=-1===e.i?2:1,r=e.i<0?1:0,a=e.i>0?-1:0,n=1===e.i?-2:-1),t.set(0,[e.i+i,e.j]),t.set(60,[e.i+r,e.j+1]),t.set(120,[e.i+a,e.j+1]),t.set(180,[e.i+n,e.j]),t.set(240,[e.i+a,e.j-1]),t.set(300,[e.i+r,e.j-1]),t}},{key:"getEdges",value:function(){for(var t=new d.a,e=2*this.radius*Math.sqrt(3)/3,i=0;i<6;i++){var r=30+60*i,a=r/180*Math.PI,n=[this.center.coordinates.x+e*Math.cos(a),this.center.coordinates.y+e*Math.sin(a)];t.set(r,n)}for(var s=new d.a,l=x.Edge,o=0;o<6;o++){var h=60*o,c=h-30,u=h+30;c<0&&(c+=360);var f=this.neighbors.get(h),p=[this.position.i,this.position.j],v=l(h,t.get(c),t.get(u),[p,f]);s.set(h,v)}return s}},{key:"getPositionByCoordinates",value:function(t,e){var i=Math.round(e[1]*Math.sqrt(3)/(3*t)),r=e[0]/(2*t);return[r=i%2==0?Math.round(r):r>0?Math.round(r+.5):Math.round(r-.5),i]}},{key:"tryToMove",value:function(t,e){var i=t[1]+e[1],r=t[0]+e[0];return e[1]%2!=0&&t[1]%2!=0&&(r-=1),[r,i]}},{key:"getPositionRange",value:function(t){if(1===t.length)return[t[0]];var e={i:{min:1/0,max:-1/0},j:{min:1/0,max:-1/0}},i=!0,r=!1,a=void 0;try{for(var n,s=o()(t);!(i=(n=s.next()).done);i=!0){var l=n.value;e.i.max=Math.max(l[0],e.i.max),e.i.min=Math.min(l[0],e.i.min),e.j.max=Math.max(l[1],e.j.max),e.j.min=Math.min(l[1],e.j.min)}}catch(t){r=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw a}}return[[e.i.min,e.j.min],[e.i.max,e.j.max]]}},{key:"changePosition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=[parseInt(t[0]),parseInt(t[1])],r=[i[0],i[1]];return e?i[1]%2!=0&&i[0]<=0&&(r[0]=r[0]-1):i[1]%2!=0&&i[0]<=0&&(r[0]=r[0]+1),r}},{key:"move",value:function(t){var e=this.changePosition([this.position.i,this.position.j]),i=e[1]+t[1],r=e[0]+t[0];t[1]%2!=0&&e[1]%2!=0&&(r-=1);var a=this.changePosition([r,i],!0);this.update(null,null,a)}}]),t}(),C=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return new(Function.prototype.bind.apply(P,[null].concat(e)))},M=i("c/Tr"),A=i.n(M),I=i("mvHQ"),R=i.n(I),k=function(){function t(e,i,r,a,n,s){p()(this,t),this.ID=e,this.subTree=i,this.path2This=i.index,this.level=a,this.isTopChild=1===this.level,this.center=r,this.cellRadius=n,this.polygonCreator=s,this.numberODCD=i.dict.length,this.glbTraversalOrder=i.data.glbTraversalOrder,this.allLeaves=new d.a,this.altitude,this.contour,this.occupied=new d.a,this.neighbors=new c.a,this.cls=Data.subHierClusters[this.path2This[0]],this.subClsNum=function(t){for(var e=0,i=0;i<t.length;i++)Array.isArray(t[i])&&e++;return e}(this.cls),this.alternativeMap=new d.a,this.layout1=!0,this.initialize()}return g()(t,[{key:"initialize",value:function(){this.isTopChild&&(this.centerLeafName=this.subTree.data.centerLeafName[0],this.center.ID=this.centerLeafName,this.layoutLeaf(this.centerLeafName,this.center))}},{key:"layoutLeaf",value:function(t,e){this.allLeaves.set(t,e),this.updateRecords(t,e)}},{key:"updateRecords",value:function(t,e){var i=e.position.i+"_"+e.position.j;this.occupied.set(i,t),this.alternativeMap.delete(i),this.neighbors.delete(i);var r=!0,a=!1,n=void 0;try{for(var s,l=o()(e.neighbors);!(r=(s=l.next()).done);r=!0){var h=s.value[1],c=h[0]+"_"+h[1];this.occupied.has(c)||this.neighbors.add(c)}}catch(t){a=!0,n=t}finally{try{!r&&l.return&&l.return()}finally{if(a)throw n}}}},{key:"layoutAll",value:function(t,e,i){for(var r=this,a=[],n=!1,s=0;s<this.numberODCD;s++){var l=this.glbTraversalOrder[s];if(l!==this.centerLeafName){var o=null;s<this.numberODCD-1&&(o=this.glbTraversalOrder[s+1])===this.centerLeafName&&(o=s<this.numberODCD-2?this.glbTraversalOrder[s+2]:null);var h=new c.a,u=void 0;this.getAltPositions(l,o,e,i,h),this.layout1?u=this.getLeafPosition1(h):(u=this.getLeafPosition2(a,n,h),a.push(JSON.parse(R()(u))),(n=f(l,o))||(a=[])),(isNaN(u[0])||isNaN(u[1]))&&console.error("top tree: "+this.ID+" - leaf: "+l);var d=this.polygonCreator(l,this.cellRadius,u);this.layoutLeaf(l,d)}}function f(t,e){var i=p(t,r.cls),a=p(e,r.cls);return"string"==typeof i&&"string"==typeof a&&i.substr(0,1)===a.substr(0,1)}function p(t,e,i){if(void 0==i&&(i=""),Array.isArray(e)){for(var r=0;r<e.length;r++)if(Array.isArray(e[r])){var a=p(t,e[r],i+r+",");if(a)return a}else if(e[r]==t)return i+r}else if(e==t)return i+r;return!1}}},{key:"getAltPositions",value:function(t,e,i,r,a){var n=!0,s=!1,l=void 0;try{for(var h,c=o()(this.neighbors);!(n=(h=c.next()).done);n=!0){var u=h.value;i.has(u)||r.has(u)||(a.add(u),this.alternativeMap.set(u,t))}}catch(t){s=!0,l=t}finally{try{!n&&c.return&&c.return()}finally{if(s)throw l}}var d=v(t,this.cls),f=v(e,this.cls),p=!1;function v(t,e,i){if(void 0==i&&(i=""),Array.isArray(e)){for(var r=0;r<e.length;r++)if(Array.isArray(e[r])){var a=v(t,e[r],i+r+",");if(a)return a}else if(e[r]==t)return i+r}else if(e==t)return i+r;return!1}"string"==typeof d&&"string"==typeof f&&(d=d.substr(0,1),f=f.substr(0,1),p=!(Number(d)<this.subClsNum&&Number(f)<this.subClsNum)||d===f),p||this.neighbors.clear()}},{key:"getLeafPosition1",value:function(t){var e=t.values().next().value.split("_");return[parseInt(e[0]),parseInt(e[1])]}},{key:"getLeafPosition2",value:function(t,e,i){var r=void 0,a=!1;if(e){for(var n=0;n<t.length;n++){for(var s={i:t[n][0],j:t[n][1]},l=A()(c(s).values()),o=0;o<l.length;o++){var h=l[o][0]+"_"+l[o][1];if(i.has(h)){r=h.split("_"),a=!0;break}}if(a)break}void 0===r&&(r=i.values().next().value.split("_"))}else r=i.values().next().value.split("_");function c(t){var e=new d.a,i=t,r=void 0,a=void 0,n=void 0,s=void 0;return i.j%2==0?(r=1,a=i.i>=0?1:0,n=i.i<=0?-1:0,s=-1):(r=-1===i.i?2:1,a=i.i<0?1:0,n=i.i>0?-1:0,s=1===i.i?-2:-1),e.set(0,[i.i+r,i.j]),e.set(60,[i.i+a,i.j+1]),e.set(120,[i.i+n,i.j+1]),e.set(180,[i.i+s,i.j]),e.set(240,[i.i+n,i.j-1]),e.set(300,[i.i+a,i.j-1]),e}return[parseInt(r[0]),parseInt(r[1])]}},{key:"getAltWeights",value:function(t,e,i,r){var a=function(t){return 1/(t*t)},n=!0,s=!1,l=void 0;try{for(var h,c=o()(this.occupied);!(n=(h=c.next()).done);n=!0){var u=h.value,d=t[i][u[1]];r.set(u[0],a(d))}}catch(t){s=!0,l=t}finally{try{!n&&c.return&&c.return()}finally{if(s)throw l}}var f=!0,p=!1,v=void 0;try{for(var g,y=o()(e);!(f=(g=y.next()).done);f=!0){var m=g.value;d=t[i][m[1]];r.set(m[0],a(d))}}catch(t){p=!0,v=t}finally{try{!f&&y.return&&y.return()}finally{if(p)throw v}}}},{key:"move",value:function(t){this.occupied.clear(),this.neighbors.clear();var e=!0,i=!1,r=void 0;try{for(var a,n=o()(this.allLeaves);!(e=(a=n.next()).done);e=!0){var s=a.value;s[1].move(t),this.updateRecords(s[0],s[1])}}catch(t){i=!0,r=t}finally{try{!e&&n.return&&n.return()}finally{if(i)throw r}}return this.occupied}}]),t}(),T=function(){function t(e,i,r,a){p()(this,t),this.subTree=e,this.path2This=e.index,this.distMatrix=i,this.cellRadius=1,this.centerLeafName=null,this.codes=r,this.polygonCreator=C,this.polygon=this.polygonCreator("core",this.cellRadius,[0,0]),this.numberOChildren=e.children.length,this.numberOLeaves=e.leaves.length,this.numberODCD=e.dict.length,this.numberOAnchors=e.data.initProjection.length,this.gridScaling=a,this.allLeaves=new d.a,this.occupied=new d.a,this.descendants=new d.a,this.dcdTraversalOrder=this.subTree.data.dscTraversalOrder}return g()(t,[{key:"getMap",value:function(){this.layoutAnchors(),this.layoutAll(),this.summarize(),this.seamCarving()}},{key:"layoutAnchors",value:function(){for(var t=this.subTree.data.initProjection,e=Math.round(Math.sqrt(this.numberODCD*this.gridScaling)),i={min:-e,max:e},r={min:-e,max:e},a={x:{min:1/0,max:-1/0},y:{min:1/0,max:-1/0}},n=0;n<this.numberOAnchors;n++){var s=t[n];s[0]<a.x.min&&(a.x.min=s[0]),s[0]>a.x.max&&(a.x.max=s[0]),s[1]<a.y.min&&(a.y.min=s[1]),s[1]>a.y.max&&(a.y.max=s[1])}for(var l=this.dcdTraversalOrder[0],h=new c.a,u=0;u<this.numberOAnchors;u++){var f=t[u],p=[];p[0]=(f[0]-a.x.min)/(a.x.max-a.x.min)*(i.max-i.min)+i.min,p[1]=(f[1]-a.y.min)/(a.y.max-a.y.min)*(r.max-r.min)+r.min,p[0]=2*p[0]*this.cellRadius,p[1]=2*p[1]*this.cellRadius;var v=this.polygon.getPositionByCoordinates(this.cellRadius,p),g=v.join("_");if(h.has(g)){for(var y=this.polygonCreator("try",this.cellRadius,v),m=new d.a([[g,y]]),b=!1;!b;){var S=new d.a,w=!0,D=!1,x=void 0;try{for(var P,C=o()(m);!(w=(P=C.next()).done);w=!0){var M=P.value,A=!0,I=!1,R=void 0;try{for(var T,j=o()(M[1].neighbors);!(A=(T=j.next()).done);A=!0){var _=T.value,L=_[1].join("_");if(!h.has(L)){v=_[1],g=L,b=!0;break}if(!S.has(L)){var O=this.polygonCreator("try",this.cellRadius,_[1]);S.set(L,O)}}}catch(t){I=!0,R=t}finally{try{!A&&j.return&&j.return()}finally{if(I)throw R}}if(b)break}}catch(t){D=!0,x=t}finally{try{!w&&C.return&&C.return()}finally{if(D)throw x}}b||(m=S)}h.add(g),y=this.polygonCreator("try",this.cellRadius,v);var N=!0,F=!1,B=void 0;try{for(var E,G=o()(y.neighbors);!(N=(E=G.next()).done);N=!0){var H=E.value[1].join("_");h.add(H)}}catch(t){F=!0,B=t}finally{try{!N&&G.return&&G.return()}finally{if(F)throw B}}}else{h.add(g);var U=this.polygonCreator("try",this.cellRadius,v),W=!0,z=!1,Y=void 0;try{for(var V,X=o()(U.neighbors);!(W=(V=X.next()).done);W=!0){var q=V.value[1].join("_");h.add(q)}}catch(t){z=!0,Y=t}finally{try{!W&&X.return&&X.return()}finally{if(z)throw Y}}}var J=void 0,K=void 0;if(u<this.numberOChildren){var Q=u;J="child_"+Q,K=this.polygonCreator(Q,this.cellRadius,v);var Z=new k(Q,this.subTree.children[Q],K,1,this.cellRadius,this.polygonCreator);this.descendants.set(J,Z),0===l[1]&&l[0]===Q&&(this.centerLeafName=Z.centerLeafName)}else{var $=u-this.numberOChildren,tt=this.subTree.leaves[$];J="leaf_"+tt,K=this.polygonCreator(tt,this.cellRadius,v),this.descendants.set(J,K),this.allLeaves.set(tt,K),this.occupied.set(K.position.i+"_"+K.position.j,tt),-1===l[1]&&l[0]===tt&&(this.centerLeafName=tt)}}}},{key:"layoutAll",value:function(){for(var t=0;t<this.dcdTraversalOrder.length;t++){var e=this.dcdTraversalOrder[t];if(-1!==e[1]){var i=e[0],r=this.descendants.get("child_"+i),n=this.prepare4Layout(i),l=s()(n,2),o=l[0],h=l[1];r.layoutAll(this.distMatrix,o,h),this.allLeaves=new d.a([].concat(a()(this.allLeaves),a()(r.allLeaves))),this.occupied=new d.a([].concat(a()(this.occupied),a()(r.occupied)))}}}},{key:"prepare4Layout",value:function(t){for(var e=new d.a,i=new c.a,r=0;r<this.dcdTraversalOrder.length;r++){var n=this.dcdTraversalOrder[r];if(-1===n[1]){var s=this.descendants.get("leaf_"+n[0]);e.set(s.position.i+"_"+s.position.j,n[0]);var l=s.neighbors,h=!0,u=!1,f=void 0;try{for(var p,v=o()(l);!(h=(p=v.next()).done);h=!0){var g=p.value;i.add(g[1].join("_"))}}catch(t){u=!0,f=t}finally{try{!h&&v.return&&v.return()}finally{if(u)throw f}}}else if(n[0]!==t){var y=this.descendants.get("child_"+n[0]);e=new d.a([].concat(a()(e),a()(y.occupied)));var m=y.neighbors;i=new c.a([].concat(a()(i),a()(m)))}}return[e,i]}},{key:"summarize",value:function(){var t=2*Math.sqrt(3)/3,e={x:{min:1/0,max:-1/0},y:{min:1/0,max:-1/0}},i=!0,r=!1,a=void 0;try{for(var n,s=o()(this.allLeaves);!(i=(n=s.next()).done);i=!0){var l=n.value[1].center.coordinates;e.x.max=Math.max(l.x,e.x.max),e.x.min=Math.min(l.x,e.x.min),e.y.max=Math.max(l.y,e.y.max),e.y.min=Math.min(l.y,e.y.min)}}catch(t){r=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw a}}e.x.max=e.x.max+3*this.cellRadius*1,e.x.min=e.x.min-3*this.cellRadius*1,e.y.max=e.y.max+3*this.cellRadius*t,e.y.min=e.y.min-3*this.cellRadius*t,e.aspectRatio=(e.y.max-e.y.min)/(e.x.max-e.x.min),this.coordsRange=e;var h={i:{min:1/0,max:-1/0},j:{min:1/0,max:-1/0}},c=!0,u=!1,d=void 0;try{for(var f,p=o()(this.allLeaves);!(c=(f=p.next()).done);c=!0){var v=f.value[1].position;h.i.max=Math.max(v.i,h.i.max),h.i.min=Math.min(v.i,h.i.min),h.j.max=Math.max(v.j,h.j.max),h.j.min=Math.min(v.j,h.j.min)}}catch(t){u=!0,d=t}finally{try{!c&&p.return&&p.return()}finally{if(u)throw d}}h.i.max=h.i.max+1,h.i.min=h.i.min-1,h.j.max=h.j.max+1,h.j.min=h.j.min-1,this.positionRange=h}},{key:"seamCarving",value:function(){this.roughCarving(),Data.file}},{key:"roughCarving",value:function(){var t=this.getRoughCarvingVectors();this.moveDescendants(t),this.summarize()}},{key:"fineCarving",value:function(){var t=this.getFineCarvingVectors();this.moveDescendants(t),this.summarize()}},{key:"getRoughCarvingVectors",value:function(){for(var t=this.polygonCreator("carve",this.cellRadius,[0,0]),e=[],i=new d.a,r=new d.a,n=0;n<this.dcdTraversalOrder.length;n++){var s=this.dcdTraversalOrder[n];if(-1===s[1]){var l="leaf_"+s[0];r.set(l,[0,0]);var h=this.descendants.get(l),c=t.changePosition([h.position.i,h.position.j]),u=t.getPositionRange([c]);i.set(l,u),e=[].concat(a()(e),a()(u))}else{var f="child_"+s[0];r.set(f,[0,0]);var p=this.descendants.get(f),v=[],g=!0,y=!1,m=void 0;try{for(var b,S=o()(p.allLeaves);!(g=(b=S.next()).done);g=!0){var w=b.value,D=t.changePosition([w[1].position.i,w[1].position.j]);v.push(D)}}catch(t){y=!0,m=t}finally{try{!g&&S.return&&S.return()}finally{if(y)throw m}}var x=t.getPositionRange(v);i.set(f,x),e=[].concat(a()(e),a()(x))}}e=t.getPositionRange(e);var P={i:Math.round((e[0][0]+e[1][0])/2),j:Math.round((e[0][1]+e[1][1])/2)};this.centerPosition=P;for(var C=new d.a,M=e[0][1];M<=e[1][1];M++)C.set(M,!0);for(var A=new d.a,I=e[0][0];I<=e[1][0];I++)A.set(I,!0);var R=!0,k=!1,T=void 0;try{for(var j,_=o()(i);!(R=(j=_.next()).done);R=!0){if(1===(W=j.value[1]).length)C.set(W[0][1]-1,!1),C.set(W[0][1],!1),A.set(W[0][0]-1,!1),A.set(W[0][0],!1);else{for(var L=W[0][1];L<=W[1][1];L++)C.set(L-1,!1),C.set(L,!1);for(var O=W[0][0];O<=W[1][0];O++)A.set(O-1,!1),A.set(O,!1)}}}catch(t){k=!0,T=t}finally{try{!R&&_.return&&_.return()}finally{if(k)throw T}}var N=new d.a,F=new d.a,B=!0,E=!1,G=void 0;try{for(var H,U=o()(i);!(B=(H=U.next()).done);B=!0){var W,z=H.value,Y=z[0],V=void 0,X=void 0;1===(W=z[1]).length?(V=W[0][1],X=W[0][0]):(W[0][1]>P.j&&(V=W[0][1]),W[1][1]<P.j&&(V=W[1][1]),W[0][0]>P.i&&(X=W[0][0]),W[1][0]<P.j&&(X=W[1][0]));var q=N.get(V)||[];q=[].concat(a()(q),[Y]),N.set(V,q);var J=F.get(X)||[];J=[].concat(a()(J),[Y]),F.set(X,J)}}catch(t){E=!0,G=t}finally{try{!B&&U.return&&U.return()}finally{if(E)throw G}}for(var K=0,Q=P.j;Q<=e[1][1];Q++)if(C.get(Q)&&K--,N.has(Q)){var Z=N.get(Q),$=!0,tt=!1,et=void 0;try{for(var it,rt=o()(Z);!($=(it=rt.next()).done);$=!0){var at=it.value,nt=r.get(at);nt[1]=K,r.set(at,nt)}}catch(t){tt=!0,et=t}finally{try{!$&&rt.return&&rt.return()}finally{if(tt)throw et}}}K=0;for(var st=P.j;st>=e[0][1];st--)if(C.get(st)&&K++,N.has(st)){var lt=N.get(st),ot=!0,ht=!1,ct=void 0;try{for(var ut,dt=o()(lt);!(ot=(ut=dt.next()).done);ot=!0){var ft=ut.value,pt=r.get(ft);pt[1]=K,r.set(ft,pt)}}catch(t){ht=!0,ct=t}finally{try{!ot&&dt.return&&dt.return()}finally{if(ht)throw ct}}}K=0;for(var vt=P.i;vt<=e[1][0];vt++)if(A.get(vt)&&K--,F.has(vt)){var gt=F.get(vt),yt=!0,mt=!1,bt=void 0;try{for(var St,wt=o()(gt);!(yt=(St=wt.next()).done);yt=!0){var Dt=St.value,xt=r.get(Dt);xt[0]=K,r.set(Dt,xt)}}catch(t){mt=!0,bt=t}finally{try{!yt&&wt.return&&wt.return()}finally{if(mt)throw bt}}}K=0;for(var Pt=P.i;Pt>=e[0][0];Pt--)if(A.get(Pt)&&K++,F.has(Pt)){var Ct=F.get(Pt),Mt=!0,At=!1,It=void 0;try{for(var Rt,kt=o()(Ct);!(Mt=(Rt=kt.next()).done);Mt=!0){var Tt=Rt.value,jt=r.get(Tt);jt[0]=K,r.set(Tt,jt)}}catch(t){At=!0,It=t}finally{try{!Mt&&kt.return&&kt.return()}finally{if(At)throw It}}}return r}},{key:"getFineCarvingVectors",value:function(){var t=this.polygonCreator("carve",this.cellRadius,[0,0]),e=new d.a,i=new d.a,r=[],n=new d.a,l=!0,h=!1,c=void 0;try{for(var u,f=o()(this.dcdTraversalOrder);!(l=(u=f.next()).done);l=!0){var p=u.value;if(-1===p[1]){var v="leaf_"+p[0];n.set(v,[0,0]);var g=this.descendants.get(v),y=t.changePosition([g.position.i,g.position.j]),m=[];e.set(y.join("_"),1/0),m.push(y);var b=t.getPositionRange(m);r=[].concat(a()(r),a()(b));var S=!0,w=!1,D=void 0;try{for(var x,P=o()(g.neighbors);!(S=(x=P.next()).done);S=!0){var C=x.value,M=t.changePosition(C[1]);e.set(M.join("_"),1/0),m.push(M)}}catch(t){w=!0,D=t}finally{try{!S&&P.return&&P.return()}finally{if(w)throw D}}i.set(v,m)}else{var A="child_"+p[0];n.set(A,[0,0]);var I=this.descendants.get(A),R=[],k=!0,T=!1,j=void 0;try{for(var _,L=o()(I.allLeaves);!(k=(_=L.next()).done);k=!0){var O=_.value,N=t.changePosition([O[1].position.i,O[1].position.j]);e.set(N.join("_"),1/0),R.push(N)}}catch(t){T=!0,j=t}finally{try{!k&&L.return&&L.return()}finally{if(T)throw j}}var F=t.getPositionRange(R);r=[].concat(a()(r),a()(F));var B=I.neighbors,E=!0,G=!1,H=void 0;try{for(var U,W=o()(B);!(E=(U=W.next()).done);E=!0){var z=U.value,Y=t.changePosition(z.split("_"));e.set(Y.join("_"),1/0),R.push(Y)}}catch(t){G=!0,H=t}finally{try{!E&&W.return&&W.return()}finally{if(G)throw H}}i.set(A,R)}}}catch(t){h=!0,c=t}finally{try{!l&&f.return&&f.return()}finally{if(h)throw c}}for(var V=(r=t.getPositionRange(r))[0][1];V<=r[1][1];V++)for(var X=r[0][0];X<=r[1][0];X++){var q=X+"_"+V;e.has(q)||e.set(q,0)}var J={i:Math.round((r[0][0]+r[1][0])/2),j:Math.round((r[0][1]+r[1][1])/2)};this.centerPosition=J;var K=[],Q=new d.a,Z=!0,$=!1,tt=void 0;try{for(var et,it=o()(this.dcdTraversalOrder);!(Z=(et=it.next()).done);Z=!0){var rt=et.value;if(-1===rt[1]){var at="leaf_"+rt[0],nt=i.get(at)[0],st=[J.i-nt[0],J.j-nt[1]];Q.set(at,st)}else{var lt="child_"+rt[0],ot=this.descendants.get(lt),ht=[0,0],ct=1/0,ut=[!1,!1],dt=[!1,!1],ft=!0,pt=!1,vt=void 0;try{for(var gt,yt=o()(ot.allLeaves);!(ft=(gt=yt.next()).done);ft=!0){var mt=gt.value,bt=t.changePosition([mt[1].position.i,mt[1].position.j]),St=[J.i-bt[0],J.j-bt[1]];if(ut[0]?!dt[0]&&ht[0]*St[0]<=0&&(dt[0]=!0,ht[0]=0):(ht[0]=St[0],ut[0]=!0),ut[1]?!dt[1]&&ht[1]*St[1]<=0&&(dt[1]=!0,ht[1]=0):(ht[1]=St[1],ut[1]=!0),dt[0]&&dt[1])ct=1/0;else{var wt=Math.pow(St[0],2)+Math.pow(St[1],2);wt<ct&&(ct=wt),dt[0]||(ht[0]=St[0]),dt[1]||(ht[1]=St[1])}}}catch(t){pt=!0,vt=t}finally{try{!ft&&yt.return&&yt.return()}finally{if(pt)throw vt}}Q.set(lt,ht),K.push([lt,ct])}}}catch(t){$=!0,tt=t}finally{try{!Z&&it.return&&it.return()}finally{if($)throw tt}}var Dt=[],xt=[!1,!1],Pt=[0,0],Ct=1/0,Mt=!0,At=!1,It=void 0;try{for(var Rt,kt=o()(i);!(Mt=(Rt=kt.next()).done);Mt=!0){var Tt=Rt.value,jt=Tt[0];if(!jt.includes("child")){Dt=[].concat(a()(Dt),a()(Tt[1])),i.delete(jt);St=Q.get(jt);if(Q.delete(jt),xt[0]?Pt[0]*St[0]<=0&&(Pt[0]=0):(Pt[0]=St[0],xt[0]=!0),xt[1]?Pt[1]*St[1]<=0&&(Pt[1]=0):(Pt[1]=St[1],xt[1]=!0),0!==Pt[0]||0!==Pt[1]){var _t=Math.pow(St[0],2)+Math.pow(St[1],2);Ct=Math.min(Ct,_t)}}}}catch(t){At=!0,It=t}finally{try{!Mt&&kt.return&&kt.return()}finally{if(At)throw It}}i.set("leaves",Dt),Q.set("leaves",Pt),K.push(["leaves",Ct]);var Lt=function(t,e){var i=[0,0];if(e.length===i.length&&e.every(function(t,e){return t===i[e]})){Q.delete(t);for(var r=0;r<K.length;r++)K[r][0]===t&&K.splice(r,1)}},Ot=!0,Nt=!1,Ft=void 0;try{for(var Bt,Et=o()(Q.entries());!(Ot=(Bt=Et.next()).done);Ot=!0){var Gt=Bt.value,Ht=s()(Gt,2);Lt(qt=Ht[0],st=Ht[1])}}catch(t){Nt=!0,Ft=t}finally{try{!Ot&&Et.return&&Et.return()}finally{if(Nt)throw Ft}}K.sort(function(t,e){return t[1]>e[1]});for(var Ut=!1,Wt=[],zt=new d.a([].concat(a()(e))),Yt=new d.a;!Ut;){Ut=!0;for(var Vt=new d.a([].concat(a()(zt))),Xt=0;Xt<K.length;Xt++){null==Wt[Xt]&&(Wt[Xt]=0),Wt[Xt]=Wt[Xt]+1;var qt=K[Xt][0],Jt=Yt.get(qt),Kt=i.get(qt);if(null==Jt){Jt=[];var Qt=!0,Zt=!1,$t=void 0;try{for(var te,ee=o()(Kt);!(Qt=(te=ee.next()).done);Qt=!0){var ie=te.value;Jt.push([ie[0],ie[1]])}}catch(t){Zt=!0,$t=t}finally{try{!Qt&&ee.return&&ee.return()}finally{if(Zt)throw $t}}}var re=this.tryToMove(!0,Wt[Xt],Q.get(qt),1,t,Vt,Kt,Jt);Yt.set(qt,Jt),re&&(Wt[Xt]=Wt[Xt]-1),Ut=!(!Ut||!re)}Ut||(zt=new d.a([].concat(a()(Vt))))}e=new d.a([].concat(a()(zt)));for(var ae=0;ae<K.length;ae++){var ne=K[ae][0],se=this.tryToMove(!1,Wt[ae],Q.get(ne),1);if("leaves"===ne){var le=!0,oe=!1,he=void 0;try{for(var ce,ue=o()(this.dcdTraversalOrder);!(le=(ce=ue.next()).done);le=!0){var de=ce.value;-1===de[1]&&n.set("leaf_"+de[0],se)}}catch(t){oe=!0,he=t}finally{try{!le&&ue.return&&ue.return()}finally{if(oe)throw he}}}else n.set(ne,se)}return n}},{key:"moveDescendants",value:function(t){this.occupied.clear();var e=!0,i=!1,r=void 0;try{for(var n,s=o()(t);!(e=(n=s.next()).done);e=!0){var l=n.value,h=l[0],c=l[1];if(h.includes("leaf")){var u=parseInt(h.replace("leaf_","")),f=this.descendants.get(h);f.move(c);var p=f.position.i+"_"+f.position.j;this.occupied.set(p,u)}else{var v=this.descendants.get(h).move(c);this.occupied=new d.a([].concat(a()(this.occupied),a()(v)))}}}catch(t){i=!0,r=t}finally{try{!e&&s.return&&s.return()}finally{if(i)throw r}}}},{key:"tryToMove",value:function(t,e,i,r,a,n,s,l){var h=[0,0],c=!1,u=Math.sqrt(Math.pow(i[0],2)+Math.pow(i[1],2));if(h[0]=Math.round(e/u*i[0]),h[1]=Math.round(e/u*i[1]),t){var d=!0,f=!1,p=void 0;try{for(var v,g=o()(l);!(d=(v=g.next()).done);d=!0){var y=v.value;n.set(y.join("_"),0)}}catch(t){f=!0,p=t}finally{try{!d&&g.return&&g.return()}finally{if(f)throw p}}l.splice(0,l.length);var m=!0,b=!1,S=void 0;try{for(var w,D=o()(s);!(m=(w=D.next()).done);m=!0){var x=w.value,P=a.tryToMove(x,h);if(0!==n.get(P.join("_"))){c=!0;break}}}catch(t){b=!0,S=t}finally{try{!m&&D.return&&D.return()}finally{if(b)throw S}}c&&(h[0]=Math.round((e-r)/u*i[0]),h[1]=Math.round((e-r)/u*i[1]));var C=!0,M=!1,A=void 0;try{for(var I,R=o()(s);!(C=(I=R.next()).done);C=!0){var k=I.value,T=a.tryToMove(k,h);n.set(T.join("_"),1/0),l.push(T)}}catch(t){M=!0,A=t}finally{try{!C&&R.return&&R.return()}finally{if(M)throw A}}return c}return h}},{key:"getClusterContours",value:function(t){for(var e=[],i=0;i<t.length;i++){var r={paths:null,lines:null},a=t[i],n=new d.a,s=!0,l=!1,h=void 0;try{for(var c,u=o()(a);!(s=(c=u.next()).done);s=!0){var f=c.value,p=this.allLeaves.get(f),v=!0,g=!1,y=void 0;try{for(var m,b=o()(p.edges);!(v=(m=b.next()).done);v=!0){var S=m.value[1],w=S.nghPositions;n.has(w)?n.delete(w):n.set(w,S)}}catch(t){g=!0,y=t}finally{try{!v&&b.return&&b.return()}finally{if(g)throw y}}}}catch(t){l=!0,h=t}finally{try{!s&&u.return&&u.return()}finally{if(l)throw h}}var D=[],P=!0,C=!1,M=void 0;try{for(var A,I=o()(n);!(P=(A=I.next()).done);P=!0){var R=A.value;D.push(R[1])}}catch(t){C=!0,M=t}finally{try{!P&&I.return&&I.return()}finally{if(C)throw M}}r.lines=D,r.paths=x.Methods.getPathsByEdges(D),e[i]=r}return e}}]),t}();e.a=T},xTLl:function(t,e){},yqkC:function(t,e,i){t.exports=i.p+"static/img/bremm.e1b1e89.png"}},["NHnr"]);
//# sourceMappingURL=app.cec8ca38348d20948d68.js.map